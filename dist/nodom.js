class e{static add(e){if(Array.isArray(e))for(let t of e)this.elements.set(t.name,t);else this.elements.set(e.name,e)}static get(e){return this.elements.get(e.toUpperCase())}static has(e){return this.elements.has(e.toUpperCase())}}e.elements=new Map;class t{constructor(e,t,s){this.name=e,this.prio=s>=0?s:10,this.handle=t}}class s{static addType(e,s,i){this.directiveTypes.set(e,new t(e,s,i))}static removeType(e){this.directiveTypes.delete(e)}static getType(e){return this.directiveTypes.get(e)}static hasType(e){return this.directiveTypes.has(e)}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function i(e,t,s,i){return new(s||(s=Promise))((function(r,a){function n(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))}s.directiveTypes=new Map;const r={TipWords:{application:"Application",system:"System",module:"Module",moduleClass:"ModuleClass",model:"Model",directive:"Directive",directiveType:"Directive-type",expression:"Expression",event:"Event",method:"Method",filter:"Filter",filterType:"Filter-type",data:"Data",dataItem:"Data-item",route:"Route",routeView:"Route-container",plugin:"Plugin",resource:"Resource",root:"Root",element:"VirtualDom"},ErrorMsgs:{unknown:"unknown error",paramException:"{0} '{1}' parameter error，see api",invoke:"method {0} parameter {1} must be {2}",invoke1:"method {0} parameter {1} must be {2} or {3}",invoke2:"method {0} parameter {1} or {2} must be {3}",invoke3:"method {0} parameter {1} not allowed empty",exist:"{0} is already exist",exist1:"{0} '{1}' is already exist",notexist:"{0} is not exist",notexist1:"{0} '{1}' is not exist",notupd:"{0} not allow to change",notremove:"{0} not allow to delete",notremove1:"{0} {1} not allow to delete",namedinvalid:"{0} {1} name error，see name rules",initial:"{0} init parameter error",jsonparse:"JSON parse error",timeout:"request overtime",config:"{0} config parameter error",config1:"{0} config parameter '{1}' error",itemnotempty:"{0} '{1}' config item '{2}' not allow empty",itemincorrect:"{0} '{1}' config item '{2}' error",wrongTemplate:"wrong template"},FormMsgs:{type:"please input valid {0}",unknown:"input error",required:"is required",min:"min value is {0}",max:"max value is {0}"},WeekDays:{0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"}};class a{static add(e){0===this.modules.size&&(this.mainModule=e),this.modules.set(e.id,e),this.addClass(e.constructor)}static get(e){return"number"==typeof e?this.modules.get(e):this.getInstance(e)}static hasClass(e){return this.classes.has(e)}static addClass(e,t){this.classes.has(e.name)||(this.classes.set(e.name,e),t&&this.classes.set(t,e))}static getInstance(e){let t,s="string"==typeof e?e:e.name;if(t=this.classes.has(s)||"function"!=typeof e?this.classes.get(s):e,!t)return;let i=Reflect.construct(t,[]);return i.init(),i}static remove(e){this.modules.delete(e)}static setMain(e){this.mainModule=e}static getMain(){return this.mainModule}}a.modules=new Map,a.classes=new Map;class n{constructor(e,t){this.staticNum=0,this.allModelField=!0,this.key=t||x.genId()+"",e&&(this.tagName=e)}removeDirectives(e){this.directives&&e.forEach((e=>{this.removeDirective(e)}))}removeDirective(e){if(!this.directives)return;let t;-1!==(t=this.directives.findIndex((t=>t.type.name===e)))&&this.directives.splice(t,1),0===this.directives.length&&delete this.directives}addDirective(e,t){if(this.directives){if(this.directives.find((t=>t.type.name===e.type.name)))return}else this.directives=[];this.directives.push(e),t&&this.sortDirective()}sortDirective(){this.directives&&this.directives.length>1&&this.directives.sort(((e,t)=>s.getType(e.type.name).prio<s.getType(t.type.name).prio?-1:1))}hasDirective(e){return this.directives&&-1!==this.directives.findIndex((t=>t.type.name===e))}getDirective(e){if(this.directives)return this.directives.find((t=>t.type.name===e))}add(e){this.children||(this.children=[]),this.children.push(e)}hasClass(e){let t=this.getProp("class");return!!t&&t.trim().split(/\s+/).includes(e)}addClass(e){let t=this.getProp("class");if(t&&""!==t){let s=t.trim().split(/\s+/);s.includes(e)||(s.push(e),t=s.join(" "),this.setProp("class",t),this.setStaticOnce())}else this.setProp("class",e),this.setStaticOnce()}removeClass(e){let t=this.getProp("class");if(t&&""!==t){{let s,i=t.trim().split(/\s+/);-1!==(s=i.indexOf(e))&&(i.splice(s,1),t=i.join(" "))}this.setProp("class",t)}}hasStyle(e){let t=this.getProp("style");return!!t&&t.trim().split(/;\s+/).includes(e)}addStyle(e){let t=this.getProp("style");if(t){let s=t.trim().split(/;\s+/);s.includes(e)||(s.push(e),t=s.join(";"),this.setProp("style",t),this.setStaticOnce())}else this.setProp("style",e),this.setStaticOnce()}removeStyle(e){let t=this.getProp("style");if(t){{let s,i=t.trim().split(/;\s+/);-1!==(s=i.indexOf(e))&&(i.splice(s,1),t=i.join(";"))}this.setProp("style",t),this.setStaticOnce()}}hasProp(e){if(this.props)return this.props.has(e)}getProp(e,t){if(this.props)return this.props.get(e)}setProp(e,t){this.props||(this.props=new Map),this.props.set(e,t)}delProp(e){if(this.props){if(x.isArray(e))for(let t of e)this.props.delete(t);else this.props.delete(e);this.setStaticOnce()}}setAsset(e,t){this.assets||(this.assets=new Map),this.assets.set(e,t)}delAsset(e){this.assets&&this.assets.delete(e)}addEvent(e){if(this.events||(this.events=new Map),this.events.has(e.name)){let t=this.events.get(e.name);-1===t.indexOf(e.id)&&t.push(e.id)}else this.events.set(e.name,[e.id])}getEvent(e){if(this.events)return this.events.get(e)}setEvent(e,t){this.events||(this.events=new Map),this.events.set(e,t)}getEl(e){return e.getNode(this.key)}query(e){if(this.key===e)return this;if(this.children)for(let t=0;t<this.children.length;t++){let s=this.children[t].query(e);if(s)return s}}setParam(e,t,s){e.objectManager.setElementParam(this.key,t,s)}getParam(e,t){return e.objectManager.getElementParam(this.key,t)}removeParam(e,t){e.objectManager.removeElementParam(this.key,t)}setStaticOnce(){-1!==this.staticNum&&(this.staticNum=1)}clone(){let e=new n(this.tagName,this.key);if(this.tagName){if(this.props&&this.props.size>0)for(let t of this.props)e.setProp(t[0],t[1]);if(this.assets&&this.assets.size>0)for(let t of this.assets)e.setAsset(t[0],t[1]);if(this.events&&this.events.size>0)for(let t of this.events)e.setEvent(t[0],t[1].slice(0));if(this.directives&&this.directives.length>0){e.directives=[];for(let t of this.directives)e.directives.push(t.clone())}if(this.children)for(let t of this.children)e.add(t.clone())}else e.expressions=this.expressions,e.textContent=this.textContent;return e.staticNum=this.staticNum,e}}class o{constructor(e,t){if(this.id=x.genId(),this.allModelField=!0,!e||!t)return;const s=this.compile(t);this.execFunc=new Function("$model","return "+s)}compile(e){const t=/('[\s\S]*?')|("[\s\S]*?")|(`[\s\S]*?`)|([a-zA-Z$_][\w$]*\s*?:)|((\.{3}|\.)?[a-zA-Z$_][\w$]*(\.[a-zA-Z$_][\w$]*)*(\s*[\[\(](\s*\))?)?)/g;let s,i="",r=0;for(;null!==(s=t.exec(e));){let n=s[0];if(r<s.index&&(i+=e.substring(r,s.index)),"'"===n[0]||'"'===n[0]||"`"===n[0])i+=n;else{let e=n[n.length-1];if(":"===e)i+=n;else if("("===e||")"===e)i+=a(n);else if(n.startsWith("this.")||"$model"===n||n.startsWith("$model.")||x.isKeyWord(n)||"."===n[0]&&"."!==n[1])i+=n;else{let e="";n.startsWith("...")&&(e="...",n=n.substr(3)),i+=e+"$model."+n,-1!==n.indexOf(".")&&(this.allModelField=!1)}}r=t.lastIndex}return r<e.length&&(i+=e.substr(r)),i;function a(e){let t=e.indexOf(".");if(-1===t){let t=e.lastIndexOf("("),s=e.substr(0,t);if(!x.isKeyWord(s)){return")"!==e[e.length-1]?'this.invokeMethod("'+s+'",':'this.invokeMethod("'+s+'")'}}else if("."!==e[0]){let s=e.substr(0,t);if(!x.isKeyWord(s))return"$model."+e}return e}}val(e,t){let s;t||(t=e.model);try{s=this.execFunc.apply(e,[t,e])}catch(e){}return this.value=s,s}clone(){return this}}class l{static handleStyleDom(e,t,s,i){return"style"===t.tagName.toLowerCase()&&(i?s.addClass(this.cssPreName+e.id):s.removeClass(this.cssPreName+e.id),!0)}static handleStyleTextDom(e,t){return"style"===t.parent.tagName.toLowerCase()&&(l.addRules(e,t.textContent,"this"===t.parent.getProp("scope")?"."+this.cssPreName+e.id:void 0),!0)}static addRules(e,t,s){if(!this.sheet){let e=document.createElement("style");document.head.appendChild(e),this.sheet=document.styleSheets[0]}s&&this.clearModuleRules(e);const i=/(@[a-zA-Z]+\s+url\(.+?\))|([.#@a-zA-Z]\S*(\s*\S*\s*?)?{)|\}/g,r=/@[a-zA-Z]+\s+url/;let a,n=-1,o=0;for(;null!==(a=i.exec(t));)if(r.test(a[0]))c(a[0]);else if("}"===a[0]){if(n>=0&&--o<=0){let i=t.substring(n,a.index+1);"@"===i[0]?this.sheet.insertRule(i,l.sheet.cssRules?l.sheet.cssRules.length:0):d(e,i,s),n=-1,o=0}}else-1===n?(n=a.index,o++):o++;function d(e,t,s){let i=/.+(?=\{)/.exec(t);if(i){if(s){let r=e.objectManager.get("$cssRules");r||(r=[],e.objectManager.set("$cssRules",r)),r.push(s+" "+i[0]),t=s+" "+t}l.sheet.insertRule(t,l.sheet.cssRules?l.sheet.cssRules.length:0)}}function c(e){let t;if(null!==(t=/(?<=\()\S+(?=\))/.exec(e))){if(l.importMap.has(t[0]))return;l.sheet.insertRule(e,l.importIndex++),l.importMap.set(t[0],!0)}}}static clearModuleRules(e){let t=e.objectManager.get("$cssRules");if(t&&0!==t.length){for(let e=0;e<this.sheet.cssRules.length;e++){let s=this.sheet.cssRules[e];s.selectorText&&-1!==t.indexOf(s.selectorText)&&this.sheet.deleteRule(e--)}e.objectManager.set("$cssRules",[])}}}l.importMap=new Map,l.importIndex=0,l.cssPreName="___nodommodule___";class d{constructor(){this.cacheData={}}get(e){let t=this.cacheData;if(-1!==e.indexOf(".")){let s=e.split(".");if(s.length>1){for(let e=0;e<s.length-1&&t;e++)t=t[s[e]];t&&(e=s[s.length-1])}}if(t)return t[e]}set(e,t){let s=this.cacheData;if(-1!==e.indexOf(".")){let t=e.split(".");if(t.length>1){for(let e=0;e<t.length-1;e++)s[t[e]]&&"object"==typeof s[t[e]]||(s[t[e]]={}),s=s[t[e]];e=t[t.length-1]}}s&&(s[e]=t)}remove(e){let t=this.cacheData;if(-1!==e.indexOf(".")){let s=e.split(".");if(s.length>1){for(let e=0;e<s.length-1&&t;e++)t=t[s[e]];t&&(e=s[s.length-1])}}t&&delete t[e]}}class c{static set(e,t){this.cache.set(e,t)}static get(e){return this.cache.get(e)}static remove(e){this.cache.remove(e)}static getDirective(e){return this.cache.get("$directives."+e+".$instance")}static saveDirective(e){this.cache.set("$directives."+e.id+".$instance",e)}static removeDirective(e){this.cache.remove("$directives."+e)}static setDirectiveParam(e,t,s,i){this.cache.set("$doms."+t+"$directives."+e+".$params."+s,i)}static getDirectiveParam(e,t,s){return this.cache.get("$doms."+t+"$directives."+e+".$params."+s)}static removeDirectiveParam(e,t,s){this.cache.remove("$doms."+t+"$directives."+e+".$params."+s)}static clearDirectiveParam(e,t){this.cache.remove("$doms."+t+"$directives."+e+".$params."+name)}static getExpression(e){return this.cache.get("$expressions."+e)}static saveExpression(e){this.cache.set("$expressions."+e.id,e)}static removeExpression(e){this.cache.remove("$expressions."+e)}static getEvent(e){return this.cache.get("$events."+e+".$instance")}static saveEvent(e){this.cache.set("$events."+e.id+".$instance",e)}static removeEvent(e){this.cache.remove("$events."+e)}static setEventParam(e,t,s,i){this.cache.set("$doms."+t+"$events."+e+".$params."+s,i)}static getEventParam(e,t,s){return this.cache.get("$doms."+t+"$events."+e+".$params."+s)}static removeEventParam(e,t,s){this.cache.remove("$doms."+t+"$events."+e+".$params."+s)}static clearEventParam(e,t){this.cache.remove("$doms."+t+"$events."+e+".$params")}static saveElement(e){this.cache.set("$doms."+e.key,e)}static getElement(e){return this.cache.get("$doms."+e)}static removeElement(e){this.cache.remove("$doms."+e)}static getNode(e){return this.cache.get("$doms."+e+".$el")}static saveNode(e,t){this.cache.set("$doms."+e+".$el",t)}static removeSavedNode(e){this.cache.remove("$doms."+e)}static setElementParam(e,t,s){this.cache.set("$doms."+e+".$params."+t,s)}static getElementParam(e,t){return this.cache.get("$doms."+e+".$params."+t)}static removeElementParam(e,t){this.cache.remove("$doms."+e+".$params."+t)}static clearElementParams(e){this.cache.remove("$doms."+e+".$params")}static clearDirectives(){this.remove("$directives")}static clearExpressions(){this.remove("$directives")}static clearEvents(){this.remove("$directives")}static clearSaveDoms(){this.remove("$doms")}}c.cache=new d;class h{constructor(e,t,s){if(this.id=x.genId(),this.name=e,c.saveEvent(this),t){let e=typeof t;if("string"===e){t.trim().split(":").forEach(((e,t)=>{if(e=e.trim(),0===t)this.handler=e;else switch(e){case"delg":this.delg=!0;break;case"nopopo":this.nopopo=!0;break;case"once":this.once=!0;break;case"capture":this.capture=!0}}))}else"function"===e&&(s=t)}if(s&&(this.handler=s),document.ontouchend)switch(this.name){case"click":this.name="tap";break;case"mousedown":this.name="touchstart";break;case"mouseup":this.name="touchend";break;case"mousemove":this.name="touchmove"}else switch(this.name){case"tap":this.name="click";break;case"touchstart":this.name="mousedown";break;case"touchend":this.name="mouseup";break;case"touchmove":this.name="mousemove"}}setParam(e,t,s,i){e.objectManager.setEventParam(this.id,t.key,s,i)}getParam(e,t,s){return e.objectManager.getEventParam(this.id,t.key,s)}removeParam(e,t,s){return e.objectManager.removeEventParam(this.id,t.key,s)}clearParam(e,t){e.objectManager.clearEventParam(this.id,t.key)}}class p{static bind(e,t){if(!t.events)return;let s=e.getNode(t.key);if(!s.bindEvent){s.bindEvent=!0;for(let n of t.events){let o=n[1];if(0===o.length)return;let l=-1!==o.findIndex((t=>!0===e.objectManager.getEvent(t).capture)),d=!1,c=!1;for(let n=0;n<o.length;n++){const h=e.objectManager.getEvent(o[n]);if(this.handleExtendEvent(e,t,h))o.splice(n--,1);else{if(c&&d)break;if(h.delg){if(!d){const s=t.parent;s.addEvent(h);let l=h.getParam(e,s,"$delgs");l||(l={},h.setParam(e,s,"$delgs",l)),l[t.key]=t,o.splice(n--,1),r(s,h.name)||(i(s,h.name,a,h.capture),e.getNode(s.key).addEventListener(h.name,a,h.capture)),d=!0}}else c||(c=!0,i(t,h.name,a,l),s.addEventListener(h.name,a,l))}}}}function i(t,s,i,r){e.objectManager.set("$domevents_"+t.key+"_"+s,{handler:i,capture:r})}function r(t,s){return e.objectManager.get("$domevents_"+t.key+"_"+s)}function a(t){let s=t.currentTarget;const i=s.vdom;if(!i||!i.events||!i.events.has(t.type))return;const r=i.getEvent(t.type);let a=new Map;for(let n=0;n<r.length;n++){const o=r[n],l=e.objectManager.getEvent(o);if("string"==typeof l.handler&&(l.handler=e.getMethod(l.handler)),!l.handler)return;if(l.nopopo&&t.stopPropagation(),l.delg){let r=l.getParam(e,i,"$delgs");for(let i=0;i<t.path.length&&t.path[i]!==s;i++){let s=t.path[i].vdom.key;if(s&&r.hasOwnProperty(s)){let i=r[s];if(i){if(a.get(l.id)===i.key)break;l.handler.apply(e,[i.model,i,l,t]),a.set(l.id,i.key),l.once&&p.unbind(e,i,l)}break}}}else l.handler.apply(e,[i.model,i,l,t]),l.once&&(p.unbind(e,i,l),n--)}}}static unbind(e,t,s){let i,r;if(s.delg){i=t.parent.getEvent(s.name);let r=s.getParam(e,t.parent,"$delgs");if(delete r[t.key],Object.keys(r).length>0)return}else i=t.getEvent(s.name);if(i&&-1!==(r=i.findIndex((e=>e===s.id)))&&(i.splice(r,1),0===i.length)){const i=e.objectManager.get("$domevents_"+t.key+"_"+s.name);i&&i.handler&&t.getEl(e).removeEventListener(s.name,i.handler,i.capture)}}static handleExtendEvent(e,t,s){let i=this.get(s.name);if(!i)return!1;for(let e of Object.keys(i)){let r=new h(e,i[e]);r.capture=s.capture,r.nopopo=s.nopopo,r.delg=s.delg,r.once=s.once,r.dependEvent=s,t.addEvent(r)}return!0}static regist(e,t){this.extendEventMap.set(e,t)}static unregist(e){return this.extendEventMap.delete(e)}static get(e){return this.extendEventMap.get(e)}}p.extendEventMap=new Map;class u{static add(e){e.dontAddToRender||this.waitList.includes(e.id)||this.waitList.push(e.id)}static render(){for(;this.waitList.length>0;)a.get(this.waitList.shift()).render()}static renderDom(e,t,s,i,r){s=t.model?t.model:s;let a=new n(t.tagName,r?t.key+"_"+r:t.key);if(i||(this.currentModuleRoot=a),t.staticNum>0&&t.staticNum--,a.model=s,a.subModuleId=t.subModuleId,i&&(a.parent=i),t.directives&&t.directives.length>0&&"model"===t.directives[0].type.name&&t.directives[0].exec(e,a,t),t.tagName){if(!a.notChange){if(function(){if(!t.props||0===t.props.size)return;for(let s of t.props)s[1]instanceof o?(a.setProp(s[0],s[1].val(e,a.model)),a.staticNum=-1):a.setProp(s[0],s[1])}(),!function(){if(!t.directives||0===t.directives.length)return!0;a.staticNum=-1;for(let s of t.directives)if("model"!==s.type.name&&!s.exec(e,a,t))return!1;return!0}())return;if(!l.handleStyleDom(e,t,u.currentModuleRoot,"this"===t.getProp("scope"))){if(t.assets&&t.assets.size>0)for(let e of t.assets)a.setAsset(e[0],e[1]);if(t.events&&t.events.size>0)for(let e of t.events)a.setEvent(e[0],e[1].slice(0))}}if(t.children&&t.children.length>0){a.children=[];for(let s of t.children)u.renderDom(e,s,a.model,a,r||null)}}else if(!a.notChange)if(t.expressions){let s="";t.expressions.forEach((t=>{if(t instanceof o){let i=t.val(e,a.model);s+=void 0!==i?i:""}else s+=t})),a.textContent=s,a.staticNum=-1}else a.textContent=t.textContent;return i&&!a.dontAddToTree&&i.children.push(a),a}static renderToHtml(e,t,s,i){let r=e.getNode(t.key);if(r)if(t.tagName){if(t.props)for(let e of t.props)void 0!==e[1]&&r.setAttribute(e[0],e[1]);!function(e,t){if(e.assets)for(let s of e.assets)t[s[0]]=s[1]}(t,r)}else r.textContent=t.textContent;else r=t.tagName?n(t):o(t),r&&t.tagName&&i&&function e(t,s){s.children&&s.children.length>0&&s.children.forEach((s=>{let i;s.tagName?(i=n(s),e(i,s)):i=o(s),i&&t.appendChild(i)}))}(r,t),r&&s&&s.appendChild(r);return r;function n(t){if("style"===t.tagName.toLowerCase())return;let s=document.createElement(t.tagName);if(s.vdom=t,t.subModuleId){let e=a.get(t.subModuleId);e&&e.setContainer(s,!0)}if(t.props)for(let e of t.props)void 0!==e[1]&&s.setAttribute(e[0],e[1]);if(e.saveNode(t.key,s),t.assets&&t.assets.size>0)for(let e in t.assets)s[e]=e[1];return t.events&&p.bind(e,t),s}function o(t){if(l.handleStyleTextDom(e,t))return;let s=document.createTextNode(t.textContent||"");return e.saveNode(t.key,s),s}}static handleChangedDoms(e,t){for(let s of t){let[t,i,r]=[s[1]?e.getNode(s[1].key):null,s[2]&&"object"==typeof s[2]?e.getNode(s[2].key):null,s[3]?e.getNode(s[3].key):null];switch(s[0]){case 1:u.renderToHtml(e,s[1],r,!0),t=e.getNode(s[1].key),i?r.insertBefore(t,i):"number"==typeof s[2]&&r.childNodes.length-1>s[2]?r.insertBefore(t,r.childNodes[s[2]]):r.appendChild(t);break;case 2:u.renderToHtml(e,s[1],null,!1);break;case 3:e.objectManager.removeSavedNode(s[1].key),e.keyNodeMap.delete(s[1].key),r.removeChild(t);break;case 4:s[4]?i&&i.nextSibling?r.insertBefore(t,i.nextSibling):r.appendChild(t):r.insertBefore(t,i);break;default:u.renderToHtml(e,s[1],r,!0),t=e.getNode(s[1].key),r.replaceChild(t,i)}}}}u.waitList=[];class m{static go(e){e!==this.currentPath&&(-1===this.waitList.indexOf(e)&&this.waitList.push(e),setTimeout((()=>{this.load()}),0))}static load(){if(0===this.waitList.length)return;let e=this.waitList.shift();this.start(e).then((()=>{this.load()}))}static start(e){return i(this,void 0,void 0,(function*(){let t,s=this.compare(this.currentPath,e);t=null===s[0]?a.getMain():yield this.getModule(s[0]);for(let e=s[1].length-1;e>=0;e--){const t=s[1][e];if(!t.module)continue;let i=yield this.getModule(t);x.isFunction(this.onDefaultLeave)&&this.onDefaultLeave(i.model),x.isFunction(t.onLeave)&&t.onLeave(i.model),this.activeFieldMap.delete(i.id),i.unactive()}if(0===s[2].length){let e=s[0];if(null!==e){let t=yield this.getModule(e);this.dependHandle(t,e,s[3]?s[3].module:null)}}else for(let e=0;e<s[2].length;e++){let i=s[2][e];if(!i||!i.module)continue;let r=yield this.getModule(i);this.dependHandle(r,i,t),x.isFunction(this.onDefaultEnter)&&this.onDefaultEnter(r.model),x.isFunction(i.onEnter)&&i.onEnter(r.model),t=r}0===this.startStyle&&(e.startsWith(this.currentPath)?history.replaceState(e,"",e):history.pushState(e,"",e)),this.currentPath=e,this.startStyle=0}))}static redirect(e){this.go(e)}static getModule(e){return i(this,void 0,void 0,(function*(){let t=e.module;return"object"==typeof t||("string"==typeof t&&e.modulePath&&(t=yield import(e.modulePath),t=t[e.module]),"function"==typeof t&&(t=a.get(t)),e.module=t),t}))}static compare(e,t){let s=null,i=null;e&&(s=this.getRouteList(e,!0)),t&&(i=this.getRouteList(t));let r=0;null!==s&&(r=s.length),null!==i?i.length<r&&(r=i.length):r=0;let a=[],n=[],o=0;for(o=0;o<r&&s[o].id===i[o].id;o++)if(JSON.stringify(s[o].data)!==JSON.stringify(i[o].data)){o++;break}null!==s&&(a=s.slice(o)),null!==i&&(n=i.slice(o));let l=null,d=null;if(i&&o>0)for(let e=o-1;e>=0;e--)if(l){if(!d&&i[e].module){d=i[e];break}}else if(i[e].module){l=i[e];continue}return[l,a,n,d]}static addActiveField(e,t,s,i){if(!s||!i)return;let r=m.activeFieldMap.get(e.id);r?void 0===r.find((e=>e.model===s&&e.field===i))&&r.push({path:t,model:s,field:i}):m.activeFieldMap.set(e.id,[{path:t,model:s,field:i}])}static dependHandle(e,t,s){const i=this;e.active();let r={path:t.path};x.isEmpty(t.data)||(r.data=t.data),e.model.$route=r,s&&(2===s.state?(e.setContainer(s.getNode(m.routerKeyMap.get(s.id))),this.setDomActive(s,t.fullPath)):s.addRenderOps((function(t,s){e.setContainer(t.getNode(m.routerKeyMap.get(t.id))),i.setDomActive(t,s)}),1,[s,t.fullPath],!0))}static setDomActive(e,t){let s=m.activeFieldMap.get(e.id);if(s)for(let e of s)e.model[e.field]=e.path===t}static addRoute(e,t){this.root||(this.root=new f);let s=e.path.split("/"),i=t||this.root,r=[],a=-1,n="";for(let t=0;t<s.length;t++){let o=s[t].trim();if(""!==o){if(o.startsWith(":"))0===r.length&&(a=t),r.push(o.substr(1));else{a=-1,r=[],e.path=o;let t=0;for(;t<i.children.length;t++){let e=i.children[t];if(e.path===o){i=e;break}}t===i.children.length&&(""!==n&&(new f({path:n,parent:i}),i=i.children[i.children.length-1]),n=o)}e.params=-1===a?[]:r}else s.splice(t--,1)}void 0!==i&&i!==e&&(e.path=n,i.addChild(e)),this.routeMap.set(e.id,e)}static getRouteList(e,t){if(!this.root)return[];let s=e.split("/"),i=this.root,r=0,a=[],n="",o=this.root;for(let e=0;e<s.length;e++){let l=s[e].trim();if(""===l)continue;let d=!1;for(let e=0;e<i.children.length;e++)if(i.children[e].path===l){o!==this.root&&(o.fullPath=n,o.data=i.data,a.push(o)),i=t?i.children[e].clone():i.children[e],i.data={},o=i,d=!0,r=0;break}n+="/"+l,d||r<i.params.length&&(i.data[i.params[r++]]=l)}return i!==this.root&&(i.fullPath=n,a.push(i)),a}}m.routeMap=new Map,m.waitList=[],m.startStyle=0,m.activeFieldMap=new Map,m.routerKeyMap=new Map,window.addEventListener("popstate",(function(e){const t=history.state;t&&(m.startStyle=1,m.go(t))}));class f{constructor(e){if(this.params=[],this.data={},this.children=[],e&&!x.isEmpty(e.path)){for(let t in e)this[t]=e[t];this.id=x.genId(),m.addRoute(this,e.parent),e.routes&&Array.isArray(e.routes)&&e.routes.forEach((e=>{e.parent=this,new f(e)}))}}addChild(e){this.children.push(e),e.parent=this}clone(){let e=new f;return Object.getOwnPropertyNames(this).forEach((t=>{"data"!==t&&(e[t]=this[t])})),this.data&&(e.data=x.clone(this.data)),e}}class g{static dispatch(){g.tasks.forEach((e=>{x.isFunction(e.func)&&(e.thiser?e.func.call(e.thiser):e.func())}))}static start(e){g.dispatch(),window.requestAnimationFrame?window.requestAnimationFrame(g.start):window.setTimeout(g.start,e||50)}static addTask(e,t){if(!x.isFunction(e))throw new b("invoke","Scheduler.addTask","0","function");g.tasks.push({func:e,thiser:t})}static removeTask(e){if(!x.isFunction(e))throw new b("invoke","Scheduler.removeTask","0","function");let t=-1;-1!==(t=g.tasks.indexOf(e))&&g.tasks.splice(t,1)}}var v;function y(e,t){g.addTask(u.render,u),g.start(),v=r;let s=a.get(e);s.setContainer(document.querySelector(t)),s.active()}function M(e){if(!x.isArray(e))return new f(e);for(let t of e)new f(t)}function w(e,t,i){return s.addType(e,t,i)}function k(e,t){a.addClass(e,t)}function $(e){return i(this,void 0,void 0,(function*(){return new Promise(((t,s)=>{"string"==typeof e&&(e={url:e}),e.params=e.params||{},e.rand&&(e.params.$rand=Math.random());let i=e.url;const r=!1!==e.async,a=new XMLHttpRequest;a.withCredentials=e.withCredentials;const n=(e.method||"GET").toUpperCase();a.timeout=r?e.timeout:0,a.onload=()=>{if(200===a.status){let i=a.responseText;if("json"===e.type)try{i=JSON.parse(i)}catch(e){s({type:"jsonparse"})}t(i)}else s({type:"error",url:i})},a.ontimeout=()=>s({type:"timeout"}),a.onerror=()=>s({type:"error",url:i});let o=null;switch(n){case"GET":let t;if(x.isObject(e.params)){let s=[];x.getOwnProps(e.params).forEach((function(t){s.push(t+"="+e.params[t])})),t=s.join("&")}void 0!==t&&(-1!==i.indexOf("?")?i+="&"+t:i+="?"+t);break;case"POST":if(e.params instanceof FormData)o=e.params;else{let t=new FormData;for(let s in e.params)t.append(s,e.params[s]);o=t}}a.open(n,i,r,e.user,e.pwd),e.header&&x.getOwnProps(e.header).forEach((t=>{a.setRequestHeader(t,e.header[t])})),a.send(o)})).catch((e=>{switch(e.type){case"error":throw new b("notexist1",v.TipWords.resource,e.url);case"timeout":throw new b("timeout");case"jsonparse":throw new b("jsonparse")}}))}))}g.tasks=[];class b extends Error{constructor(e,t,s,i,r){super(e);let a=v.ErrorMsgs[e];if(void 0===a)return void(this.message="未知错误");let n=[a];for(let e=1;e<arguments.length;e++)n.push(arguments[e]);this.message=x.compileStr.apply(null,n)}}class x{static genId(){return this.generatedId++}static initKeyMap(){this.keyWordMap.set("arguments",!0),this.keyWordMap.set("boolean",!0),this.keyWordMap.set("break",!0),this.keyWordMap.set("byte",!0),this.keyWordMap.set("catch",!0),this.keyWordMap.set("char",!0),this.keyWordMap.set("const",!0),this.keyWordMap.set("default",!0),this.keyWordMap.set("delete",!0),this.keyWordMap.set("do",!0),this.keyWordMap.set("double",!0),this.keyWordMap.set("else",!0),this.keyWordMap.set("enum",!0),this.keyWordMap.set("eval",!0),this.keyWordMap.set("false",!0),this.keyWordMap.set("float",!0),this.keyWordMap.set("for",!0),this.keyWordMap.set("function",!0),this.keyWordMap.set("goto",!0),this.keyWordMap.set("if",!0),this.keyWordMap.set("in",!0),this.keyWordMap.set("instanceof",!0),this.keyWordMap.set("int",!0),this.keyWordMap.set("let",!0),this.keyWordMap.set("long",!0),this.keyWordMap.set("new",!0),this.keyWordMap.set("null",!0),this.keyWordMap.set("return",!0),this.keyWordMap.set("short",!0),this.keyWordMap.set("switch",!0),this.keyWordMap.set("this",!0),this.keyWordMap.set("throw",!0),this.keyWordMap.set("true",!0),this.keyWordMap.set("try",!0),this.keyWordMap.set("this",!0),this.keyWordMap.set("throw",!0),this.keyWordMap.set("typeof",!0),this.keyWordMap.set("var",!0),this.keyWordMap.set("while",!0),this.keyWordMap.set("with",!0),this.keyWordMap.set("Array",!0),this.keyWordMap.set("Date",!0),this.keyWordMap.set("Set",!0),this.keyWordMap.set("Map",!0),this.keyWordMap.set("eval",!0),this.keyWordMap.set("function",!0),this.keyWordMap.set("Infinity",!0),this.keyWordMap.set("isFinite",!0),this.keyWordMap.set("isNaN",!0),this.keyWordMap.set("isPrototypeOf",!0),this.keyWordMap.set("Math",!0),this.keyWordMap.set("NaN",!0),this.keyWordMap.set("Number",!0),this.keyWordMap.set("Object",!0),this.keyWordMap.set("prototype",!0),this.keyWordMap.set("String",!0),this.keyWordMap.set("isPrototypeOf",!0),this.keyWordMap.set("undefined",!0),this.keyWordMap.set("valueOf",!0)}static isKeyWord(e){return this.keyWordMap.has(e)}static clone(e,t,s){let i=this,r=new WeakMap;return a(e,t,s);function a(e,t,s){if(!e||"object"!=typeof e||x.isFunction(e))return e;let a;return e.clone&&x.isFunction(e.clone)?e.clone(s):(i.isObject(e)?(a=new Object,r.set(e,a),Object.getOwnPropertyNames(e).forEach((i=>{t&&(t.constructor===RegExp&&t.test(i)||x.isArray(t)&&t.includes(i))||(a[i]=n(e[i],t,s))}))):i.isMap(e)?(a=new Map,e.forEach(((e,i)=>{t&&(t.constructor===RegExp&&t.test(i)||t.includes(i))||a.set(i,n(e,t,s))}))):i.isArray(e)&&(a=new Array,e.forEach((function(e,i){a[i]=n(e,t,s)}))),a)}function n(e,t,s){if("object"==typeof e&&!x.isFunction(e)){let i=null;return i=r.has(e)?r.get(e):a(e,t,s),i}return e}}static merge(e,t,s,i,r,a){let n=this;for(let e=0;e<arguments.length;e++)if(!this.isObject(arguments[e]))throw new b("invoke","Util.merge",e+"","object");let o=Object.assign.apply(null,arguments);return function(e){for(let t in e)(n.isObject(e[t])||n.isArray(e[t]))&&(o[t]=n.clone(o[t]))}(o),o}static assign(e,t){return Object.assign?Object.assign(e,t):this.getOwnProps(t).forEach((function(s){e[s]=t[s]})),e}static compare(e,t,s){if(!e&&!t)return!0;if("object"!=typeof e||"object"!=typeof t)return!1;const i=Object.getOwnPropertyNames(e);if(i.length!==Object.getOwnPropertyNames(t).length)return!1;for(let s of i)if(e[s]!==t[s])return!1;if(s)for(let s of i){if(!this.compare(e[s],t[s]))return!1}return!0}static getOwnProps(e){return e?Object.getOwnPropertyNames(e):[]}static isFunction(e){return null!=e&&e.constructor===Function}static isArray(e){return Array.isArray(e)}static isMap(e){return null!=e&&e.constructor===Map}static isObject(e){return null!=e&&e.constructor===Object}static isInt(e){return Number.isInteger(e)}static isNumber(e){return"number"==typeof e}static isBoolean(e){return"boolean"==typeof e}static isString(e){return"string"==typeof e}static isNumberString(e){return/^\d+\.?\d*$/.test(e)}static isEmpty(e){if(null==e)return!0;let t=typeof e;if(this.isObject(e)){let t=Object.keys(e);if(void 0!==t)return 0===t.length}else if("string"===t)return""===e;return!1}static replaceNode(e,t){let s=e.parentNode,i=e.nextSibling;if(null===s)return;s.removeChild(e);(this.isArray(t)?t:[t]).forEach((function(e){null==i?s.appendChild(e):s.insertBefore(e,i)}))}static empty(e){let t=e.childNodes;for(let s=t.length-1;s>=0;s--)e.removeChild(t[s])}static formatDate(e,t){let s;if(this.isString(e)){!0===/^\d+$/.test(e)&&(s=parseInt(e))}else{if(!this.isNumber(e))throw new b("invoke","this.formatDate","0","date string","date");s=e}let i=new Date(s);if(isNaN(i.getDay()))return"";let r={"M+":i.getMonth()+1,"d+":i.getDate(),"h+":i.getHours()%12==0?12:i.getHours()%12,"H+":i.getHours(),"m+":i.getMinutes(),"s+":i.getSeconds(),"q+":Math.floor((i.getMonth()+3)/3),S:i.getMilliseconds()};return/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(i.getFullYear()+"").substr(4-RegExp.$1.length))),this.getOwnProps(r).forEach((function(e){new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?r[e]:("00"+r[e]).substr((""+r[e]).length)))})),/(E+)/.test(t)&&(t=t.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+v.WeekDays[i.getDay()+""])),t}static compileStr(e,t,s,i,r,a){let n,o=arguments,l=0;for(;-1!==e.indexOf("{"+l+"}");)n=new RegExp("\\{"+l+"\\}","g"),e=e.replace(n,o[l+1]),l++;return e}static apply(e,t,s){if(e)return Reflect.apply(e,t||null,s)}static mergePath(e){return e.join("/").replace(/(\/{2,})|\\\//g,"/")}static eval(e){return new Function(`return(${e})`)()}static setNodeKey(e,t,s){if(e.key+="_"+(t||x.genId()),s&&e.children)for(let i of e.children)x.setNodeKey(i,t,s)}}x.generatedId=1,x.keyWordMap=new Map,x.initKeyMap();class P{constructor(e,t){if(this.id=x.genId(),e&&(this.type=s.getType(e),!this.type))throw new b("notexist1",v.TipWords.directive,e);x.isString(t)?this.value=t.trim():t instanceof o?this.expression=t:this.value=t}exec(e,t,s){return!!this.disabled||(this.expression&&(this.value=this.expression.val(e,t.model)),this.type.handle.apply(this,[e,t,s]))}setParam(e,t,s,i){e.objectManager.setDirectiveParam(this.id,t.key,s,i)}getParam(e,t,s){return e.objectManager.getDirectiveParam(this.id,t.key,s)}removeParam(e,t,s){e.objectManager.removeDirectiveParam(this.id,t.key,s)}clone(){let e=new P;return e.type=this.type,e.expression=this.expression,e.value=this.value,e}}class E{constructor(e){this.elementId=0,this.module=e}compile(e){return this.compileTemplate(e)}compileTemplate(e){let t=/\<\!\-\-[\s\S]*?\-\-\>/g;e=e.replace(t,"");const s=/^[\s\n\r\t\v]+$/;t=/(?<!{{[^}}]*)(?:<(\/?)\s*?([a-zA-Z][a-zA-Z0-9-_]*)([\s\S]*?)(\/?)(?<!=)>)(?![^{{]*}})/g;let i,r=0,a=[],n=[],o=!1;for(;null!==(i=t.exec(e));){a.push(i[0]);let l="";r<i.index-1&&(l=e.substring(r,i.index),!o&&s.test(l)&&(l="")),n.push(l),r=t.lastIndex}let l,d=[],c=[];if(a.forEach(((e,t)=>{let s;if(e.startsWith("</")){let i=e.substring(2,e.length-1).trim(),r=[];for(let e=t;d.length>0&&(e>=0&&""!==n[e]&&(r.push(this.handleText(n[e])),n[e]=""),(s=d.pop())!==i);e--){let e=c.pop();r=(e.children||[]).concat(r),r.unshift(e)}if(s!==i)throw new b("wrongTemplate");{let e=c.pop();e.children=(e.children||[]).concat(r),this.handleSlot(e),c.length>0&&c[c.length-1].add(e),o&&"pre"===i&&(o=!1)}}else{let s=e.endsWith("/>")?e.substring(1,e.length-2):e.substring(1,e.length-1);const[i,r]=this.handleTag(s.trim());"pre"===r&&(o=!0),t>0&&""!==n[t]&&(c[c.length-1].add(this.handleText(n[t])),n[t]=""),e.endsWith("/>")?c.length>0&&(c[c.length-1].children?c[c.length-1].children.push(i):c[c.length-1].children=[i]):(d.push(r),c.push(i)),l||(l=i)}})),d.length>0)throw new b("wrongTempate");return l}handleTag(e){const t=this;let s;const i=/('[\s\S]*?')|("[\s\S]*?")|(`[\s\S]*?`)|({{[\S\s]*?\}{0,2}\s*}})|([\w$-]+(\s*=)?)/g;let r,a,o,l,d=!0;const c=/[a-zA-Z$_]\S*/;for(;null!==(l=i.exec(e));){let e=l[0];c.test(e)?a?e.endsWith("=")?(r&&p(),r=e.substring(0,e.length-1).trim(),o=!0):r?o&&p(e):r=e:(a=e,s=new n(a,t.genKey())):r&&o&&p(e)}return r&&p(),this.postHandleNode(s),s.sortDirective(),s.allModelField=d,[s,a];function p(e){if(e){let i;null!==(i=/((?<=^')(.*?)(?='$))|((?<=^")(.*?)(?="$)|((?<=^`)(.*?)(?=`$)))/.exec(e))&&(e=i[0].trim()),/^\{\{[\S\s]*\}\}$/.test(e)&&(e=t.compileExpression(e,s)[0],d=e.allModelField)}r.startsWith("x-")?s.addDirective(new P(r.substr(2),e)):r.startsWith("e-")?s.addEvent(new h(r.substr(2),e)):s.setProp(r,e),r=void 0,o=!1}}handleSlot(e){if(e.hasDirective("module")){let t;for(let s=0;s<e.children.length;s++){let i=e.children[s];i.hasDirective("slot")||(t?e.children.splice(s--,1):(t=new n("div",this.genKey()),t.addDirective(new P("slot",null)),e.children.splice(s,1,t)),t.add(i))}}}handleText(e){let t=new n(null,this.genKey());return e=this.preHandleText(e),/\{\{[\s\S]+\}\}/.test(e)?t.expressions=this.compileExpression(e,t):t.textContent=e,t}compileExpression(e,t){if(!e)return;let s,i=/\{\{[\s\S]+?\}?\s*\}\}/g,r=new Array,a=0;for(;null!==(s=i.exec(e));){let i=s.index;if(i>a){let t=e.substring(a,i);r.push(t)}let n=new o(this.module,s[0].substring(2,s[0].length-2));t.allModelField=n.allModelField,r.push(n),a=i+s[0].length}return a<e.length-1&&r.push(e.substr(a)),r}postHandleNode(t){if(a.hasClass(t.tagName))t.addDirective(new P("module",t.tagName)),t.tagName="div";else if(e.has(t.tagName)){let s=e.get(t.tagName);Reflect.construct(s,[t,this.module])}}preHandleText(e){if(/&[a-z]+;/.test(e)){let t=document.createElement("div");return t.innerHTML=e,t.textContent}return e}genKey(){return this.elementId+++""}}class N{static compare(e,t,s){if(e.tagName){if(e.tagName!==t.tagName)r(5,e,null,t.parent);else if(e.staticNum||t.staticNum){let s=!1;for(let i of["props","assets"]){if(!e[i]&&t[i]||e[i]&&!t[i])s=!0;else if(e[i]&&t[i])if(e[i].size!==t[i].size)s=!0;else for(let r of e[i])if(r[1]!==t[i].get(r[0])){s=!0;break}s&&r(2,e,null,t.parent)}}}else t.tagName?r(5,e,null,t.parent):(e.staticNum||t.staticNum)&&e.textContent!==t.textContent&&r(2,e,null,t.parent);if(e.staticNum>0&&e.staticNum--,e.children&&0!==e.children.length)if(t.children&&0!==t.children.length){let a={},[n,o,l,d]=[0,t.children[0],t.children.length-1,t.children[t.children.length-1]],[c,h,p,u]=[0,e.children[0],e.children.length-1,e.children[e.children.length-1]];for(;n<=l&&c<=p;)if(i(o,h))N.compare(h,o,s),h=e.children[++c],o=t.children[++n];else if(i(d,u))N.compare(u,d,s),u=e.children[--p],d=t.children[--l];else if(i(h,d)){for(N.compare(h,d,s);a.hasOwnProperty(o.key);)s[a[o.key]][0]=4,delete a[o.key],o=t.children[++n];r(4,d,o,t),h=e.children[++c],d=t.children[--l]}else if(i(u,o)){for(N.compare(u,o,s);a.hasOwnProperty(d.key);)s[a[d.key]][0]=4,delete a[d.key],d=t.children[--l];r(4,o,d,t,1),u=e.children[--p],o=t.children[++n]}else{if(a.hasOwnProperty(o.key)){for(;a.hasOwnProperty(o.key);)s[a[o.key]][0]=4,delete a[o.key],o=t.children[++n];continue}a[h.key]=r(1,h,o,t)-1,h=e.children[++c]}if(n<=l||c<=p)if(n>l)for(let s=c;s<=p;s++)r(1,e.children[s],s,t);else for(let e=n;e<=l;e++){let i=t.children[e];a.hasOwnProperty(i.key)?s[a[i.key]][0]=4:r(3,i,null,t)}}else e.children.forEach((e=>r(1,e,null,t)));else t.children&&t.children.length>0&&t.children.forEach((e=>r(3,e,null,t)));function i(e,t){return e.key===t.key}function r(e,t,i,r,a){return s.push([e,t,i,r,a])}}}class D{constructor(e,t){e.hasProp("tag")?(e.tagName=e.getProp("tag"),e.delProp("tag")):e.tagName="div"}}class T{constructor(e){this.items=new Map,void 0!==e&&(this.moduleId=e.id)}add(e,t){this.items.set(e,t)}get(e){return this.items.get(e)}remove(e){this.items.delete(e)}has(e){return this.items.has(e)}}const W={TipWords:{application:"应用",system:"系统",module:"模块",moduleClass:"模块类",model:"模型",directive:"指令",directiveType:"指令类型",expression:"表达式",event:"事件",method:"方法",filter:"过滤器",filterType:"过滤器类型",data:"数据",dataItem:"数据项",route:"路由",routeView:"路由容器",plugin:"插件",resource:"资源",root:"根",element:"元素"},ErrorMsgs:{unknown:"未知错误",paramException:"{0}'{1}'方法参数错误，请参考api",invoke:"{0}方法调用参数{1}必须为{2}",invoke1:"{0}方法调用参数{1}必须为{2}或{3}",invoke2:"{0}方法调用参数{1}或{2}必须为{3}",invoke3:"{0}方法调用参数{1}不能为空",exist:"{0}已存在",exist1:"{0}'{1}'已存在",notexist:"{0}不存在",notexist1:"{0}'{1}'不存在",notupd:"{0}不可修改",notremove:"{0}不可删除",notremove1:"{0}{1}不可删除",namedinvalid:"{0}{1}命名错误，请参考用户手册对应命名规范",initial:"{0}初始化参数错误",jsonparse:"JSON解析错误",timeout:"请求超时",config:"{0}配置参数错误",config1:"{0}配置参数'{1}'错误",itemnotempty:"{0} '{1}' 配置项 '{2}' 不能为空",itemincorrect:"{0} '{1}' 配置项 '{2}' 错误",compile1:"{0}标签未闭合",compile2:"结束标签{0}未找到与之匹配的开始标签",compile3:"请检查模板标签闭合情况，模板需要有一个闭合的根节点",wrongTemplate:"模版格式错误"},FormMsgs:{type:"请输入有效的{0}",unknown:"输入错误",required:"不能为空",min:"最小输入值为{0}",max:"最大输入值为{0}"},WeekDays:{0:"日",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"}};class O{static addToDataMap(e,t){this.dataMap.set(e,t)}static delFromDataMap(e){this.dataMap.delete(e)}static getFromDataMap(e){return this.dataMap.get(e)}static hasDataModel(e){return this.dataMap.has(e)}static addModel(e,t){this.modelMap.has(e)?this.modelMap.get(e).model=t:this.modelMap.set(e,{model:t})}static delModel(e){this.modelMap.delete(e)}static getData(e){if(this.modelMap.has(e))return this.modelMap.get(e).data}static addWatcher(e,t,s){this.modelMap.has(e)||this.modelMap.set(e,{});let i=this.modelMap.get(e).watchers;i||(i={},this.modelMap.get(e).watchers=i),i[t]?i[t].push(s):i[t]=[s]}static removeWatcher(e,t,s){if(!this.modelMap.has(e)||!this.modelMap.get(e).watchers)return;let i=this.modelMap.get(e).watchers;if(!i[t])return;let r=i[t].findIndex(s);-1!==r&&i.splice(r,1)}static getWatcher(e,t){if(!this.modelMap.has(e))return;let s=this.modelMap.get(e).watchers;return s?s[t]:void 0}static bindToModule(e,t){let s=this.modelMap.get(e);if(!s)return;let i="number"==typeof t?t:t.id;if(s.modules){let e=s.modules;-1===e.indexOf(i)&&e.push(i)}else s.modules=[i];Object.getOwnPropertyNames(e).forEach((s=>{"object"==typeof e[s]&&e[s].$key&&O.bindToModule(e[s],t)}))}static bindToModules(e,t){let s=this.modelMap.get(e);if(s){if(s.modules){let e=s.modules;for(let s of t)-1===e.indexOf(s)&&e.push(s)}else s.modules=t;Object.getOwnPropertyNames(e).forEach((s=>{"object"==typeof e[s]&&e[s].$key&&O.bindToModules(e[s],t)}))}}static unbindFromModule(e,t){let s=this.modelMap.get(e);if(!s||!s.modules)return;let i,r="number"==typeof t?t:t.id,a=s.modules;-1===(i=a.indexOf(r))&&a.splice(i),Object.getOwnPropertyNames(e).forEach((s=>{"object"==typeof e[s]&&e[s].$key&&O.unbindFromModule(e[s],t)}))}static getModuleIds(e){let t=this.modelMap.get(e);if(t)return t.modules}static update(e,t,s,i,r){let n=this.modelMap.get(e);if(!n)return;let o=n.modules,l=[];for(let t of o){let s=a.get(t);l.push(s),s.changedModelMap.set(e.$key,!0)}let d=this.getWatcher(e,t);if(d)for(let t of d)for(let r of l)"string"==typeof t?(t=r.getMethod(t),t&&t.call(r,e,s,i)):t.call(r,e,s,i);if(s!==i||r)for(let e of l)u.add(e)}}O.dataMap=new WeakMap,O.modelMap=new WeakMap;class j{constructor(e,t){let s=new Proxy(e,{set:(e,t,i,r)=>{if(e[t]===i)return!0;if(["__proto__","constructor"].includes(t))return!0;return"function"!=typeof i&&-1===["$key"].indexOf(t)&&O.update(s,t,e[t],i),Reflect.set(e,t,i,r)},get:(e,i,r)=>{let a=Reflect.get(e,i,r);Array.isArray(e)&&-1!==["sort","fill"].indexOf(i)&&O.update(s,null,null,null,!0);let n=O.getFromDataMap(e[i]);if(n)return n;if(null!==a&&"object"==typeof a&&!e[i].$key){return new j(a,t)}return a},deleteProperty:function(e,t){return null!==e[t]&&"object"==typeof e[t]&&(O.delFromDataMap(e[t]),O.delModel(e[t])),delete e[t],O.update(s,t,null,null,!0),!0}});return s.$watch=this.$watch,s.$get=this.$get,s.$set=this.$set,s.$key=x.genId(),O.addToDataMap(e,s),O.addModel(s,e),t&&O.bindToModule(s,t),s}$watch(e,t,s){let i=this,r=-1;-1!==(r=e.lastIndexOf("."))&&(i=this.$get(e.substr(0,r)),e=e.substr(r+1)),i&&(s?O.removeWatcher(i,e,t):O.addWatcher(i,e,t))}$get(e){let t=this;if(-1!==e.indexOf(".")){let s=e.split(".");for(let e=0;e<s.length-1&&(t=t[s[e]],t);e++);if(!t)return;e=s[s.length-1]}return t[e]}$set(e,t,s){let i=this,r=O.getModuleIds(this);if(-1!==e.indexOf(".")){let t=e.split(".");for(let e=0;e<t.length-1;e++)if(!i[t[e]]){let s=new j({});O.bindToModules(s,r),i[t[e]]=s}e=t[t.length-1]}"object"==typeof t&&s&&O.bindToModule(t,s),i[e]=t}}class R{constructor(e){this.module=e,this.cache=new d}set(e,t){this.cache.set(e,t)}get(e){return this.cache.get(e)}remove(e){this.cache.remove(e)}getDirective(e){let t=this.cache.get("$directives."+e+".$instance");return!t&&(t=c.get("$directives."+e),c.removeDirective(e),t)?(this.cache.set("$directives."+e,t),t.$instance):t}saveDirective(e){this.cache.set("$directives."+e.id+".$instance",e)}removeDirective(e){this.cache.remove("$directives."+e)}setDirectiveParam(e,t,s,i){this.cache.set("$doms."+t+"$directives."+e+".$params."+s,i)}getDirectiveParam(e,t,s){return this.cache.get("$doms."+t+"$directives."+e+".$params."+s)}removeDirectiveParam(e,t,s){this.cache.remove("$doms."+t+"$directives."+e+".$params."+s)}clearDirectiveParam(e,t){this.cache.remove("$doms."+t+"$directives."+e+".$params."+name)}getExpression(e){let t=this.cache.get("$expressions."+e);return!t&&(t=c.get("$expressions."+e),c.removeExpression(e),t)?(this.cache.set("$expressions."+e,t),t):t}saveExpression(e){this.cache.set("$expressions."+e.id,e)}removeExpression(e){this.cache.remove("$expressions."+e)}getEvent(e){let t=this.cache.get("$events."+e+".$instance");return!t&&(t=c.get("$events."+e),c.removeEvent(e),t)?(this.cache.set("$events."+e,t),t.$instance):t}saveEvent(e){this.cache.set("$events."+e.id+".$instance",e)}removeEvent(e){this.cache.remove("$events."+e)}setEventParam(e,t,s,i){this.cache.set("$doms."+t+"$events."+e+".$params."+s,i)}getEventParam(e,t,s){return this.cache.get("$doms."+t+"$events."+e+".$params."+s)}removeEventParam(e,t,s){this.cache.remove("$doms."+t+"$events."+e+".$params."+s)}clearEventParam(e,t){this.cache.remove("$doms."+t+"$events."+e+".$params")}saveElement(e){this.cache.set("$doms."+e.key,e)}getElement(e){return this.cache.get("$doms."+e)}removeElement(e){this.cache.remove("$doms."+e)}removeSavedNode(e){this.cache.remove("$doms."+e)}setElementParam(e,t,s){this.cache.set("$doms."+e+".$params."+t,s)}getElementParam(e,t){return this.cache.get("$doms."+e+".$params."+t)}removeElementParam(e,t){this.cache.remove("$doms."+e+".$params."+t)}clearElementParams(e){this.cache.remove("$doms."+e+".$params")}clearDirectives(){this.remove("$directives")}clearExpressions(){this.remove("$directives")}clearEvents(){this.remove("$directives")}clearSaveDoms(){this.remove("$doms")}}class S{constructor(){this.children=[],this.preRenderOps=[],this.postRenderOps=[],this.keyNodeMap=new Map,this.id=x.genId(),this.objectManager=new R(this),this.changedModelMap=new Map,a.add(this)}init(){if(this.state=1,this.model=new j(this.data()||{},this),this.modules&&Array.isArray(this.modules)){for(let e of this.modules)a.addClass(e);delete this.modules}}template(e){return null}data(){return{}}render(){if(this.dontAddToRender=!0,this.originTree||this.compile(),this.originTree){if(this.doRenderOps(0),this.doModuleEvent("onBeforeRender"),this.renderTree){if(this.model){let e=this.renderTree;this.renderTree=u.renderDom(this,this.originTree,this.model),this.doModuleEvent("onBeforeRenderToHtml");let t=[];N.compare(this.renderTree,e,t),t.length>0&&u.handleChangedDoms(this,t)}}else this.doFirstRender();this.state=2,this.doRenderOps(1),this.doModuleEvent("onRender"),this.changedModelMap.clear(),this.dontAddToRender=!1}}doFirstRender(){this.doModuleEvent("onBeforeFirstRender"),this.renderTree=u.renderDom(this,this.originTree,this.model),this.doModuleEvent("onBeforeFirstRenderToHTML");let e=u.renderToHtml(this,this.renderTree,null,!0);this.replaceContainer?(["style","class"].forEach((t=>{let s=this.container.getAttribute(t);if(!s)return;s=s.trim();let i=e.getAttribute(t)||"";s+="style"===t?(s.endsWith(";")?"":";")+i:" "+i,e.setAttribute(t,s)})),x.replaceNode(this.container,e)):(x.empty(this.container),this.container.appendChild(e)),this.doModuleEvent("onFirstRender")}addChild(e){let t;"number"==typeof e?(t=e,e=a.get(t)):t=e.id,this.children.includes(t)||(this.children.push(t),e.parentId=this.id)}active(){u.add(this);for(let e of this.children){let t=a.get(e);t&&t.active()}}unactive(){if(a.getMain()!==this){this.state=1,delete this.container,delete this.renderTree,this.keyNodeMap.clear(),this.clearCache();for(let e of this.children){let t=a.get(e);t&&t.unactive()}}}destroy(){x.isArray(this.children)&&this.children.forEach((e=>{let t=a.get(e);t&&t.destroy()})),this.clearCache(!0),a.remove(this.id)}getParent(){if(this.parentId)return a.get(this.parentId)}doModuleEvent(e){this.invokeMethod(e,this.model)}getMethod(e){return this[e]}setContainer(e,t){this.container=e,this.replaceContainer=t}invokeMethod(e,t,s,i){let r=this[e];if(r&&"function"==typeof r){let e=[];for(let t=1;t<arguments.length;t++)e.push(arguments[t]);return r.apply(this,e)}}addRenderOps(e,t,s,i){if("function"!=typeof e)return;(0===t?this.preRenderOps:this.postRenderOps).push({foo:e,args:s,once:i})}doRenderOps(e){let t=0===e?this.preRenderOps:this.postRenderOps;if(t)for(let e=0;e<t.length;e++){let s=t[e];s.foo.apply(this,s.args),s.once&&t.splice(e--,1)}}setProps(e){let t=!1,s=e.$data;if(delete e.$data,this.props){const s=Object.getOwnPropertyNames(e);if(s.length!==(this.props?Object.getOwnPropertyNames(this.props):[]).length)t=!0;else for(let i of s)if(e[i]!==this.props[i]||"object"==typeof e[i]){t=!0;break}}else t=!0;if(s)for(let e in s){let t=s[e];"object"==typeof t?(O.bindToModule(t,this),this.model[e]=t):this.props&&void 0!==this.model[e]||(this.model[e]=t)}this.props=e,t&&(this.compile(),this.active())}compile(){this.clearCache();const e=this.template(this.props);e&&(this.originTree=new E(this).compile(e))}clearCache(e){e?this.objectManager.cache=new d:(this.objectManager.clearSaveDoms(),this.objectManager.clearDirectives(),this.objectManager.clearExpressions(),this.objectManager.clearEvents(),l.clearModuleRules(this))}getNode(e){return this.keyNodeMap.get(e)}saveNode(e,t){this.keyNodeMap.set(e,t)}}e.add([class extends D{constructor(e,t){super(e,t);let s=e.getProp("name");if(!s)throw new b("itemnotempty",v.TipWords.element,"MODULE","className");e.delProp("name"),e.addDirective(new P("module",s))}},class extends D{constructor(e,t){super(e,t);let s=e.getProp("cond");if(!s)throw new b("itemnotempty",v.TipWords.element,"FOR","cond");e.delProp("cond"),"number"==typeof s&&(s=c.getExpression(s)),e.addDirective(new P("repeat",s))}},class extends D{constructor(e,t){super(e,t);let s=e.getProp("cond");if(!s)throw new b("itemnotempty",v.TipWords.element,"IF","cond");e.delProp("cond"),"number"==typeof s&&(s=c.getExpression(s)),e.addDirective(new P("if",s))}},class extends D{constructor(e,t){super(e,t);let s=e.getProp("cond");e.delProp("cond"),"number"==typeof s&&(s=c.getExpression(s)),e.addDirective(new P("recur",s))}},class extends D{constructor(e,t){super(e,t),e.addDirective(new P("else",null))}},class extends D{constructor(e,t){super(e,t);let s=e.getProp("cond");if(!s)throw new b("itemnotempty",v.TipWords.element,"ELSEIF","cond");e.delProp("cond"),"number"==typeof s&&(s=c.getExpression(s)),e.addDirective(new P("elseif",s))}},class extends D{constructor(e,t){super(e,t),e.addDirective(new P("endif",null))}},class extends D{constructor(e,t){super(e,t);let s=e.getProp("name")||"default";e.delProp("name"),e.addDirective(new P("slot",s))}}]),w("module",(function(e,t,s){let i,r=t.getParam(e,"moduleId"),n=!0;if(r)i=a.get(r),n=!t.getProp("renderOnce");else{if(i=a.get(this.value),!i)return!0;r=i.id,t.setParam(e,"moduleId",r),e.addChild(i),t.hasProp("useDomModel")&&(i.model=t.model,O.bindToModule(i.model,i),t.delProp("useDomModel"))}if(t.subModuleId=r,n){let e={};if(t.props)for(let s of t.props)"$"===s[0][0]?(e.$data||(e.$data={}),e.$data[s[0].substr(1)]=s[1],t.delProp(s[0])):e[s[0]]=s[1];i.setProps(e)}return!0}),8),w("model",(function(e,t,s){let i=t.model.$get(this.value);return i&&(t.model=i),!0}),1),w("repeat",(function(e,t,s){let i=this.value;if(console.log(i),!x.isArray(i)||0===i.length)return!1;const r=s.getProp("$index"),a=t.parent;this.disabled=!0;for(let t=0;t<i.length;t++){r&&(i[t][r]=t),s.staticNum++;let n=u.renderDom(e,s,i[t],a,i[t].$key);r&&n.delProp("$index")}return this.disabled=!1,!1}),2),w("recur",(function(e,t,s){if(t.hasProp("ref")){s.children=[];const i="$recurs."+(t.getProp("ref")||"default");let r=e.objectManager.get(i);if(!r)return!0;let a=t.model[r.getDirective("recur").value];if(!a)return!0;let n,o=r.clone();Array.isArray(a)?n=t.model.$key:(o.model=a,n=a.$key,x.setNodeKey(o,n,!0)),s.children=[o]}else{if(!t.model[this.value])return!0;const i="$recurs."+(t.getProp("name")||"default");e.objectManager.get(i)||e.objectManager.set(i,s.clone())}return!0}),2),w("if",(function(e,t,s){return t.parent.setParam(e,"$if",this.value),this.value}),5),w("else",(function(e,t,s){return!1===t.parent.getParam(e,"$if")}),5),w("elseif",(function(e,t,s){return!0!==t.parent.getParam(e,"$if")&&!!this.value&&(t.parent.setParam(e,"$if",!0),!0)}),5),w("endif",(function(e,t,s){return t.parent.removeParam(e,"$if"),!0}),5),w("show",(function(e,t,s){return this.value}),5),w("field",(function(e,t,s){const i=this,r=t.getProp("type")||"text",a=t.tagName.toLowerCase(),n=t.model;if(!n)return!0;let o=n.$get(this.value);if("radio"===r)o==t.getProp("value")?(t.setProp("checked",!0),t.setAsset("checked","checked")):(t.setAsset("checked",!1),t.delProp("checked"));else if("checkbox"===r){let e=t.getProp("yes-value");o==e?(t.setProp("value",e),t.setAsset("checked","checked")):(t.setProp("value",t.getProp("no-value")),t.setAsset("checked",!1))}else if("select"===a)t.setAsset("value",o),t.setProp("value",o);else{let e=null!=o?o:"";t.setAsset("value",e),t.setProp("value",e)}return this.getParam(e,t,"inited")||(t.addEvent(new h("change",(function(t,s){let r=e.getNode(s.key);if(!r)return;let a=s.getProp("type"),n=i.value,o=r.value;"checkbox"===a?o=s.getProp("yes-value")==o?s.getProp("no-value"):s.getProp("yes-value"):"radio"===a&&(r.checked||(o=void 0));let l=this,d=n.split(".");if(1===d.length)t[n]=o;else{n=d.pop();for(let e=0;e<d.length;e++)l=l[d[e]];l[n]=o}"radio"!==a&&(s.setProp("value",o),r.value=o)}))),this.setParam(e,t,"inited",!0)),!0}),10),w("route",(function(e,t,s){if(!this.value)return!0;if("a"===t.tagName.toLowerCase()&&t.setProp("href","javascript:void(0)"),t.setProp("path",this.value),t.hasProp("active")){let s=t.getProp("active");t.delProp("active"),m.addActiveField(e,this.value,t.model,s),this.value.startsWith(m.currentPath)&&t.model[s]&&m.go(this.value)}let i=e.objectManager.get("$routeClickEvent");return i||(i=new h("click",((e,t,s)=>{let i=t.getProp("path");i||(i=t.getDirective("route").value),x.isEmpty(i)||m.go(i)})),e.objectManager.set("$routeClickEvent",i)),t.addEvent(i),!0})),w("router",(function(e,t,s){return m.routerKeyMap.set(e.id,t.key),!0})),w("slot",(function(e,t,s){this.value=this.value||"default";let i=t.parent.subModuleId;if(console.log(i,this.value),i){let e=a.get(i);return e&&e.objectManager.set("$slots."+this.value,{dom:s.clone(),model:t.model}),!1}{let i=e.objectManager.get("$slots."+this.value);if(console.log(i,"cfg"),i){let r=i.dom;for(let e of r.children)x.setNodeKey(e,t.key,!0);if(s.children=r.children,!s.hasProp("innerRender"))for(let e of s.children)e.model=i.model;e.objectManager.remove("$slots."+this.value)}}return!0}),5),p.regist("tap",{touchstart(e,t,s,i){let r=i.touches[0];s.dependEvent.setParam(t,e,"pos",{sx:r.pageX,sy:r.pageY,t:Date.now()})},touchmove(e,t,s,i){let r=s.dependEvent.getParam(t,e,"pos");if(!r)return;let a=i.touches[0],n=a.pageX-r.sx,o=a.pageY-r.sy;(Math.abs(n)>5||Math.abs(o)>5)&&(r.move=!0)},touchend(e,t,s,i){let r=s.dependEvent.getParam(t,e,"pos");if(!r)return;s.dependEvent.removeParam(t,e,"pos");let a=Date.now()-r.t;if(!r.move&&a<200){let r=s.dependEvent.handler;"string"==typeof r&&(r=t.getMethod(r)),r&&r.apply(t,[e.model,e,s.dependEvent,i])}}}),p.regist("swipe",{touchstart(e,t,s,i){let r=i.touches[0],a=Date.now();s.dependEvent.setParam(t,e,"swipe",{oldTime:[a,a],speedLoc:[{x:r.pageX,y:r.pageY},{x:r.pageX,y:r.pageY}],oldLoc:{x:r.pageX,y:r.pageY}})},touchmove(e,t,s,i){let r=Date.now(),a=i.touches[0],n=s.dependEvent.getParam(t,e,"swipe");r-n.oldTime[1]>50&&(n.speedLoc[0]={x:n.speedLoc[1].x,y:n.speedLoc[1].y},n.speedLoc[1]={x:a.pageX,y:a.pageY},n.oldTime[0]=n.oldTime[1],n.oldTime[1]=r),n.oldLoc={x:a.pageX,y:a.pageY}},touchend(e,t,s,i){let r=s.dependEvent.getParam(t,e,"swipe"),a=Date.now(),n=a-r.oldTime[1]<30?0:1,o=r.oldLoc.x-r.speedLoc[n].x,l=r.oldLoc.y-r.speedLoc[n].y,d=Math.sqrt(o*o+l*l),c=a-r.oldTime[n];if(c>300||d<10)return;let h=d/c;if(h>.05){let r="";if(o<0&&Math.abs(l/o)<1&&(i.v0=h,r="swipeleft"),o>0&&Math.abs(l/o)<1&&(i.v0=h,r="swiperight"),l>0&&Math.abs(o/l)<1&&(i.v0=h,r="swipedown"),l<0&&Math.abs(o/l)<1&&(i.v0=h,r="swipeup"),s.dependEvent.name===r){let r=s.dependEvent.handler;"string"==typeof r&&(r=t.getMethod(r)),r&&r.apply(t,[e.model,e,s.dependEvent,i])}}}}),p.regist("swipeleft",p.get("swipe")),p.regist("swiperight",p.get("swipe")),p.regist("swipeup",p.get("swipe")),p.regist("swipedown",p.get("swipe"));export{E as Compiler,l as CssManager,N as DiffTool,P as Directive,D as DirectiveElement,e as DirectiveElementManager,s as DirectiveManager,t as DirectiveType,p as EventManager,o as Expression,c as GlobalCache,j as Model,O as ModelManager,S as Module,a as ModuleFactory,d as NCache,b as NError,h as NEvent,T as NFactory,v as NodomMessage,r as NodomMessage_en,W as NodomMessage_zh,u as Renderer,f as Route,m as Router,g as Scheduler,x as Util,n as VirtualDom,w as createDirective,M as createRoute,y as nodom,k as registModule,$ as request};
//# sourceMappingURL=nodom.js.map
