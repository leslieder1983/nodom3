{"version":3,"file":"nodom.js","sources":["../core/directiveelementmanager.ts","../core/directivetype.ts","../core/directivemanager.ts","../node_modules/tslib/tslib.es6.js","../core/locales/msg_en.ts","../core/modulefactory.ts","../core/virtualdom.ts","../core/expression.ts","../core/cssmanager.ts","../core/cache.ts","../core/globalcache.ts","../core/event.ts","../core/eventmanager.ts","../core/renderer.ts","../core/router.ts","../core/route.ts","../core/scheduler.ts","../core/nodom.ts","../core/error.ts","../core/util.ts","../core/directive.ts","../core/compiler.ts","../core/difftool.ts","../core/directiveelement.ts","../core/factory.ts","../core/locales/msg_zh.ts","../core/modelmanager.ts","../core/model.ts","../core/objectmanager.ts","../core/module.ts","../extend/elementinit.ts","../extend/directiveinit.ts","../extend/eventinit.ts"],"sourcesContent":["import { DirectiveElement } from \"./directiveelement\";\r\n\r\n/**\r\n * 自定义元素管理器\r\n */\r\nexport class DirectiveElementManager {\r\n    /**\r\n     * 自定义element\r\n     */\r\n    private static elements: Map<string, DirectiveElement> = new Map();\r\n    /**\r\n     * 添加自定义元素类\r\n     * @param clazz  自定义元素类或类数组\r\n     */\r\n    public static add(clazz:any) {\r\n        if(Array.isArray(clazz)){\r\n            for(let c of clazz){\r\n                this.elements.set(c.name, c);\r\n            }\r\n        }else{\r\n            this.elements.set(clazz.name, clazz);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取自定义元素类\r\n     * @param tagName   元素名\r\n     * @returns         自定义元素类\r\n     */\r\n    public static get(tagName: string): any {\r\n        return this.elements.get(tagName.toUpperCase());\r\n    }\r\n\r\n    /**\r\n     * 是否存在自定义元素\r\n     * @param tagName   元素名\r\n     * @returns         存在或不存在\r\n     */\r\n    public static has(tagName:string):boolean{\r\n        return this.elements.has(tagName.toUpperCase());\r\n    }\r\n}\r\n","/**\r\n * 指令类\r\n */\r\nexport  class DirectiveType {\r\n    /**\r\n     * 指令类型名\r\n     */\r\n    public name:string;\r\n    \r\n    /**\r\n     * 优先级，越小优先级越高\r\n     */\r\n    public prio:number;\r\n\r\n    /**\r\n     * 渲染时执行方法\r\n     */\r\n    public handle:Function;\r\n    \r\n    /**\r\n     * 构造方法\r\n     * @param name      指令类型名       \r\n     * @param handle    渲染时执行方法\r\n     * @param prio      类型优先级\r\n     */ \r\n    constructor(name:string,handle:Function, prio?:number) {\r\n        this.name = name;\r\n        this.prio = prio>=0?prio:10;\r\n        this.handle = handle;\r\n    }\r\n}\r\n","import { DirectiveType } from \"./directivetype\";\r\n/**\r\n * 指令管理器\r\n */\r\nexport  class DirectiveManager {\r\n    /**\r\n     * 指令类型集合\r\n     */\r\n    private static directiveTypes:Map<string,DirectiveType> = new Map();\r\n    \r\n    /**\r\n     * 创建指令类型\r\n     * @param name \t\t    指令类型名\r\n     * @param config \t    配置对象{order:优先级,init:初始化函数,handler:渲染处理函数}\r\n     */\r\n    public static addType(name:string,handle:Function,prio?:number) {\r\n        this.directiveTypes.set(name, new DirectiveType(name,handle,prio));\r\n    }\r\n\r\n    /**\r\n     * 移除过滤器类型\r\n     * @param name  过滤器类型名\r\n     */\r\n    public static removeType(name:string) {\r\n        this.directiveTypes.delete(name);\r\n    }\r\n\r\n    /**\r\n     * 获取类型\r\n     * @param name  指令类型名\r\n     * @returns     指令或undefined\r\n     */\r\n    public static getType(name:string) {\r\n        return this.directiveTypes.get(name);\r\n    }\r\n\r\n    /**\r\n     * 是否有某个过滤器类型\r\n     * @param type \t\t过滤器类型名\r\n     * @returns \t\ttrue/false\r\n     */\r\n    public static hasType(name:string) {\r\n        return this.directiveTypes.has(name);\r\n    }\r\n}\r\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","/*\r\n * 消息js文件 中文文件\r\n */\r\nexport const NodomMessage_en = {\r\n    /**\r\n     * tip words\r\n     */\r\n    TipWords:{\r\n        application:\"Application\",\r\n        system:\"System\",\r\n        module:\"Module\",\r\n        moduleClass:'ModuleClass',\r\n        model:\"Model\",\r\n        directive:\"Directive\",\r\n        directiveType:\"Directive-type\",\r\n        expression:\"Expression\",\r\n        event:\"Event\",\r\n        method:\"Method\",\r\n        filter:\"Filter\",\r\n        filterType:\"Filter-type\",\r\n        data:\"Data\",\r\n        dataItem:'Data-item',\r\n        route:'Route',\r\n        routeView:'Route-container',\r\n        plugin:'Plugin',\r\n        resource:'Resource',\r\n        root:'Root',\r\n        element:'VirtualDom'\r\n    },\r\n    /**\r\n     * error info\r\n     */\r\n    ErrorMsgs:{\r\n        unknown:\"unknown error\",\r\n        paramException:\"{0} '{1}' parameter error，see api\",\r\n        invoke:\"method {0} parameter {1} must be {2}\",\r\n        invoke1:\"method {0} parameter {1} must be {2} or {3}\",\r\n        invoke2:\"method {0} parameter {1} or {2} must be {3}\",\r\n        invoke3:\"method {0} parameter {1} not allowed empty\",\r\n        exist:\"{0} is already exist\",\r\n        exist1:\"{0} '{1}' is already exist\",\r\n        notexist:\"{0} is not exist\",\r\n        notexist1:\"{0} '{1}' is not exist\",\r\n        notupd:\"{0} not allow to change\",\r\n        notremove:\"{0} not allow to delete\",\r\n        notremove1:\"{0} {1} not allow to delete\",\r\n        namedinvalid:\"{0} {1} name error，see name rules\",\r\n        initial:\"{0} init parameter error\",\r\n        jsonparse:\"JSON parse error\",\r\n        timeout:\"request overtime\",\r\n        config:\"{0} config parameter error\",\r\n        config1:\"{0} config parameter '{1}' error\",\r\n        itemnotempty:\"{0} '{1}' config item '{2}' not allow empty\",\r\n\t\titemincorrect:\"{0} '{1}' config item '{2}' error\",\r\n        wrongTemplate:\"wrong template\"\r\n    },\r\n\r\n    /**\r\n     * form info\r\n     */\r\n    FormMsgs:{\r\n        type:\"please input valid {0}\",\r\n        unknown:\"input error\",\r\n        required:\"is required\",\r\n        min:\"min value is {0}\",\r\n        max:\"max value is {0}\"\r\n    },\r\n    WeekDays:{\r\n\t\t\"0\" : \"Sun\",\r\n\t\t\"1\" : \"Mon\",\r\n\t\t\"2\" : \"Tue\",\r\n\t\t\"3\" : \"Wed\",\r\n\t\t\"4\" : \"Thu\",\r\n\t\t\"5\" : \"Fri\",\r\n\t\t\"6\" : \"Sat\"\r\n\t}\r\n}\r\n","import { Module } from \"./module\";\r\n\r\n/**\r\n * 过滤器工厂，存储模块过滤器\r\n */\r\nexport class ModuleFactory {\r\n    /**\r\n     * 模块对象工厂 {moduleId:{key:容器key,className:模块类名,instance:模块实例}}\r\n     */\r\n    private static modules: Map<number, Module> = new Map();\r\n\r\n    /**\r\n     * 模块类集合 {className:class}\r\n     */\r\n    public static classes: Map<string, any> = new Map();\r\n\r\n    /**\r\n     * 主模块\r\n     */\r\n    private static mainModule: Module;\r\n    /**\r\n     * 添加模块到工厂\r\n     * @param item  模块对象\r\n     */\r\n    public static add(item:Module) {\r\n        // //第一个为主模块\r\n        if(this.modules.size === 0){\r\n            this.mainModule = item;\r\n        }\r\n        this.modules.set(item.id, item);\r\n\r\n        //添加模块类\r\n        this.addClass(item.constructor);\r\n    }\r\n\r\n    /**\r\n     * 获得模块\r\n     * @param name  类、类名或实例id\r\n     */\r\n    public static get(name:any): Module {\r\n        if(typeof name === 'number'){\r\n            return this.modules.get(name);\r\n        }else{\r\n            return this.getInstance(name);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 是否存在模块类\r\n     * @param clazzName     模块类名\r\n     * @returns     true/false\r\n     */\r\n    public static hasClass(clazzName:string):boolean{\r\n        return this.classes.has(clazzName);\r\n    }\r\n\r\n    /**\r\n     * 添加模块类\r\n     * @param clazz     模块类\r\n     * @param name      注册别名\r\n     */\r\n    public static addClass(clazz:any,name?:string){\r\n        if(this.classes.has(clazz.name)){\r\n            return;\r\n        }\r\n        this.classes.set(clazz.name,clazz);\r\n        if(name){\r\n            this.classes.set(name,clazz);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取模块实例（通过类名）\r\n     * @param className     模块类或类名\r\n     * @param props         模块外部属性\r\n     */\r\n    private static getInstance(clazz:any): Module {\r\n        let className = (typeof clazz === 'string')?clazz:clazz.name;\r\n        let cls;\r\n        // 初始化模块\r\n        if(!this.classes.has(className) && typeof clazz === 'function'){\r\n            cls = clazz;\r\n        }else{\r\n            cls = this.classes.get(className);\r\n        }\r\n        \r\n        if(!cls){\r\n            return;\r\n        }\r\n\r\n        let m:Module = Reflect.construct(cls, []);\r\n        m.init();\r\n        return m;\r\n    }\r\n    /**\r\n     * 从工厂移除模块\r\n     * @param id    模块id\r\n     */\r\n    static remove(id: number) {\r\n        this.modules.delete(id);\r\n    }\r\n    /**\r\n     * 设置主模块\r\n     * @param m \t模块 \r\n     */\r\n    static setMain(m: Module) {\r\n        this.mainModule = m;\r\n    }\r\n\r\n    /**\r\n     * 获取主模块\r\n     * @returns \t应用的主模块\r\n     */\r\n    static getMain() {\r\n        return this.mainModule;\r\n    }\r\n}\r\n","import { Directive } from \"./directive\";\r\nimport { DirectiveManager } from \"./directivemanager\";\r\nimport { NEvent } from \"./event\";\r\nimport { Expression } from \"./expression\";\r\nimport { Model } from \"./model\";\r\nimport { Module } from \"./module\";\r\nimport { Util } from \"./util\";\r\n\r\n/**\r\n * 虚拟dom\r\n */\r\nexport class VirtualDom {\r\n    /**\r\n     * 元素名，如div\r\n     */\r\n    public tagName: string;\r\n\r\n    /**\r\n     * key，整颗虚拟dom树唯一\r\n     */\r\n    public key: string;\r\n\r\n    /**\r\n     * 绑定模型\r\n     */\r\n    public model: Model;\r\n\r\n    /**\r\n     * element为textnode时有效\r\n     */\r\n    public textContent: string;\r\n\r\n    /**\r\n     * 表达式+字符串数组，用于textnode\r\n     */\r\n    public expressions: Array<Expression | string>;\r\n\r\n    /**\r\n     * 指令集\r\n     */\r\n    public directives: Directive[];\r\n\r\n    /**\r\n     * 直接属性 不是来自于attribute，而是直接作用于html element，如el.checked,el.value等\r\n     */\r\n    public assets: Map<string, any>;\r\n\r\n    /**\r\n     * 静态属性(attribute)集合\r\n     * {prop1:value1,...}\r\n     */\r\n    public props: Map<string,any>;\r\n\r\n    /**\r\n     * 事件集合,{eventName1:nodomNEvent1,...}\r\n     * 一个事件名，可以绑定多个事件方法对象\r\n     */\r\n    public events: Map<string, number[]>;\r\n\r\n    /**\r\n     * 子节点数组[]\r\n     */\r\n    public children: Array<VirtualDom>;\r\n\r\n    /**\r\n     * 父虚拟dom\r\n     */\r\n    // public parent: VirtualDom;\r\n\r\n    /**\r\n     * staticNum 静态标识数\r\n     *  0 表示静态，不进行比较\r\n     *  > 0 每次比较后-1\r\n     *  < 0 不处理\r\n     */\r\n    public staticNum:number = 0;\r\n\r\n    /**\r\n     * 对应的所有表达式的字段都属于dom model内\r\n     */\r\n    public allModelField:boolean=true;\r\n\r\n    /**\r\n     * 未改变标志，本次不渲染\r\n     */\r\n    public notChange:boolean;\r\n\r\n    /**\r\n     * 子模块id，模块容器时有效\r\n     */\r\n    public subModuleId:number;\r\n\r\n    /**\r\n     * 不添加到树\r\n     */\r\n    public dontAddToTree:boolean;\r\n\r\n    /**\r\n     * 父dom\r\n     */\r\n    public parent:VirtualDom;\r\n\r\n    /**\r\n     * @param tag       标签名\r\n     * @param key       key\r\n     */\r\n    constructor(tag?: string,key?:string) {\r\n        this.key = key || (Util.genId()+'');\r\n        if(tag){\r\n            this.tagName = tag;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 移除多个指令\r\n     * @param directives \t待删除的指令类型数组或指令类型\r\n     */\r\n    public removeDirectives(directives: string[]) {\r\n        if(!this.directives){\r\n            return;\r\n        }\r\n        \r\n        //数组\r\n        directives.forEach(d=>{\r\n            this.removeDirective(d);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 移除指令\r\n     * @param directive \t待删除的指令类型名\r\n     */\r\n    public removeDirective(directive: string) {\r\n        if(!this.directives){\r\n            return;\r\n        }\r\n        \r\n        let ind;\r\n        if ((ind = this.directives.findIndex(item => item.type.name === directive)) !== -1) {\r\n            this.directives.splice(ind, 1);\r\n        }\r\n        if(this.directives.length === 0){\r\n            delete this.directives;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 添加指令\r\n     * @param directive     指令对象\r\n     * @param sort          是否排序\r\n     */\r\n    public addDirective(directive: Directive, sort?: boolean) {\r\n        if(!this.directives){\r\n            this.directives = [];\r\n        }else if(this.directives.find(item=>item.type.name === directive.type.name)){\r\n            return;\r\n        }\r\n        this.directives.push(directive);\r\n        //指令按优先级排序\r\n        if (sort) {\r\n            this.sortDirective();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 指令排序\r\n     */\r\n    public sortDirective(){\r\n        if(!this.directives){\r\n            return;\r\n        }\r\n        if (this.directives.length > 1) {\r\n            this.directives.sort((a, b) => {\r\n                return DirectiveManager.getType(a.type.name).prio < DirectiveManager.getType(b.type.name).prio?-1:1;\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 是否有某个类型的指令\r\n     * @param typeName \t    指令类型名\r\n     * @returns             true/false\r\n     */\r\n    public hasDirective(typeName:string): boolean {\r\n        return this.directives && this.directives.findIndex(item => item.type.name === typeName) !== -1;\r\n    }\r\n\r\n    /**\r\n     * 获取某个类型的指令\r\n     * @param module            模块\r\n     * @param directiveType \t指令类型名\r\n     * @returns                 指令对象\r\n     */\r\n    public getDirective(directiveType:string): Directive {\r\n        if(!this.directives){\r\n            return;\r\n        }\r\n        return this.directives.find(item => item.type.name === directiveType);\r\n    }\r\n\r\n    /**\r\n     * 添加子节点\r\n     */\r\n    public add(dom:VirtualDom){\r\n        if(!this.children){\r\n            this.children = [];\r\n        }\r\n        this.children.push(dom);\r\n    }\r\n    /**\r\n     * 是否存在某个class\r\n     * @param cls   classname\r\n     * @return      true/false\r\n     */\r\n    public hasClass(cls: string): boolean {\r\n        let clazz = this.getProp('class');\r\n        if (!clazz) {\r\n            return false;\r\n        } else {\r\n            return clazz.trim().split(/\\s+/).includes(cls);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 添加css class\r\n     * @param cls class名\r\n     */\r\n    public addClass(cls: string) {\r\n        let clazz = this.getProp('class');\r\n        if (!clazz || clazz === '') {\r\n            this.setProp('class', cls);\r\n            this.setStaticOnce();\r\n        } else {\r\n            let sa: any[] = clazz.trim().split(/\\s+/);\r\n            if (!sa.includes(cls)) {\r\n                sa.push(cls);\r\n                clazz = sa.join(' ');\r\n                this.setProp('class',clazz);\r\n                this.setStaticOnce();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 删除css class\r\n     * @param cls class名\r\n     */\r\n    public removeClass(cls: string) {\r\n        let clazz = this.getProp('class');\r\n        if (!clazz || clazz === '') {\r\n            return;\r\n        } else {\r\n            let sa: string[] = clazz.trim().split(/\\s+/);\r\n            let index;\r\n            if ((index = sa.indexOf(cls)) !== -1) {\r\n                sa.splice(index, 1);\r\n                clazz = sa.join(' ');\r\n            }\r\n        }\r\n        this.setProp('class',clazz);\r\n    }\r\n    /**\r\n     * 查询style\r\n     * @param styStr style字符串\r\n     */\r\n    public hasStyle(styStr: string) {\r\n        let styleStr = this.getProp('style');\r\n        if (!styleStr) {\r\n            return false;\r\n        } else {\r\n            return styleStr.trim().split(/;\\s+/).includes(styStr);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 添加style\r\n     *  @param styStr style字符串\r\n     */\r\n    public addStyle(styStr: string) {\r\n        let styleStr = this.getProp('style');\r\n        if (!styleStr) {\r\n            this.setProp('style', styStr);\r\n            this.setStaticOnce();\r\n        } else {\r\n            let sa: any[] = styleStr.trim().split(/;\\s+/);\r\n            if (!sa.includes(styStr)) {\r\n                sa.push(styStr);\r\n                styleStr = sa.join(';');\r\n                this.setProp('style',styleStr);\r\n                this.setStaticOnce();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 删除style\r\n     * @param styStr style字符串\r\n     */\r\n    public removeStyle(styStr: string) {\r\n        let styleStr = this.getProp('style');\r\n        if (!styleStr) {\r\n            return;\r\n        } else {\r\n            let sa: string[] = styleStr.trim().split(/;\\s+/);\r\n            let index;\r\n            if ((index = sa.indexOf(styStr)) !== -1) {\r\n                sa.splice(index, 1);\r\n                styleStr = sa.join(';');\r\n            }\r\n        }\r\n        this.setProp('style',styleStr);\r\n        this.setStaticOnce();\r\n    }\r\n\r\n    /**\r\n     * 是否拥有属性\r\n     * @param propName  属性名\r\n     * @param isExpr    是否只检查表达式属性\r\n     */\r\n    public hasProp(propName: string) {\r\n        if(this.props){\r\n            return this.props.has(propName);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取属性值\r\n     * @param propName  属性名\r\n     * @param isExpr    是否只获取表达式属性\r\n     */\r\n    public getProp(propName: string,isExpr?:boolean) {\r\n        if(this.props){\r\n            return this.props.get(propName);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置属性值\r\n     * @param propName  属性名\r\n     * @param v         属性值\r\n     */\r\n    public setProp(propName: string, v: any) {\r\n        if(!this.props){\r\n            this.props = new Map();\r\n        }\r\n        this.props.set(propName,v);\r\n    }\r\n\r\n    /**\r\n     * 删除属性\r\n     * @param props     属性名或属性名数组 \r\n     */\r\n    public delProp(props: string | string[]) {\r\n        if(!this.props){\r\n            return;\r\n        }\r\n        if (Util.isArray(props)) {\r\n            for (let p of <string[]>props) {\r\n                this.props.delete(p);\r\n            }\r\n        } else {\r\n            this.props.delete(<string>props);\r\n        }\r\n        //设置静态标志，至少要比较一次\r\n        this.setStaticOnce();\r\n    }\r\n\r\n    /**\r\n     * 设置asset\r\n     * @param assetName     asset name\r\n     * @param value         asset value\r\n     */\r\n    public setAsset(assetName: string, value: any) {\r\n        if(!this.assets){\r\n            this.assets = new Map();\r\n        }\r\n        this.assets.set(assetName, value);\r\n    }\r\n\r\n    /**\r\n     * 删除asset\r\n     * @param assetName     asset name\r\n     */\r\n    public delAsset(assetName: string) {\r\n        if(!this.assets){\r\n            return;\r\n        }\r\n        this.assets.delete(assetName);\r\n    }\r\n\r\n    \r\n\r\n    /**\r\n     * 添加事件\r\n     * @param event     事件对象\r\n     */\r\n    public addEvent(event: NEvent) {\r\n        if(!this.events){\r\n            this.events = new Map();\r\n        }\r\n        if(!this.events.has(event.name)){\r\n            this.events.set(event.name, [event.id]);\r\n        }else{\r\n            let arr = this.events.get(event.name);\r\n            //已添加的事件，不再添加\r\n            if(arr.indexOf(event.id) === -1){\r\n                arr.push(event.id);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取事件集\r\n     * @param eventName     事件名\r\n     * @returns             事件对象或事件对象数组\r\n     */\r\n    public getEvent(eventName:string):number[]{\r\n        if(this.events){\r\n            return this.events.get(eventName);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置事件集\r\n     * @param eventName     事件名\r\n     * @param events        事件数组\r\n     */\r\n    public setEvent(eventName:string,events:number[]){\r\n        if(!this.events){\r\n            this.events = new Map();\r\n        }\r\n        this.events.set(eventName,events);\r\n    }\r\n\r\n    /**\r\n     * 获取html dom\r\n     * @param module    模块 \r\n     * @returns         对应的html dom\r\n     */\r\n    public getEl(module:Module):Node{\r\n        return module.getNode(this.key);\r\n    }\r\n\r\n    /**\r\n     * 查找子孙节点\r\n     * @param key \telement key\r\n     * @returns\t\t虚拟dom/undefined\r\n     */\r\n    public query(key: string) {\r\n        if (this.key === key) {\r\n            return this;\r\n        }\r\n        if(this.children){\r\n            for (let i = 0; i < this.children.length; i++) {\r\n                let dom = this.children[i].query(key);\r\n                if (dom) {\r\n                    return dom;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置cache参数\r\n     * @param module    模块\r\n     * @param name      参数名\r\n     * @param value     参数值\r\n     */\r\n    public setParam(module:Module,name:string,value:any){\r\n        module.objectManager.setElementParam(this.key,name,value);\r\n    }\r\n\r\n    /**\r\n     * 获取参数值\r\n     * @param module    模块 \r\n     * @param name      参数名\r\n     * @returns         参数值\r\n     */\r\n    public getParam(module:Module,name:string){\r\n        return module.objectManager.getElementParam(this.key,name);\r\n    }\r\n\r\n    /**\r\n     * 移除参数\r\n     * @param module    模块\r\n     * @param name      参数名\r\n     */\r\n    public removeParam(module:Module,name:string){\r\n        module.objectManager.removeElementParam(this.key,name);\r\n    }\r\n\r\n    /**\r\n     * 设置单次静态标志\r\n     */\r\n    private setStaticOnce(){\r\n        if(this.staticNum !== -1){\r\n            this.staticNum = 1;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 克隆\r\n     * @param changeKey     是否更改key，如果为true，则生成的节点用新的key\r\n     */\r\n     public clone(): VirtualDom {\r\n        let dst: VirtualDom = new VirtualDom(this.tagName,this.key);\r\n        if(this.tagName){\r\n            //属性\r\n            if(this.props && this.props.size>0){\r\n                for(let p of this.props){\r\n                    dst.setProp(p[0],p[1]);\r\n                }\r\n            }\r\n            \r\n            if(this.assets && this.assets.size>0){\r\n                for(let p of this.assets){\r\n                    dst.setAsset(p[0],p[1]);\r\n                }\r\n            }\r\n            \r\n            //事件\r\n            if(this.events && this.events.size>0){\r\n                for(let p of this.events){\r\n                    //复制数组\r\n                    dst.setEvent(p[0],p[1].slice(0));\r\n                }    \r\n            }\r\n            \r\n            if(this.directives && this.directives.length>0){\r\n                dst.directives = [];\r\n                for(let d of this.directives){\r\n                    dst.directives.push(d.clone());\r\n                }\r\n            }\r\n            \r\n            //子节点clone\r\n            if(this.children){\r\n                for(let c of this.children){\r\n                    dst.add(c.clone());\r\n                }\r\n            }\r\n        }else{\r\n            dst.expressions = this.expressions;\r\n            dst.textContent = this.textContent;\r\n        }\r\n        dst.staticNum = this.staticNum;\r\n        return dst;\r\n    }\r\n}","import { Model } from \"./model\";\r\nimport { Module } from \"./module\";\r\nimport { Util } from \"./util\";\r\n\r\n/**\r\n * 表达式类\r\n */\r\nexport class Expression {\r\n    /**\r\n      * 表达式id\r\n      */\r\n    id: number;\r\n\r\n    /**\r\n     * 执行函数\r\n     */\r\n    execFunc: Function;\r\n\r\n    /**\r\n     * 只包含自有model变量\r\n     */\r\n    allModelField: boolean;\r\n\r\n    /**\r\n     * 值\r\n     */\r\n    value:any;\r\n\r\n    /**\r\n     * @param module    模块\r\n     * @param exprStr\t表达式串\r\n     */\r\n    constructor(module:Module,exprStr: string) {\r\n        this.id = Util.genId();\r\n        this.allModelField = true;\r\n        if (!module || !exprStr) {\r\n            return;\r\n        }\r\n        const funStr = this.compile(exprStr);\r\n        this.execFunc = new Function('$model',`return ` + funStr);\r\n    }\r\n\r\n    /**\r\n     * 编译表达式串，替换字段和方法\r\n     * @param exprStr   表达式串\r\n     * @returns         编译后的表达式串\r\n     */\r\n    private compile(exprStr:string){\r\n        //字符串，object key，有效命名(函数或字段)\r\n        const reg = /('[\\s\\S]*?')|(\"[\\s\\S]*?\")|(`[\\s\\S]*?`)|([a-zA-Z$_][\\w$]*\\s*?:)|((\\.{3}|\\.)?[a-zA-Z$_][\\w$]*(\\.[a-zA-Z$_][\\w$]*)*(\\s*[\\[\\(](\\s*\\))?)?)/g;\r\n        let r;\r\n        let retS = '';\r\n        let index = 0;  //当前位置\r\n\r\n        while((r=reg.exec(exprStr)) !== null){\r\n            let s = r[0];\r\n            if(index < r.index){\r\n                retS += exprStr.substring(index,r.index);\r\n            }\r\n            if(s[0] === \"'\" || s[0] === '\"' || s[0] === '`'){ //字符串\r\n                retS += s;\r\n            }else{\r\n                let lch = s[s.length-1];\r\n                if(lch === ':'){  //object key\r\n                    retS += s;\r\n                }else if(lch === '(' || lch === ')'){ //函数，非内部函数\r\n                    retS += handleFunc(s);\r\n                }else { //字段 this $model .field等不做处理\r\n                    if(s.startsWith('this.') || s==='$model' || s.startsWith('$model.') || Util.isKeyWord(s) || (s[0] === '.' && s[1]!=='.')){ //非model属性\r\n                        retS += s; \r\n                    }else{  //model属性\r\n                        let s1 = '';\r\n                        if(s.startsWith('...')){ // ...属性名\r\n                            s1 = '...';\r\n                            s = s.substr(3);\r\n                        }\r\n                        retS += s1 +'$model.' + s;\r\n                        \r\n                        //存在‘.’，则变量不全在在当前模型中\r\n                        if(s.indexOf('.') !== -1){\r\n                            this.allModelField = false;\r\n                        }\r\n                    }\r\n                }\r\n            } \r\n            index = reg.lastIndex;\r\n        }\r\n        if(index < exprStr.length){\r\n            retS += exprStr.substr(index);\r\n        }\r\n        \r\n        return retS;\r\n\r\n        /**\r\n         * 处理函数串\r\n         * @param str   源串\r\n         * @returns     处理后的串\r\n         */\r\n        function handleFunc(str):string{\r\n            let ind = str.indexOf('.');\r\n            //中间无'.'\r\n            if(ind === -1){\r\n                let ind1 = str.lastIndexOf('(');\r\n                let fn = str.substr(0,ind1);\r\n                //末尾字符\r\n                if(!Util.isKeyWord(fn)){\r\n                    let lch = str[str.length-1];\r\n                    if(lch !== ')'){ //有参数\r\n                        return 'this.invokeMethod(\"' + fn + '\",';\r\n                    }else{ //无参数\r\n                        return 'this.invokeMethod(\"' + fn + '\")';\r\n                    }\r\n                }\r\n            }else if(str[0] !== '.'){  //第一个为点不处理\r\n                let fn = str.substr(0,ind);\r\n                if(!Util.isKeyWord(fn)){ //首字段非关键词，则为属性\r\n                    return '$model.' + str;\r\n                }\r\n            }\r\n            return str;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 表达式计算\r\n     * @param model \t模型 或 fieldObj对象 \r\n     * @returns \t\t计算结果\r\n     */\r\n    public val(module:Module,model: Model) {\r\n        if (!model){\r\n            model = module.model;\r\n        } \r\n        let v;\r\n        try {\r\n            v = this.execFunc.apply(module,[model,module]);\r\n        } catch (e) {\r\n            // console.error(e);\r\n        }\r\n        this.value = v;\r\n        return v;\r\n    }\r\n\r\n    /**\r\n     * 克隆\r\n     */\r\n     public clone() {\r\n        return this;\r\n    }\r\n}\r\n","import {Module} from \"./module\";\r\nimport {VirtualDom} from \"./virtualdom\";\r\n/**\r\n * css 管理器\r\n * 针对不同的rule，处理方式不同\r\n * CSSStyleRule 进行保存和替换，同时 scopeInModule(模块作用域)有效\r\n * CSSImportRule 路径不重复添加，因为必须加在stylerule前面，所以需要记录最后的import索引号\r\n */\r\nexport class CssManager{\r\n\r\n    /**\r\n     * style sheet\r\n     */\r\n    private static sheet:any;\r\n\r\n    /**\r\n     * import url map，用于存储import的href路径\r\n     */\r\n    private static importMap = new Map();\r\n\r\n    /**\r\n     * importrule 位置\r\n     */\r\n    private static importIndex = 0;\r\n\r\n    /**\r\n     * css class 前置名\r\n     */\r\n    private static cssPreName = '___nodommodule___';\r\n    \r\n    /**\r\n     * 处理style 元素\r\n     * @param module    模块\r\n     * @param dom       虚拟都没\r\n     * @param root      模块root dom\r\n     * @param add       是否添加\r\n     * @returns         如果是styledom，则返回true，否则返回false\r\n     */\r\n    public static handleStyleDom(module:Module,dom:VirtualDom,root:VirtualDom,add?:boolean):boolean{\r\n        if(dom.tagName.toLowerCase() !== 'style'){\r\n            return false;\r\n        }\r\n        if(add){\r\n            root.addClass(this.cssPreName + module.id);\r\n        }else{\r\n            root.removeClass(this.cssPreName + module.id);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 处理 style 下的文本元素\r\n     * @param module    模块\r\n     * @param dom       style text element\r\n     * @returns         true:style text节点,false:非style text节点\r\n     */\r\n    public static handleStyleTextDom(module:Module,dom:any):boolean{\r\n        if(dom.parent.tagName.toLowerCase() !== 'style'){\r\n            return false;\r\n        }\r\n        //scope=this，在模块根节点添加 限定 class\r\n        CssManager.addRules(module,dom.textContent,dom.parent.getProp('scope') === 'this'?'.' + this.cssPreName + module.id:undefined);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 添加多个css rule\r\n     * @param cssText           rule集合 \r\n     * @param module            模块\r\n     * @param scopeName         作用域名(前置选择器)\r\n     */\r\n    public static addRules(module:Module,cssText:string,scopeName?:string){\r\n        //sheet 初始化\r\n        if(!this.sheet){\r\n            //safari不支持 cssstylesheet constructor，用 style代替\r\n            let sheet = document.createElement('style');\r\n            document.head.appendChild(sheet);\r\n            this.sheet = document.styleSheets[0];\r\n        }\r\n\r\n        //如果有作用域，则清除作用域下的rule\r\n        if(scopeName){\r\n            this.clearModuleRules(module);\r\n        }\r\n\r\n        //是否限定在模块内\r\n        //cssRule 获取正则式  @impot\r\n        const reg = /(@[a-zA-Z]+\\s+url\\(.+?\\))|([.#@a-zA-Z]\\S*(\\s*\\S*\\s*?)?{)|\\}/g;\r\n\r\n        //import support url正则式\r\n        const regImp = /@[a-zA-Z]+\\s+url/;\r\n        \r\n        // keyframe font page support... 开始 位置\r\n        let startIndex:number=-1;\r\n        // { 个数，遇到 } -1 \r\n        let beginNum:number = 0;\r\n        let re;\r\n        while((re=reg.exec(cssText)) !== null){\r\n            if(regImp.test(re[0])){ //import namespace\r\n                handleImport(re[0]);\r\n            }else if(re[0] === '}'){ //回收括号，单个样式结束判断\r\n                if(startIndex>=0 && --beginNum <= 0){  //style @ end\r\n                    let txt = cssText.substring(startIndex,re.index+1);\r\n                    if(txt[0] === '@'){ //@开头\r\n                        this.sheet.insertRule(txt,CssManager.sheet.cssRules?CssManager.sheet.cssRules.length:0);\r\n                    }else{  //style\r\n                        handleStyle(module,txt,scopeName);\r\n                    }\r\n                    startIndex = -1;\r\n                    beginNum = 0;\r\n                }\r\n            }else{ //style 或 @内部\r\n                if(startIndex === -1){\r\n                    startIndex = re.index;\r\n                    beginNum++;\r\n                }else{\r\n                    beginNum++;\r\n                }\r\n            }\r\n        }\r\n        \r\n        /**\r\n         * 处理style rule\r\n         * @param module            模块\r\n         * @param cssText           css 文本\r\n         * @param scopeName         作用域名(前置选择器)\r\n         */\r\n        function handleStyle(module:Module,cssText:string,scopeName?:string){\r\n            const reg = /.+(?=\\{)/;\r\n            let r = reg.exec(cssText);\r\n            if(!r){\r\n                return;\r\n            }\r\n            // 保存样式名，在模块 object manager中以数组存储\r\n            if(scopeName){\r\n                let arr = module.objectManager.get('$cssRules');\r\n                if(!arr){\r\n                    arr = [];\r\n                    module.objectManager.set('$cssRules',arr);\r\n                }\r\n                arr.push((scopeName + ' ' + r[0]));\r\n                //为样式添加 scope name\r\n                cssText = scopeName + ' ' + cssText;\r\n            }\r\n            //加入到样式表\r\n            CssManager.sheet.insertRule(cssText,CssManager.sheet.cssRules?CssManager.sheet.cssRules.length:0);\r\n        } \r\n\r\n        /**\r\n         * 处理import rule\r\n         * @param cssText   css文本\r\n         */\r\n        function handleImport(cssText:string){\r\n            const reg = /(?<=\\()\\S+(?=\\))/;\r\n            let r;\r\n            if((r = reg.exec(cssText))!==null){\r\n                if(CssManager.importMap.has(r[0])){\r\n                    return;\r\n                }\r\n                //插入import rule\r\n                CssManager.sheet.insertRule(cssText,CssManager.importIndex++);\r\n                CssManager.importMap.set(r[0],true);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 清除模块 css rules\r\n     * @param module    模块\r\n     */\r\n    public static clearModuleRules(module:Module){\r\n        let rules = module.objectManager.get('$cssRules');\r\n        if(!rules || rules.length === 0){\r\n            return;\r\n        }\r\n        //从sheet清除\r\n        for(let i=0;i<this.sheet.cssRules.length;i++){\r\n            let r = this.sheet.cssRules[i];\r\n            if(r.selectorText && rules.indexOf(r.selectorText) !== -1){\r\n                this.sheet.deleteRule(i--);\r\n            }\r\n        }\r\n\r\n        //置空cache\r\n        module.objectManager.set('$cssRules',[]);\r\n    }\r\n}","/**\r\n * 存储\r\n */\r\nexport class NCache{\r\n    private cacheData:any;\r\n\r\n    constructor(){\r\n        this.cacheData = {};\r\n    }\r\n\r\n    /**\r\n     * 从cache\r\n     * @param key   键，支持\".\"\r\n     * @reutrns     值或undefined\r\n     */\r\n    public get(key:string){\r\n        let p = this.cacheData;\r\n        if(key.indexOf('.') !== -1){\r\n            let arr = key.split('.');\r\n            if(arr.length>1){\r\n                for(let i=0;i<arr.length-1 && p;i++){\r\n                    p = p[arr[i]];\r\n                }\r\n                if(p){\r\n                    key = arr[arr.length-1];\r\n                }\r\n            }\r\n        }\r\n        if(p){\r\n            return p[key];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 保存值\r\n     * @param key       键 \r\n     * @param value     值\r\n     */\r\n    public set(key:string,value:any){\r\n        let p = this.cacheData;\r\n        if(key.indexOf('.') !== -1){\r\n            let arr = key.split('.');\r\n            if(arr.length>1){\r\n                for(let i=0;i<arr.length-1;i++){\r\n                    if(!p[arr[i]] || typeof p[arr[i]] !== 'object'){\r\n                        p[arr[i]] = {};\r\n                    }\r\n                    p = p[arr[i]];        \r\n                }\r\n                key = arr[arr.length-1];\r\n            }\r\n        }\r\n        \r\n        if(p){\r\n            p[key] = value;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 移除键\r\n     * @param key   键 \r\n     */\r\n    public remove(key:string){\r\n        let p = this.cacheData;\r\n        if(key.indexOf('.') !== -1){\r\n            let arr = key.split('.');\r\n            if(arr.length>1){\r\n                for(let i=0;i<arr.length-1 && p;i++){\r\n                    p = p[arr[i]];\r\n                }\r\n                if(p){\r\n                    key = arr[arr.length-1];\r\n                }\r\n            }\r\n        }\r\n        \r\n        if(p){\r\n            delete p[key];\r\n        }       \r\n    }\r\n}","import { NCache } from \"./cache\";\r\nimport { Directive } from \"./directive\";\r\nimport { NEvent } from \"./event\";\r\nimport { VirtualDom } from \"./virtualdom\";\r\nimport { Expression } from \"./expression\";\r\n\r\n/**\r\n * 全局缓存\r\n */\r\nexport class GlobalCache{\r\n    private static cache:NCache = new NCache();\r\n\r\n    /**\r\n         * 保存到cache\r\n         * @param key       键，支持\".\"\r\n         * @param value     值\r\n         */\r\n    public static set(key:string,value:any){\r\n        this.cache.set(key,value);\r\n    }\r\n\r\n    /**\r\n     * 从cache读取\r\n     * @param key   键，支持\".\"\r\n     * @returns     缓存的值或undefined\r\n     */\r\n    public static get(key){\r\n        return this.cache.get(key);\r\n    }\r\n\r\n    /**\r\n     * 从cache移除\r\n     * @param key   键，支持\".\"\r\n     */\r\n    public static remove(key){\r\n        this.cache.remove(key);\r\n    }\r\n\r\n    /**\r\n     * 获取指令实例\r\n     * @param module    模块\r\n     * @param id        指令id\r\n     * @returns         指令对象\r\n     */\r\n    public static getDirective(id:number):Directive{\r\n        return this.cache.get('$directives.' + id + '.$instance');\r\n    }\r\n\r\n    /**\r\n     * 保存指令实例\r\n     * @param module        模块\r\n     * @param directive     指令对象\r\n     */\r\n    public static saveDirective(directive:Directive){\r\n        this.cache.set('$directives.' + directive.id + '.$instance',directive);\r\n    }\r\n\r\n    /**\r\n     * 移除指令\r\n     * @param id    指令id\r\n     */\r\n    public static removeDirective(id:number){\r\n        this.cache.remove('$directives.' + id);\r\n    }\r\n\r\n    /**\r\n     * 设置指令参数\r\n     * @param id        指令id\r\n     * @param key       dom key\r\n     * @param name      参数名  \r\n     * @param value     参数值\r\n     */\r\n    public static setDirectiveParam(id:number,key:string,name:string,value:any){\r\n        this.cache.set('$doms.' + key + '$directives.' + id + '.$params.' + name,value);\r\n    }\r\n\r\n    /**\r\n     * 获取指令参数值\r\n     * @param id        指令id\r\n     * @param key       dom key\r\n     * @param name      参数名\r\n     * @returns         参数值\r\n     */\r\n    public static getDirectiveParam(id:number,key:string,name:string){\r\n        return this.cache.get('$doms.' + key + '$directives.' + id + '.$params.' + name);\r\n    }\r\n\r\n    /**\r\n     * 移除指令参数\r\n     * @param id        指令id\r\n     * @param key       dom key\r\n     * @param name      参数名\r\n     */\r\n    public static removeDirectiveParam(id:number,key:string,name:string){\r\n        this.cache.remove('$doms.' + key + '$directives.' + id + '.$params.' + name);\r\n    }\r\n\r\n    /**\r\n     * 清空指令参数\r\n     * @param id        指令id\r\n     * @param key       dom key\r\n     */\r\n    public static clearDirectiveParam(id:number,key:string){\r\n        this.cache.remove('$doms.' + key + '$directives.' + id + '.$params.' + name);\r\n    }\r\n\r\n    /**\r\n     * 获取表达式实例\r\n     * @param id        表达式id\r\n     * @returns         表达式对象\r\n     */\r\n    public static getExpression(id:number):Expression{\r\n        return this.cache.get('$expressions.' + id);\r\n    }\r\n\r\n    /**\r\n     * 保存表达式实例\r\n     * @param expression    表达式对象\r\n     */\r\n    public static saveExpression(expression:Expression){\r\n        this.cache.set('$expressions.' + expression.id,expression);\r\n    }\r\n\r\n    /**\r\n     * 移除表达式\r\n     * @param id    表达式id\r\n     */\r\n    public static removeExpression(id:number){\r\n        this.cache.remove('$expressions.' + id);\r\n    }\r\n\r\n    /**\r\n     * 获取事件实例\r\n     * @param id        表达式id\r\n     * @returns         事件对象\r\n     */\r\n    public static getEvent(id:number):NEvent{\r\n        return this.cache.get('$events.' + id + '.$instance');\r\n    }\r\n\r\n    /**\r\n     * 保存事件实例\r\n     * @param event     事件对象\r\n     */\r\n    public static saveEvent(event:NEvent){\r\n        this.cache.set('$events.' + event.id + '.$instance',event);\r\n    }\r\n\r\n    /**\r\n     * 移除事件\r\n     * @param id    事件id\r\n     */\r\n    public static removeEvent(id:number){\r\n        this.cache.remove('$events.' + id);\r\n    }\r\n\r\n    /**\r\n     * 设置事件参数\r\n     * @param id        事件id\r\n     * @param key       dom key\r\n     * @param name      参数名  \r\n     * @param value     参数值\r\n     */\r\n    public static setEventParam(id:number,key:String,name:string,value:any){\r\n        this.cache.set('$doms.' + key + '$events.' + id + '.$params.' + name,value);\r\n    }\r\n\r\n    /**\r\n     * 获取事件参数值\r\n     * @param id        事件id\r\n     * @param key       dom key \r\n     * @param name      参数名\r\n     * @returns         参数值\r\n     */\r\n    public static getEventParam(id:number,key:string,name:string){\r\n        return this.cache.get('$doms.' + key + '$events.' + id + '.$params.' + name);\r\n    }\r\n\r\n    /**\r\n     * 移除事件参数\r\n     * @param id        事件id\r\n     * @param key       dom key\r\n     * @param name      参数名\r\n     */\r\n    public static removeEventParam(id:number,key:string,name:string){\r\n        this.cache.remove('$doms.' + key + '$events.' + id + '.$params.' + name);\r\n    }\r\n\r\n    /**\r\n     * 清空事件参数\r\n     * @param id        事件id\r\n     * @param key       dom key \r\n     */\r\n    public static clearEventParam(id:number,key:string){\r\n        this.cache.remove('$doms.' + key + '$events.' + id + '.$params');\r\n    }\r\n\r\n    /**\r\n     * 保存旧虚拟dom\r\n     * @param dom       dom对象\r\n     */\r\n    public static saveElement(dom:VirtualDom){\r\n        this.cache.set('$doms.' + dom.key,dom);\r\n    }\r\n    /**\r\n     * 获取渲染树虚拟dom\r\n     * @param key       dom key\r\n     * @returns         dom对象\r\n     */\r\n    public static getElement(key:string):VirtualDom{\r\n        return this.cache.get('$doms.' + key);\r\n    }\r\n\r\n    /**\r\n     * 删除渲染树虚拟dom\r\n     * @param key       虚拟dom key\r\n     */\r\n    public static removeElement(key:string){\r\n        this.cache.remove('$doms.' + key);\r\n    }\r\n\r\n\r\n    /**\r\n     * 获取key对应的html节点\r\n     * @param key       el key\r\n     * @returns         html element\r\n     */\r\n    public static getNode(key: string): Node {\r\n        return this.cache.get('$doms.' + key + '.$el');\r\n    }\r\n\r\n    /**\r\n     * 保存key对应的html node\r\n     * @param key       dom key\r\n     * @param node      node\r\n     */\r\n    public static saveNode(key:string,node:Node){\r\n        this.cache.set('$doms.' + key + '.$el',node);\r\n    }\r\n\r\n    /**\r\n     * 移除保存的节点（包括参数和html dom）\r\n     * @param key   dom key\r\n     */\r\n    public static removeSavedNode(key:string){\r\n        this.cache.remove('$doms.' + key);\r\n    }\r\n\r\n    /**\r\n     * 设置dom参数值\r\n     * @param key       dom key \r\n     * @param name       参数名\r\n     * @param value     参数值\r\n     */\r\n    public static setElementParam(key:string,name:string,value:any){\r\n        this.cache.set('$doms.' + key + '.$params.' + name ,value);\r\n    }\r\n\r\n    /**\r\n     * 获取dom参数值\r\n     * @param key       dom key\r\n     * @param name      参数名\r\n     * @returns         参数值\r\n     */\r\n    public static getElementParam(key:string,name:string):any{\r\n        return this.cache.get('$doms.' + key + '.$params.' + name);\r\n    }\r\n\r\n    /**\r\n     * 移除dom参数\r\n     * @param key       dom key\r\n     * @param name      参数名\r\n     */\r\n    public static removeElementParam(key:string,name:string){\r\n        this.cache.remove('$doms.' + key + '.$params.' + name);\r\n    }\r\n\r\n    /**\r\n     * 清除element 参数集\r\n     * @param key   dom key\r\n     */\r\n    public static clearElementParams(key:string){\r\n        this.cache.remove('$doms.' + key + '.$params');\r\n    }\r\n\r\n    /**\r\n     * 清除指令集\r\n     */\r\n    public static clearDirectives(){\r\n        this.remove('$directives');\r\n    }\r\n\r\n    /**\r\n     * 清除表达式集\r\n     */\r\n    public static clearExpressions(){\r\n        this.remove('$directives');\r\n    }\r\n\r\n    /**\r\n     * 清除事件集\r\n     */   \r\n    public static clearEvents(){\r\n        this.remove('$directives');\r\n    }\r\n\r\n    /**\r\n     * 清除缓存dom对象\r\n     */\r\n    public static clearSaveDoms(){\r\n        this.remove('$doms');\r\n    }\r\n}","import { VirtualDom } from \"./virtualdom\";\r\nimport { GlobalCache } from \"./globalcache\";\r\nimport { Model } from \"./model\";\r\nimport { Module } from \"./module\";\r\nimport { Util } from \"./util\";\r\n\r\n/**\r\n * 事件类\r\n * @remarks\r\n * 事件分为自有事件和代理事件\r\n * @author      yanglei\r\n * @since       1.0\r\n */\r\nexport class NEvent {\r\n    public id: number;\r\n    /**\r\n     * 事件名\r\n     */\r\n    public name: string;\r\n    /**\r\n     * 事件处理函数名(需要在模块中定义)\r\n     */\r\n    public handler: string | Function;\r\n    /**\r\n     * 代理模式，事件代理到父对象\r\n     */\r\n    public delg: boolean;\r\n    /**\r\n     * 禁止冒泡，代理模式下无效\r\n     */\r\n    public nopopo: boolean;\r\n    /**\r\n     * 只执行一次\r\n     */\r\n    public once: boolean;\r\n\r\n    /**\r\n     * 使用 capture，代理模式下无效\r\n     */\r\n    public capture: boolean;\r\n\r\n    /**\r\n     * 依赖事件，用于扩展事件存储原始事件对戏\r\n     */\r\n    public dependEvent:NEvent;\r\n    \r\n\r\n    /**\r\n     * @param module        模块\r\n     * @param eventName     事件名\r\n     * @param eventStr      事件串或事件处理函数,以“:”分割,中间不能有空格,结构为: 方法名[:delg(代理到父对象):nopopo(禁止冒泡):once(只执行一次):capture(useCapture)]\r\n     *                      如果为函数，则替代第三个参数\r\n     * @param handler       事件执行函数，如果方法不在module methods中定义，则可以直接申明，eventStr第一个参数失效，即eventStr可以是\":delg:nopopo...\"\r\n     */\r\n    constructor(eventName: string, eventStr?: string | Function, handler?: Function) {\r\n        this.id = Util.genId();\r\n        this.name = eventName;\r\n        \r\n        GlobalCache.saveEvent(this);\r\n        //如果事件串不为空，则不需要处理\r\n        if (eventStr) {\r\n            let tp = typeof eventStr;\r\n            if (tp === 'string') {\r\n                let eStr: string = (<string>eventStr).trim();\r\n                eStr.split(':').forEach((item, i) => {\r\n                    item = item.trim();\r\n                    if (i === 0) { //事件方法\r\n                        this.handler = item;\r\n                    } else { //事件附加参数\r\n                        switch (item) {\r\n                            case 'delg':\r\n                                this.delg = true;\r\n                                break;\r\n                            case 'nopopo':\r\n                                this.nopopo = true;\r\n                                break;\r\n                            case 'once':\r\n                                this.once = true;\r\n                                break;\r\n                            case 'capture':\r\n                                this.capture = true;\r\n                                break;\r\n                        }\r\n                    }\r\n                });\r\n\r\n            } else if (tp === 'function') {\r\n                handler = <Function>eventStr;\r\n            }\r\n        }\r\n        //新增事件方法（不在methods中定义）\r\n        if (handler) {\r\n            this.handler = handler;\r\n        }\r\n        \r\n        if (document.ontouchend) { //触屏设备\r\n            switch (this.name) {\r\n                case 'click':\r\n                    this.name = 'tap';\r\n                    break;\r\n                case 'mousedown':\r\n                    this.name = 'touchstart';\r\n                    break;\r\n                case 'mouseup':\r\n                    this.name = 'touchend';\r\n                    break;\r\n                case 'mousemove':\r\n                    this.name = 'touchmove';\r\n                    break;\r\n            }\r\n        } else { //转非触屏\r\n            switch (this.name) {\r\n                case 'tap':\r\n                    this.name = 'click';\r\n                    break;\r\n                case 'touchstart':\r\n                    this.name = 'mousedown';\r\n                    break;\r\n                case 'touchend':\r\n                    this.name = 'mouseup';\r\n                    break;\r\n                case 'touchmove':\r\n                    this.name = 'mousemove';\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置附加参数值\r\n     * @param module    模块\r\n     * @param dom       虚拟dom\r\n     * @param name      参数名\r\n     * @param value     参数值\r\n     */\r\n    public setParam(module:Module,dom:VirtualDom,name: string, value: any) {\r\n        module.objectManager.setEventParam(this.id,dom.key,name,value);\r\n    }\r\n\r\n    /**\r\n     * 获取附加参数值\r\n     * @param module    模块\r\n     * @param dom       虚拟dom\r\n     * @param name      参数名\r\n     * @returns         参数值\r\n     */\r\n    public getParam(module:Module,dom:VirtualDom,name: string) {\r\n        return module.objectManager.getEventParam(this.id,dom.key,name);\r\n    }\r\n\r\n    /**\r\n     * 移除参数\r\n     * @param module    模块 \r\n     * @param dom       虚拟dom\r\n     * @param name      参数名\r\n     */\r\n    public removeParam(module:Module,dom:VirtualDom,name: string) {\r\n        return module.objectManager.removeEventParam(this.id,dom.key,name);\r\n    }\r\n    /**\r\n     * 清参数cache\r\n     * @param module    模块\r\n     * @param dom       虚拟dom\r\n     */\r\n    public clearParam(module:Module,dom:VirtualDom){\r\n        module.objectManager.clearEventParam(this.id,dom.key);\r\n    }\r\n}\r\n","import { Module } from \"./module\";\r\nimport { VirtualDom } from \"./virtualdom\";\r\nimport { NEvent } from \"./event\";\r\nimport { Util } from \"./util\";\r\n/**\r\n * 事件管理器\r\n */\r\nexport class EventManager{\r\n    /**\r\n     * 外部事件集\r\n     */\r\n    private static extendEventMap = new Map();\r\n    /**\r\n     * 绑定事件\r\n     * @param module \r\n     * @param dom \r\n     */\r\n    public static bind(module:Module,dom:VirtualDom){\r\n        if(!dom.events){\r\n            return;\r\n        }\r\n        //判断并设置事件绑定标志\r\n        let el = module.getNode(dom.key);\r\n        if(el['bindEvent']){\r\n            return;\r\n        }\r\n        el['bindEvent'] = true;\r\n\r\n        for (let evt of dom.events) {\r\n            let arr = evt[1];\r\n            //同一个事件名可能对应多个事件对象\r\n            if(arr.length === 0) return;\r\n            //获取usecapture\r\n            let capture = (arr.findIndex(item=>module.objectManager.getEvent(item).capture === true) !== -1);\r\n            \r\n            // 只代理一次，也只绑定一次\r\n            //是否已代理\r\n            let hasDelg:boolean = false;\r\n            //是否已绑定\r\n            let hasBound:boolean = false;\r\n            //遍历处理代理事件\r\n            for(let ii=0;ii<arr.length;ii++){\r\n                const ev:NEvent = module.objectManager.getEvent(arr[ii]);\r\n                //处理外部事件，如果有外部事件，则移除改事件\r\n                if(this.handleExtendEvent(module,dom,ev)){\r\n                    arr.splice(ii--,1);\r\n                    continue;\r\n                }\r\n\r\n                //当前事件名已绑定且已代理，不再执行\r\n                if(hasBound && hasDelg){\r\n                    break;\r\n                }\r\n                //代理事件\r\n                if(ev.delg){\r\n                    if(!hasDelg){\r\n                        const parent = dom.parent;\r\n                        //事件加入父对象\r\n                        parent.addEvent(ev);\r\n                        \r\n                        // 保存代理dom信息\r\n                        let delgs = ev.getParam(module,parent,'$delgs');\r\n                        if(!delgs){\r\n                            delgs = {};\r\n                            ev.setParam(module,parent,'$delgs',delgs);\r\n                        }\r\n                        delgs[dom.key] = dom;\r\n                        //从本地移除\r\n                        arr.splice(ii--,1);\r\n                        \r\n                        //如果父无此事件，则需要绑定到父事件\r\n                        let eh = getCfg(parent,ev.name);\r\n                        if(!eh){\r\n                            // 保存handler\r\n                            saveCfg(parent,ev.name,handler,ev.capture);\r\n                            module.getNode(parent.key).addEventListener(ev.name,handler,ev.capture);\r\n                        }\r\n                        hasDelg = true;\r\n                    }\r\n                }else if(!hasBound){\r\n                    hasBound = true;\r\n                    // 保存handler\r\n                    saveCfg(dom,ev.name,handler,capture);\r\n                    el.addEventListener(ev.name,handler,capture);\r\n                }\r\n            }\r\n        }\r\n        /**\r\n         * 保存事件配置\r\n         * @param dom       dom节点\r\n         * @param ev        事件名\r\n         * @param handler   事件方法\r\n         * @param capture   是否capture\r\n         */\r\n        function saveCfg(dom,ev,handler,capture){\r\n            module.objectManager.set('$domevents_' + dom.key + '_' + ev,{\r\n                handler:handler,\r\n                capture:capture\r\n            });\r\n        }\r\n\r\n        /**\r\n         * 获取事件配置\r\n         * @param dom       dom节点\r\n         * @param ev        事件名\r\n         * @returns         {handler,capture}\r\n         */\r\n        function getCfg(dom,ev):any{\r\n            return module.objectManager.get('$domevents_' + dom.key + '_' + ev);\r\n        }   \r\n        /**\r\n         * 事件handler\r\n         * @param e  Event\r\n         */\r\n        function handler(e){\r\n            //从事件element获取事件\r\n            let el = e.currentTarget;\r\n            const dom = el['vdom'];\r\n            if(!dom || !dom.events || !dom.events.has(e.type)){\r\n                return;\r\n            }\r\n            \r\n            const evts = dom.getEvent(e.type);\r\n            //已执行事件map，不重复执行\r\n            let execMap = new Map();\r\n            \r\n            for(let ii=0;ii<evts.length;ii++){\r\n                const eid = evts[ii];\r\n                const ev:NEvent = module.objectManager.getEvent(eid);\r\n                if(typeof ev.handler === 'string'){\r\n                    ev.handler = module.getMethod(ev.handler);\r\n                }\r\n                if(!ev.handler){\r\n                    return;\r\n                }\r\n                \r\n                //禁止冒泡\r\n                if (ev.nopopo) {\r\n                    e.stopPropagation();\r\n                }\r\n                //代理事件，需要作用在子节点上\r\n                if(ev.delg){ // 代理\r\n                    let delgs = ev.getParam(module,dom,'$delgs');\r\n                    //向上找节点\r\n                    for(let i=0;i<e.path.length&&e.path[i] !== el;i++){\r\n                        let el1 = e.path[i];\r\n                        let key = el1.vdom.key;\r\n                        //　找到事件节点\r\n                        if(key && delgs.hasOwnProperty(key)){\r\n                            let dom1 = delgs[key];\r\n                            if(dom1){\r\n                                //如果dom对应的事件已执行，不再执行\r\n                                if(execMap.get(ev.id) === dom1.key){\r\n                                    break;\r\n                                }\r\n                                ev.handler.apply(module,[dom1.model, dom1,ev, e]);\r\n                                execMap.set(ev.id,dom1.key);\r\n                                if(ev.once){\r\n                                    EventManager.unbind(module,dom1,ev);\r\n                                }\r\n                            }\r\n                            break;\r\n                        }\r\n                    }\r\n                }else{\r\n                    ev.handler.apply(module,[dom.model, dom,ev, e]);\r\n                    //事件只执行一次，从事件数组删除\r\n                    if (ev.once) {\r\n                        EventManager.unbind(module,dom,ev);\r\n                        ii--;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 解绑一个事件\r\n     * @param module    模块     \r\n     * @param dom       dom节点\r\n     * @param ev        事件对象\r\n     * @returns \r\n     */\r\n    public static unbind(module:Module,dom:any,ev:NEvent){\r\n        let evts;\r\n        if(ev.delg){\r\n            evts = dom.parent.getEvent(ev.name);\r\n            let delgs = ev.getParam(module,dom.parent,'$delgs');\r\n            delete delgs[dom.key];\r\n            //如果代理不为空，则不删除事件\r\n            if(Object.keys(delgs).length > 0){\r\n                return;\r\n            }\r\n        }else{\r\n            evts = dom.getEvent(ev.name);\r\n        }\r\n        if(!evts){\r\n            return;\r\n        }\r\n        let index;\r\n        if((index = evts.findIndex(item=>item === ev.id)) === -1) return;\r\n        //从事件数组移除\r\n        evts.splice(index,1);\r\n        //判断并解绑\r\n        if(evts.length === 0){\r\n            const cfg = module.objectManager.get('$domevents_' + dom.key + '_' + ev.name)\r\n            if(cfg && cfg.handler){\r\n                (<HTMLElement>dom.getEl(module)).removeEventListener(ev.name,cfg.handler,cfg.capture);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 处理外部事件\r\n     * @param module    模块 \r\n     * @param dom       dom节点\r\n     * @param event     事件对象\r\n     * @returns         如果有是外部事件，则返回true，否则返回false\r\n     */\r\n    private static handleExtendEvent(module:Module,dom:VirtualDom,event:NEvent):boolean{\r\n        let evts = this.get(event.name);\r\n        if(!evts){\r\n            return false;\r\n        }\r\n        for(let key of Object.keys(evts)){\r\n            let ev = new NEvent(key,evts[key]);\r\n            ev.capture = event.capture;\r\n            ev.nopopo = event.nopopo;\r\n            ev.delg = event.delg;\r\n            ev.once = event.once;\r\n            //设置依赖事件\r\n            ev.dependEvent = event;\r\n            dom.addEvent(ev);\r\n        }\r\n        return true;\r\n    }\r\n\r\n\r\n    \r\n     /**\r\n      * 注册扩展事件\r\n      * @param eventName    事件名\r\n      * @param handleObj    事件处理集\r\n      */\r\n     public static regist(eventName:string,handleObj:any) {\r\n         this.extendEventMap.set(eventName,handleObj);\r\n     }\r\n \r\n     /**\r\n      * 取消注册扩展事件\r\n      * @param eventName     事件名\r\n      */\r\n     static unregist(eventName:string) {\r\n         return this.extendEventMap.delete(eventName);\r\n     }\r\n \r\n     /**\r\n      * 获取扩展事件\r\n      * @param eventName     事件名\r\n      * @returns             事件处理集\r\n      */\r\n      public static get(eventName:string):any{\r\n         return this.extendEventMap.get(eventName);\r\n     }\r\n}","import { Module } from \"./module\";\r\nimport { ModuleFactory } from \"./modulefactory\";\r\nimport { VirtualDom } from \"./virtualdom\";\r\nimport { Model } from \"./model\";\r\nimport { Expression } from \"./expression\";\r\nimport { CssManager } from \"./cssmanager\";\r\nimport { EventManager } from \"./eventmanager\";\r\n\r\n/**\r\n * 渲染器\r\n */\r\nexport class Renderer {\r\n    /**\r\n     * 等待渲染列表（模块名）\r\n     */\r\n    public static waitList: Array < number > = [];\r\n\r\n    /**\r\n     * 当前模块根dom\r\n     */\r\n    private static currentModuleRoot:VirtualDom;\r\n    /**\r\n     * 添加到渲染列表\r\n     * @param module 模块\r\n     */\r\n    public static add(module:Module) {\r\n        //如果已经在列表中，不再添加\r\n        if (!module.dontAddToRender && !this.waitList.includes(module.id)) {\r\n            //计算优先级\r\n            this.waitList.push(module.id);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * 队列渲染\r\n     */\r\n    public static render() {\r\n        for(;this.waitList.length>0;){\r\n            ModuleFactory.get(this.waitList.shift()).render();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 渲染dom\r\n     * @param module            模块 \r\n     * @param src               源dom\r\n     * @param model             模型，如果src已经带有model，则此参数无效\r\n     * @param parent            父dom\r\n     * @param key               key\r\n     * @returns \r\n     */\r\n    public static renderDom(module:Module,src:VirtualDom,model:Model,parent?:VirtualDom,key?:string):VirtualDom{\r\n        //节点自带model优先级高\r\n        model = src.model?src.model:model;\r\n        let dst:VirtualDom = new VirtualDom(src.tagName,key?src.key+'_'+key:src.key);\r\n        //设置当前根root\r\n        if(!parent){\r\n            this.currentModuleRoot = dst;\r\n        }\r\n        if(src.staticNum>0){\r\n            src.staticNum--;\r\n        }\r\n        dst.model = model;\r\n        dst.subModuleId = src.subModuleId;\r\n        \r\n        // 设置父对象\r\n        if(parent) {\r\n            dst.parent = parent;\r\n        }\r\n        \r\n        //先处理model指令\r\n        if(src.directives && src.directives.length>0 && src.directives[0].type.name === 'model'){\r\n            src.directives[0].exec(module,dst,src);\r\n        }\r\n\r\n        if(src.tagName){\r\n            if(!dst.notChange){\r\n                handleProps();\r\n                let r = handleDirectives();\r\n                if(!r){\r\n                    return;\r\n                }\r\n                //处理style，如果为style，则不处理assets和events\r\n                if(!CssManager.handleStyleDom(module,src,Renderer.currentModuleRoot,src.getProp('scope') === 'this')){\r\n                    //assets\r\n                    if(src.assets && src.assets.size>0){\r\n                        for(let p of src.assets){\r\n                            dst.setAsset(p[0],p[1]);\r\n                        }\r\n                    }\r\n\r\n                    //事件\r\n                    if(src.events && src.events.size>0){\r\n                        for(let p of src.events){\r\n                            //复制数组\r\n                            dst.setEvent(p[0],p[1].slice(0));\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            // 子节点\r\n            if(src.children && src.children.length>0){\r\n                dst.children = [];\r\n                for(let c of src.children){\r\n                    Renderer.renderDom(module,c,dst.model,dst,key?key:null);\r\n                }\r\n            }\r\n        }else if(!dst.notChange){ //文本节点\r\n            if(src.expressions){\r\n                let value = '';\r\n                src.expressions.forEach((v) => {\r\n                    if (v instanceof Expression) { //处理表达式\r\n                        let v1 = v.val(module,dst.model);\r\n                        value += v1 !== undefined ? v1 : '';\r\n                    } else {\r\n                        value += v;\r\n                    }\r\n                });\r\n                dst.textContent = value;\r\n                dst.staticNum = -1;\r\n            }else{\r\n                dst.textContent = src.textContent;\r\n            }\r\n        }\r\n        //添加到dom tree\r\n        if(parent && !dst.dontAddToTree){\r\n            parent.children.push(dst);\r\n        }\r\n        return dst;\r\n\r\n        /**\r\n         * 处理指令\r\n         * @returns     true继续执行，false不执行后续渲染代码\r\n         */\r\n        function handleDirectives():boolean {\r\n            if(!src.directives || src.directives.length===0){\r\n                return true;\r\n            }\r\n            dst.staticNum = -1;\r\n            for(let d of src.directives){\r\n                //model指令不执行\r\n                if(d.type.name==='model'){\r\n                    continue;\r\n                }\r\n                if(!d.exec(module,dst,src)){\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        }\r\n\r\n        /**\r\n         * 处理属性（带表达式）\r\n         */\r\n        function handleProps() {\r\n            if(!src.props || src.props.size === 0){\r\n                return;\r\n            }\r\n            for(let k of src.props){\r\n                if(k[1] instanceof Expression){\r\n                    dst.setProp(k[0],k[1].val(module,dst.model));\r\n                    dst.staticNum = -1;\r\n                }else{\r\n                    dst.setProp(k[0],k[1]);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 渲染为html element\r\n     * @param module \t        模块\r\n     * @param src               渲染节点\r\n     * @param parentEl \t        父html\r\n     * @param isRenderChild     是否渲染子节点\r\n     */\r\n    public static renderToHtml(module: Module,src:VirtualDom, parentEl:HTMLElement,isRenderChild?:boolean):Node {\r\n        let el = module.getNode(src.key);\r\n        if(el){   //html dom节点已存在\r\n            if(src.tagName){\r\n                if(src.props){\r\n                    //设置属性\r\n                    for(let p of src.props){\r\n                        if(p[1]!== undefined){\r\n                            (<HTMLElement>el).setAttribute(p[0],p[1]);\r\n                        }\r\n                    }\r\n                }\r\n                handleAssets(src,<HTMLElement>el);\r\n            }else{  //文本节点\r\n                (<any>el).textContent = src.textContent;\r\n            }\r\n        }else{\r\n            if(src.tagName){\r\n                el = newEl(src);\r\n            }else{\r\n                el = newText(src);\r\n            }\r\n            //先创建子节点，再添加到html dom树，避免频繁添加\r\n            if(el && src.tagName  && isRenderChild){\r\n                genSub(el, src);\r\n            }\r\n            if(el && parentEl){\r\n                parentEl.appendChild(el);\r\n            }\r\n        }\r\n        return el;\r\n        \r\n        /**\r\n         * 新建element节点\r\n         * @param dom \t\t虚拟dom\r\n         * @returns \t\t新的html element\r\n         */\r\n        function newEl(dom:VirtualDom): HTMLElement {\r\n            //style不处理\r\n            if(dom.tagName.toLowerCase() === 'style'){\r\n                return;\r\n            }\r\n            //创建element\r\n            let el= document.createElement(dom.tagName);\r\n            //保存虚拟dom\r\n            el['vdom'] = dom;\r\n        \r\n            //模块容器，向目标模块设置容器\r\n            if(dom.subModuleId){\r\n                let m:Module = ModuleFactory.get(dom.subModuleId);\r\n                if(m){\r\n                    m.setContainer(el,true);\r\n                }\r\n            }\r\n            //设置属性\r\n            if(dom.props){\r\n                for(let p of dom.props){\r\n                    if(p[1] !== undefined){\r\n                        el.setAttribute(p[0],p[1]);     \r\n                    }\r\n                }\r\n            }\r\n            \r\n            //如果存储node，则不需要key\r\n            // el.setAttribute('key', dom.key);\r\n            //把el引用与key关系存放到cache中\r\n            module.saveNode(dom.key,el);\r\n            //asset\r\n            if(dom.assets && dom.assets.size>0){\r\n                for (let p in dom.assets) {\r\n                    el[p] = p[1];\r\n                }\r\n            }\r\n            //处理event\r\n            if(dom.events){\r\n                EventManager.bind(module,dom);\r\n            }\r\n            return el;\r\n        }\r\n\r\n        /**\r\n         * 新建文本节点\r\n         */\r\n        function newText(dom:VirtualDom): Node {\r\n            //样式表处理，如果是样式表文本，则不添加到dom树\r\n            if(CssManager.handleStyleTextDom(module,dom)){\r\n                 return;\r\n            }\r\n            let node = document.createTextNode(<string>dom.textContent || '');\r\n            module.saveNode(dom.key,node);\r\n            return node;\r\n        }\r\n\r\n        /**\r\n         * 生成子节点\r\n         * @param pEl \t父节点\r\n         * @param vdom  虚拟dom节点\t\r\n         */\r\n        function genSub(pEl: Node, vdom: VirtualDom) {\r\n            if (vdom.children && vdom.children.length > 0) {\r\n                vdom.children.forEach(item => {\r\n                    let el1;\r\n                    if (item.tagName) {\r\n                        el1 = newEl(item);\r\n                        genSub(el1, item);\r\n                    } else {\r\n                        el1 = newText(item);\r\n                    }\r\n                    if(el1){\r\n                        pEl.appendChild(el1);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * 处理assets\r\n         */\r\n        function handleAssets(dom:VirtualDom,el:HTMLElement){\r\n            //处理asset\r\n            if (dom.assets) {\r\n                for (let k of dom.assets) {\r\n                    el[k[0]] = k[1];\r\n                }    \r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 处理更改的dom节点\r\n     * @param module        待处理模块\r\n     * @param changeDoms    更改的dom参数数组\r\n     */\r\n    public static handleChangedDoms(module:Module,changeDoms:any[]){\r\n        for(let item of changeDoms){\r\n            let[n1,n2,pEl] = [\r\n                item[1]?module.getNode(item[1].key):null,\r\n                item[2]&&typeof item[2]==='object'?module.getNode(item[2].key):null,\r\n                item[3]?module.getNode(item[3].key):null\r\n            ];\r\n            switch(item[0]){\r\n                case 1: //添加\r\n                    //把新dom缓存添加到旧dom缓存\r\n                    Renderer.renderToHtml(module,item[1],<HTMLElement>pEl,true);\r\n                    n1 = module.getNode(item[1].key);\r\n                    if(!n2){ //不存在添加节点或为索引号\r\n                        if(typeof item[2] === 'number' && pEl.childNodes.length-1>item[2]){\r\n                            pEl.insertBefore(n1,pEl.childNodes[item[2]]);\r\n                        }else{\r\n                            pEl.appendChild(n1);\r\n                        }\r\n                    }else{\r\n                        pEl.insertBefore(n1,n2);\r\n                    }\r\n                    break;\r\n                case 2: //修改\r\n                    Renderer.renderToHtml(module,item[1],null,false);\r\n                    break;\r\n                case 3: //删除\r\n                    //清除缓存\r\n                    module.objectManager.removeSavedNode(item[1].key);\r\n                    module.keyNodeMap.delete(item[1].key);\r\n                    //从html dom树移除\r\n                    pEl.removeChild(n1);\r\n                    break;\r\n                case 4: //移动\r\n                    if(item[4] ){  //相对节点后\r\n                        if(n2&&n2.nextSibling){\r\n                            pEl.insertBefore(n1,n2.nextSibling);\r\n                        }else{\r\n                            pEl.appendChild(n1);\r\n                        }\r\n                    }else{\r\n                        pEl.insertBefore(n1,n2);\r\n                    }\r\n                    break;\r\n                default: //替换\r\n                    Renderer.renderToHtml(module,item[1],<HTMLElement>pEl,true);\r\n                    n1 = module.getNode(item[1].key);\r\n                    pEl.replaceChild(n1,n2);\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { Module } from \"./module\";\r\nimport { ModuleFactory } from \"./modulefactory\";\r\nimport { Renderer } from \"./renderer\";\r\nimport { Route } from \"./route\";\r\nimport { Util } from \"./util\";\r\n\r\n/**\r\n * 路由管理类\r\n * @since \t1.0\r\n */\r\nexport class Router {\r\n    /**\r\n     * 路由map\r\n     */\r\n    static routeMap:Map<number,Route> = new Map();\r\n    /**\r\n     * 当前路径\r\n     */\r\n    static currentPath:string;\r\n    \r\n    /**\r\n     * path等待链表\r\n     */\r\n    static waitList:Array<string> = []; \r\n    \r\n    /**\r\n     * 默认路由进入事件方法\r\n     */\r\n    static onDefaultEnter:Function;\r\n    /**\r\n     * 默认路由离开事件\r\n     */\r\n    static onDefaultLeave:Function; \r\n    \r\n    /**\r\n     * 启动方式 0:直接启动 1:popstate 启动\r\n     */\r\n    static startStyle:number = 0;\r\n\r\n    /**\r\n     * 激活Dom map，格式为{moduleId:[]}\r\n     */\r\n    static activeFieldMap:Map<number,Array<any>> = new Map();\r\n\r\n    /**\r\n     * 绑定到module的router指令对应的key，即router容器对应的key，格式为 {moduleId:routerKey,...}\r\n     */\r\n    static routerKeyMap:Map<number,string> = new Map();\r\n\r\n    /**\r\n     * 根路由\r\n     */\r\n    static root:Route;\r\n    \r\n    /**\r\n     * 把路径加入跳转列表(准备跳往该路由)\r\n     * @param path \t路径 \r\n     */\r\n    static go(path:string) {\r\n        //相同路径不加入\r\n        if(path === this.currentPath){\r\n            return;\r\n        }\r\n        \r\n        //添加路径到等待列表，已存在，不加入\r\n        if(this.waitList.indexOf(path) === -1){\r\n            this.waitList.push(path);\r\n        }\r\n\r\n        //延迟加载，避免同一个路径多次加入\r\n        setTimeout(()=>{\r\n            this.load();\r\n        },0);\r\n    }\r\n\r\n    /**\r\n     * 启动加载\r\n     */\r\n    private static load() {\r\n        //在加载，或无等待列表，则返回\r\n        if (this.waitList.length === 0) {\r\n            return;\r\n        }\r\n        \r\n        let path:string = this.waitList.shift();\r\n        this.start(path).then(()=>{\r\n            //继续加载\r\n            this.load();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 切换路由\r\n     * @param path \t路径\r\n     */\r\n    private static async start(path:string) {\r\n        let diff = this.compare(this.currentPath, path);\r\n        // 当前路由依赖的容器模块\r\n        let parentModule:Module;\r\n        if(diff[0] === null){\r\n            parentModule = ModuleFactory.getMain();\r\n        }else{\r\n            parentModule = await this.getModule(diff[0]);\r\n        }\r\n        \r\n        //onleave事件，从末往前执行\r\n        for (let i = diff[1].length - 1; i >= 0; i--) {\r\n            const r = diff[1][i];\r\n            if (!r.module) {\r\n                continue;\r\n            }\r\n            let module:Module = await this.getModule(r);\r\n            if (Util.isFunction(this.onDefaultLeave)) {\r\n                this.onDefaultLeave(module.model);\r\n            }\r\n            if (Util.isFunction(r.onLeave)) {\r\n                r.onLeave(module.model);\r\n            }\r\n            // 清理map映射\r\n            this.activeFieldMap.delete(module.id);\r\n            //module置为不激活\r\n            module.unactive();\r\n        }\r\n        if (diff[2].length === 0) { //路由相同，参数不同\r\n            let route:Route = diff[0];\r\n            if (route !== null) {\r\n                let module:Module = await this.getModule(route);\r\n                // 模块处理\r\n                this.dependHandle(module,route,diff[3]?diff[3].module:null);\r\n            }\r\n        } else { //路由不同\r\n            //加载模块\r\n            for (let ii = 0; ii < diff[2].length; ii++) {\r\n                let route:Route = diff[2][ii];\r\n\r\n                //路由不存在或路由没有模块（空路由）\r\n                if (!route || !route.module) {\r\n                    continue;\r\n                }\r\n                \r\n                let module:Module = await this.getModule(route);\r\n                \r\n                // 模块处理\r\n                this.dependHandle(module,route,parentModule);\r\n                //默认全局路由enter事件\r\n                if (Util.isFunction(this.onDefaultEnter)) {\r\n                    this.onDefaultEnter(module.model);\r\n                }\r\n                //当前路由进入事件\r\n                if (Util.isFunction(route.onEnter)) {\r\n                    route.onEnter(module.model);\r\n                }\r\n                parentModule = module;\r\n            }\r\n        }\r\n        \r\n        //如果是history popstate，则不加入history\r\n        if (this.startStyle === 0) {\r\n            //子路由，替换state\r\n            if (path.startsWith(this.currentPath)) {\r\n                history.replaceState(path, '', path);\r\n            } else { //路径push进history\r\n                history.pushState(path, '', path);\r\n            }\r\n        }\r\n        //修改currentPath\r\n        this.currentPath = path;\r\n        //设置start类型为正常start\r\n        this.startStyle = 0;\r\n    }\r\n\r\n    /*\r\n     * 重定向\r\n     * @param path \t路径\r\n     */\r\n    public static redirect(path:string) {\r\n        this.go(path);\r\n    }\r\n\r\n    /**\r\n     * 获取module\r\n     * @param route 路由对象 \r\n     * @returns     路由对应模块\r\n     */\r\n    private static async getModule(route:Route){\r\n        let module = route.module;\r\n        //已经是模块实例\r\n        if(typeof module === 'object'){\r\n            return module;\r\n        }\r\n        //延迟加载\r\n        if(typeof module === 'string' && route.modulePath){ //模块路径\r\n            module = await import(route.modulePath);\r\n            module = module[route.module];\r\n        }\r\n         //模块类\r\n        if(typeof module === 'function'){ \r\n            module = ModuleFactory.get(module);\r\n        }\r\n        route.module = module;\r\n        return module;\r\n    }\r\n    /**\r\n     * 比较两个路径对应的路由链\r\n     * @param path1 \t第一个路径\r\n     * @param path2 \t第二个路径\r\n     * @returns \t\t数组 [父路由或不同参数的路由，第一个需要销毁的路由数组，第二个需要增加的路由数组，不同参数路由的父路由]\r\n     */\r\n    private static compare(path1:string, path2:string):Array<any> {\r\n        // 获取路由id数组\r\n        let arr1:Array<Route> = null;\r\n        let arr2:Array<Route> = null;\r\n\r\n        if (path1) {\r\n            //采用克隆方式复制，避免被第二个路径返回的路由覆盖参数\r\n            arr1 = this.getRouteList(path1,true);\r\n        }\r\n        if (path2) {\r\n            arr2 = this.getRouteList(path2);\r\n        }\r\n\r\n        let len = 0;\r\n        if (arr1 !== null) {\r\n            len = arr1.length;\r\n        }\r\n\r\n        if (arr2 !== null) {\r\n            if (arr2.length < len) {\r\n                len = arr2.length;\r\n            }\r\n        } else {\r\n            len = 0;\r\n        }\r\n        //需要销毁的旧路由数组\r\n        let retArr1 = [];\r\n        //需要加入的新路由数组\r\n        let retArr2 = [];\r\n        let i = 0;\r\n        for (i = 0; i < len; i++) {\r\n            //找到不同路由开始位置\r\n            if (arr1[i].id === arr2[i].id) {\r\n                //比较参数\r\n                if (JSON.stringify(arr1[i].data) !== JSON.stringify(arr2[i].data)) {\r\n                    i++;\r\n                    break;\r\n                }\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n        \r\n        //旧路由改变数组\r\n        if (arr1 !== null) {\r\n            retArr1 = arr1.slice(i);\r\n        }\r\n        \r\n        //新路由改变数组（相对于旧路由）\r\n        if (arr2 !== null) {\r\n            retArr2 = arr2.slice(i);\r\n        }\r\n        \r\n        //上一级路由或参数不同的当前路由\r\n        let p1:Route = null;\r\n        //上二级路由或参数不同路由的上一级路由\r\n        let p2:Route = null;\r\n        if(arr2 && i>0){\r\n            // 可能存在空路由，需要向前遍历\r\n            for (let j=i-1;j>=0; j--) {\r\n                if(!p1){\r\n                    if (arr2[j].module) {\r\n                        p1 = arr2[j];\r\n                        continue;\r\n                    }\r\n                }else if(!p2){\r\n                    if (arr2[j].module) {\r\n                        p2 = arr2[j];\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return [p1, retArr1, retArr2,p2];\r\n    }\r\n\r\n    /**\r\n     * 添加激活字段\r\n     * @param module    模块 \r\n     * @param path      路由路径\r\n     * @param model     激活字段所在model\r\n     * @param field     字段名\r\n     */\r\n    public static addActiveField(module:Module,path:string,model:any,field:string){\r\n        if(!model || !field){\r\n            return;\r\n        }\r\n        let arr = Router.activeFieldMap.get(module.id);\r\n        if(!arr){  //尚未存在，新建\r\n            Router.activeFieldMap.set(module.id, [{path:path,model:model,field:field}]);\r\n        }else if(arr.find(item=>item.model===model&&item.field===field) === undefined){  //不重复添加\r\n            arr.push({path:path,model:model,field:field});\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 依赖模块相关处理\r\n     * @param module \t模块\r\n     * @param pm        依赖模块\r\n     * @param path \t\tview对应的route路径\r\n     */\r\n    private static dependHandle(module:Module,route:Route,pm:Module){\r\n        const me = this;\r\n        //激活\r\n        module.active();\r\n        //设置参数\r\n        let o = {\r\n            path: route.path\r\n        };\r\n        if (!Util.isEmpty(route.data)) {\r\n            o['data'] = route.data;\r\n        }\r\n        module.model['$route'] = o;\r\n        if(pm){\r\n            if(pm.state === 2){  //被依赖模块处于渲染后状态\r\n                module.setContainer(<HTMLElement>pm.getNode(Router.routerKeyMap.get(pm.id)));\r\n                this.setDomActive(pm,route.fullPath);\r\n            }else{ //被依赖模块不处于被渲染后状态\r\n                pm.addRenderOps(function(m,p){\r\n                    module.setContainer(<HTMLElement>m.getNode(Router.routerKeyMap.get(m.id)));\r\n                    me.setDomActive(m,p);\r\n                },1,[pm,route.fullPath],true);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置路由元素激活属性\r\n     * @param module    模块 \r\n     * @param path      路径\r\n     * @returns \r\n     */\r\n    private static setDomActive(module:Module,path:string){\r\n        let arr = Router.activeFieldMap.get(module.id);\r\n        if(!arr){\r\n            return;\r\n        }\r\n        for(let o of arr){\r\n            o.model[o.field] = o.path === path;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 添加路由\r\n     * @param route \t路由配置 \r\n     * @param parent \t父路由 \r\n     */\r\n     static addRoute(route:Route, parent:Route) {\r\n        //建立根(空路由)\r\n        if(!this.root){\r\n            this.root = new Route();\r\n        }\r\n        \r\n        let pathArr:Array<string> = route.path.split('/');\r\n        let node:Route = parent || this.root;\r\n        let param:Array<string> = [];\r\n        let paramIndex:number = -1; //最后一个参数开始\r\n        let prePath:string = '';    //前置路径\r\n        for (let i = 0; i < pathArr.length; i++) {\r\n            let v = pathArr[i].trim();\r\n            if (v === '') {\r\n                pathArr.splice(i--, 1);\r\n                continue;\r\n            }\r\n\r\n            if (v.startsWith(':')) { //参数\r\n                if (param.length === 0) {\r\n                    paramIndex = i;\r\n                }\r\n                param.push(v.substr(1));\r\n            } else {\r\n                paramIndex = -1;\r\n                param = []; //上级路由的参数清空\r\n                route.path = v; //暂存path\r\n                let j = 0;\r\n                for (; j < node.children.length; j++) {\r\n                    let r = node.children[j];\r\n                    if (r.path === v) {\r\n                        node = r;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                //没找到，创建新节点\r\n                if (j === node.children.length) {\r\n                    if (prePath !== '') {\r\n                        new Route({ path: prePath, parent:node });\r\n                        node = node.children[node.children.length - 1];\r\n                    }\r\n                    prePath = v;\r\n                }\r\n            }\r\n\r\n            //不存在参数\r\n            if (paramIndex === -1) {\r\n                route.params = [];\r\n            } else {\r\n                route.params = param;\r\n            }\r\n        }\r\n\r\n        //添加到树\r\n        if (node !== undefined && node !== route) {\r\n            route.path = prePath;\r\n            node.addChild(route);\r\n        }\r\n        \r\n        // 添加到路由map    \r\n        this.routeMap.set(route.id, route);\r\n    }\r\n\r\n    /**\r\n     * 获取路由数组\r\n     * @param path \t要解析的路径\r\n     * @param clone 是否clone，如果为false，则返回路由树的路由对象，否则返回克隆对象\r\n     * @returns     路由对象数组\r\n     */\r\n    static getRouteList(path:string,clone?:boolean):Array<Route> {\r\n        if(!this.root){\r\n            return[];\r\n        }\r\n        let pathArr:string[] = path.split('/');\r\n        let node:Route = this.root;\r\n        \r\n        let paramIndex:number = 0;      //参数索引\r\n        let retArr:Array<Route> = [];\r\n        let fullPath:string = '';       //完整路径\r\n        let preNode:Route = this.root;  //前一个节点\r\n\r\n        for (let i = 0; i < pathArr.length; i++) {\r\n            let v:string = pathArr[i].trim();\r\n            if (v === '') {\r\n                continue;\r\n            }\r\n            let find:boolean = false;\r\n            for (let j=0; j<node.children.length; j++) {\r\n                if (node.children[j].path === v) {\r\n                    //设置完整路径\r\n                    if (preNode !== this.root) {\r\n                        preNode.fullPath = fullPath;\r\n                        preNode.data = node.data;\r\n                        retArr.push(preNode);\r\n                    }\r\n\r\n                    //设置新的查找节点\r\n                    node = clone?node.children[j].clone():node.children[j];\r\n                    //参数清空\r\n                    node.data = {};\r\n                    preNode = node;\r\n                    find = true;\r\n                    //参数索引置0\r\n                    paramIndex = 0;\r\n                    break;\r\n                }\r\n            }\r\n            //路径叠加\r\n            fullPath += '/' + v;\r\n            //不是孩子节点,作为参数\r\n            if (!find) {\r\n                if (paramIndex < node.params.length) { //超出参数长度的废弃\r\n                    node.data[node.params[paramIndex++]] = v;\r\n                }\r\n            }\r\n        }\r\n\r\n        //最后一个节点\r\n        if (node !== this.root) {\r\n            node.fullPath = fullPath;\r\n            retArr.push(node);\r\n        }\r\n        return retArr;\r\n    }\r\n}\r\n\r\n//处理popstate事件\r\nwindow.addEventListener('popstate', function (e) {\r\n    //根据state切换module\r\n    const state = history.state;\r\n    if (!state) {\r\n        return;\r\n    }\r\n    Router.startStyle = 1;\r\n    Router.go(state);\r\n});","import { Router } from \"./router\";\r\nimport { IRouteCfg } from \"./types\";\r\nimport { Util } from \"./util\";\r\n\r\n/**\r\n * 路由类\r\n */\r\n export class Route {\r\n    /**\r\n     * 路由id\r\n     */\r\n    id:number;\r\n    /**\r\n     * 路由参数名数组\r\n     */\r\n    params:Array<string> = [];\r\n    /**\r\n     * 路由参数数据\r\n     */\r\n    data:any = {};\r\n    /**\r\n     * 子路由\r\n     */\r\n    children:Array<Route> = [];\r\n    /**\r\n     * 进入路由事件方法\r\n     */\r\n    onEnter:Function;\r\n    /**\r\n     * 离开路由方法\r\n     */\r\n    onLeave:Function;\r\n    /**\r\n     * 是否使用父路由路径\r\n     */\r\n    useParentPath:boolean;\r\n    /**\r\n     * 路由路径\r\n     */\r\n    path:string;\r\n    /**\r\n     * 完整路径\r\n     */\r\n    fullPath:string;\r\n\r\n    /**\r\n     * 路由对应模块对象或类或模块类名\r\n     */\r\n    module:any;\r\n    \r\n    /**\r\n     * 模块路径，当module为类名时需要，默认执行延迟加载\r\n     */\r\n    modulePath:string;\r\n\r\n    /**\r\n     * 父路由\r\n     */\r\n    parent:Route;\r\n\r\n    /**\r\n     * \r\n     * @param config 路由配置项\r\n     */\r\n    constructor(config?:IRouteCfg) {\r\n        if (!config || Util.isEmpty(config.path)) {\r\n            return;\r\n        }\r\n        //参数赋值\r\n        for(let o in config){\r\n            this[o] = config[o];   \r\n        }\r\n        this.id = Util.genId();\r\n        Router.addRoute(this, config.parent);\r\n        //子路由\r\n        if (config.routes && Array.isArray(config.routes)) {\r\n            config.routes.forEach((item) => {\r\n                item.parent = this;\r\n                new Route(item);\r\n            });\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * 添加子路由\r\n     * @param child \r\n     */\r\n    addChild(child:Route){\r\n        this.children.push(child);\r\n        child.parent = this;\r\n    }\r\n\r\n    /**\r\n     * 克隆\r\n     * @returns 克隆对象\r\n     */\r\n    clone(){\r\n        let r = new Route();\r\n        Object.getOwnPropertyNames(this).forEach(item=>{\r\n            if(item === 'data'){    \r\n                return;\r\n            }\r\n            r[item] = this[item];\r\n        });\r\n        if(this.data){\r\n            r.data = Util.clone(this.data);\r\n        }\r\n        return r;\r\n    }\r\n}","import { NError } from \"./error\";\r\nimport { Util } from \"./util\";\r\n\r\n/**\r\n * 调度器，用于每次空闲的待操作序列调度\r\n */\r\nexport class Scheduler{\r\n\tprivate static tasks:Array<any> = [];\r\n\tpublic static dispatch(){\r\n\t\tScheduler.tasks.forEach((item)=>{\r\n\t\t\tif(Util.isFunction(item.func)){\r\n\t\t\t\tif(item.thiser){\r\n\t\t\t\t\titem.func.call(item.thiser);\r\n\t\t\t\t}else{\r\n\t\t\t\t\titem.func();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * 启动调度器\r\n\t * @param scheduleTick \t渲染间隔\r\n\t */\r\n\tpublic static start(scheduleTick?:number){\r\n\t\tScheduler.dispatch();\r\n\t\tif(window.requestAnimationFrame){\r\n\t\t\twindow.requestAnimationFrame(Scheduler.start);\r\n\t\t}else{\r\n\t\t\twindow.setTimeout(Scheduler.start,scheduleTick||50);\r\n\t\t}\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * 添加任务\r\n\t * @param foo \t\t任务和this指向\r\n\t * @param thiser \tthis指向\r\n\t */\r\n\tpublic static addTask(foo:Function,thiser?:any){\r\n\t\tif(!Util.isFunction(foo)){\r\n\t\t\tthrow new NError(\"invoke\",\"Scheduler.addTask\",\"0\",\"function\");\r\n\t\t}\r\n\t\t\r\n\t\tScheduler.tasks.push({func:foo,thiser:thiser});\r\n\t}\r\n\r\n\t/**\r\n\t * 移除任务\r\n\t * @param foo \t任务\r\n\t */\r\n\tpublic static removeTask(foo){\r\n\t\tif(!Util.isFunction(foo)){\r\n\t\t\tthrow new NError(\"invoke\",\"Scheduler.removeTask\",\"0\",\"function\");\r\n\t\t}\r\n\t\tlet ind = -1;\r\n\t\tif((ind = Scheduler.tasks.indexOf(foo)) !== -1){\r\n\t\t\tScheduler.tasks.splice(ind,1);\r\n\t\t}\t\r\n\t}\r\n}\r\n","import { DirectiveManager } from \"./directivemanager\";\r\nimport { NError } from \"./error\";\r\nimport { NodomMessage_en } from \"./locales/msg_en\";\r\nimport { ModuleFactory } from \"./modulefactory\";\r\nimport { Renderer } from \"./renderer\";\r\nimport { Route } from \"./route\";\r\nimport { Scheduler } from \"./scheduler\";\r\nimport { IRouteCfg } from \"./types\";\r\nimport { Util } from \"./util\";\r\n\r\n/**\r\n * 新建store方法\r\n */\r\n/**\r\n * nodom提示消息\r\n */\r\nexport var NodomMessage;\r\n/**\r\n * 新建一个App\r\n * @param clazz     模块类\r\n * @param el        el选择器\r\n */\r\nexport function nodom(clazz:any,el:string){\r\n    //渲染器启动渲染\r\n    Scheduler.addTask(Renderer.render, Renderer);\r\n    //启动调度器\r\n    Scheduler.start();\r\n    NodomMessage = NodomMessage_en;\r\n    let mdl = ModuleFactory.get(clazz);\r\n    mdl.setContainer(document.querySelector(el));\r\n    mdl.active();\r\n}\r\n\r\n/**\r\n * 暴露的创建路由方法\r\n * @param config  数组或单个配置\r\n */\r\nexport function createRoute(config: IRouteCfg | Array<IRouteCfg>): Route {\r\n    if (Util.isArray(config)) {\r\n        for (let item of <Array<IRouteCfg>>config) {\r\n            new Route(item);\r\n        }\r\n    } else {\r\n        return new Route(<IRouteCfg>config);\r\n    }\r\n}\r\n\r\n/**\r\n * 创建指令\r\n * @param name      指令名 \r\n * @param priority  优先级（1最小，1-10为框架保留优先级）\r\n * @param init      初始化方法\r\n * @param handler   渲染时方法\r\n */\r\nexport function createDirective(name: string, handler: Function,priority?: number) {\r\n    return DirectiveManager.addType(name,handler,priority);\r\n}\r\n\r\n/**\r\n * 注册模块\r\n * @param clazz     模块类\r\n * @param name      注册名，如果没有，则为类名\r\n */\r\nexport function registModule(clazz:any,name?:string){\r\n    ModuleFactory.addClass(clazz,name);\r\n}\r\n\r\n/**\r\n * ajax 请求\r\n * @param config    object 或 string\r\n *                  如果为string，则直接以get方式获取资源\r\n *                  object 项如下:\r\n *                  参数名|类型|默认值|必填|可选值|描述\r\n *                  -|-|-|-|-|-\r\n *                  url|string|无|是|无|请求url\r\n *\t\t\t\t\tmethod|string|GET|否|GET,POST,HEAD|请求类型\r\n *\t\t\t\t\tparams|Object/FormData|{}|否|无|参数，json格式\r\n *\t\t\t\t\tasync|bool|true|否|true,false|是否异步\r\n *  \t\t\t\ttimeout|number|0|否|无|请求超时时间\r\n *                  type|string|text|否|json,text|\r\n *\t\t\t\t\twithCredentials|bool|false|否|true,false|同源策略，跨域时cookie保存\r\n *                  header|Object|无|否|无|request header 对象\r\n *                  user|string|无|否|无|需要认证的请求对应的用户名\r\n *                  pwd|string|无|否|无|需要认证的请求对应的密码\r\n *                  rand|bool|无|否|无|请求随机数，设置则浏览器缓存失效\r\n */\r\nexport async function request(config): Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n        if (typeof config === 'string') {\r\n            config = {\r\n                url: config\r\n            }\r\n        }\r\n        config.params = config.params || {};\r\n        //随机数\r\n        if (config.rand) { //针对数据部分，仅在app中使用\r\n            config.params.$rand = Math.random();\r\n        }\r\n        let url: string = config.url;\r\n        const async: boolean = config.async === false ? false : true;\r\n        const req: XMLHttpRequest = new XMLHttpRequest();\r\n        //设置同源策略\r\n        req.withCredentials = config.withCredentials;\r\n        //类型默认为get\r\n        const method: string = (config.method || 'GET').toUpperCase();\r\n        //超时，同步时不能设置\r\n        req.timeout = async ? config.timeout : 0;\r\n\r\n        req.onload = () => {\r\n            if (req.status === 200) {\r\n                let r = req.responseText;\r\n                if (config.type === 'json') {\r\n                    try {\r\n                        r = JSON.parse(r);\r\n                    } catch (e) {\r\n                        reject({ type: \"jsonparse\" });\r\n                    }\r\n                }\r\n                resolve(r);\r\n            } else {\r\n                reject({ type: 'error', url: url });\r\n            }\r\n        }\r\n\r\n        req.ontimeout = () => reject({ type: 'timeout' });\r\n        req.onerror = () => reject({ type: 'error', url: url });\r\n        //上传数据\r\n        let data = null;\r\n        switch (method) {\r\n            case 'GET':\r\n                //参数\r\n                let pa: string;\r\n                if (Util.isObject(config.params)) {\r\n                    let ar: string[] = [];\r\n                    Util.getOwnProps(config.params).forEach(function (key) {\r\n                        ar.push(key + '=' + config.params[key]);\r\n                    });\r\n                    pa = ar.join('&');\r\n                }\r\n                if (pa !== undefined) {\r\n                    if (url.indexOf('?') !== -1) {\r\n                        url += '&' + pa;\r\n                    } else {\r\n                        url += '?' + pa;\r\n                    }\r\n                }\r\n\r\n                break;\r\n            case 'POST':\r\n                if (config.params instanceof FormData) {\r\n                    data = config.params;\r\n                } else {\r\n                    let fd: FormData = new FormData();\r\n                    for (let o in config.params) {\r\n                        fd.append(o, config.params[o]);\r\n                    }\r\n                    data = fd;\r\n                }\r\n                break;\r\n        }\r\n\r\n        req.open(method, url, async, config.user, config.pwd);\r\n        //设置request header\r\n        if (config.header) {\r\n            Util.getOwnProps(config.header).forEach((item) => {\r\n                req.setRequestHeader(item, config.header[item]);\r\n            })\r\n        }\r\n        req.send(data);\r\n    }).catch((re) => {\r\n        switch (re.type) {\r\n            case \"error\":\r\n                throw new NError(\"notexist1\", NodomMessage.TipWords['resource'], re.url);\r\n            case \"timeout\":\r\n                throw new NError(\"timeout\");\r\n            case \"jsonparse\":\r\n                throw new NError(\"jsonparse\");\r\n        }\r\n    });\r\n}","import { NodomMessage } from \"./nodom\";\r\nimport { Util } from \"./util\";\r\n\r\n/**\r\n * 异常处理类\r\n * @since       1.0.0\r\n */\r\nexport  class NError extends Error{\r\n    constructor(errorName:string,p1?:string,p2?:string,p3?:string,p4?:string){\r\n        super(errorName);\r\n        let msg:string = NodomMessage.ErrorMsgs[errorName];\r\n        if(msg === undefined){\r\n            this.message = \"未知错误\";\r\n            return;\r\n        }\r\n        //复制请求参数\r\n        let params:Array<string> = [msg];\r\n        for(let i=1;i<arguments.length;i++){\r\n            params.push(arguments[i]);\r\n        }\r\n        this.message = Util.compileStr.apply(null,params);\r\n    }\r\n}\r\n","import { NError } from \"./error\";\r\nimport { NEvent } from \"./event\";\r\nimport { NodomMessage } from \"./nodom\";\r\nimport { VirtualDom } from \"./virtualdom\";\r\n/**\r\n * 基础服务库\r\n * @since       1.0.0\r\n */\r\nexport class Util {\r\n    /**\r\n     * 全局id\r\n     */\r\n    private static generatedId: number = 1;\r\n    \r\n    /**\r\n     * js 保留字 map\r\n     */\r\n    public static keyWordMap = new Map();\r\n    \r\n    //唯一主键\r\n    public static genId() {\r\n        return this.generatedId++;\r\n    }\r\n\r\n    /**\r\n     * 初始化保留词map\r\n     */\r\n    public static initKeyMap(){\r\n        this.keyWordMap.set('arguments',true);\r\n        this.keyWordMap.set('boolean',true);\r\n        this.keyWordMap.set('break',true);\r\n        this.keyWordMap.set('byte',true);\r\n        this.keyWordMap.set('catch',true);\r\n        this.keyWordMap.set('char',true);\r\n        this.keyWordMap.set('const',true);\r\n        this.keyWordMap.set('default',true);\r\n        this.keyWordMap.set('delete',true);\r\n        this.keyWordMap.set('do',true);\r\n        this.keyWordMap.set('double',true);\r\n        this.keyWordMap.set('else',true);\r\n        this.keyWordMap.set('enum',true);\r\n        this.keyWordMap.set('eval',true);\r\n        this.keyWordMap.set('false',true);\r\n        this.keyWordMap.set('float',true);\r\n        this.keyWordMap.set('for',true);\r\n        this.keyWordMap.set('function',true);\r\n        this.keyWordMap.set('goto',true);\r\n        this.keyWordMap.set('if',true);\r\n        this.keyWordMap.set('in',true);\r\n        this.keyWordMap.set('instanceof',true);\r\n        this.keyWordMap.set('int',true);\r\n        this.keyWordMap.set('let',true);\r\n        this.keyWordMap.set('long',true);\r\n        this.keyWordMap.set('new',true);\r\n        this.keyWordMap.set('null',true);\r\n        this.keyWordMap.set('return',true);\r\n        this.keyWordMap.set('short',true);\r\n        this.keyWordMap.set('switch',true);\r\n        this.keyWordMap.set('this',true);\r\n        this.keyWordMap.set('throw',true);\r\n        this.keyWordMap.set('true',true);\r\n        this.keyWordMap.set('try',true);\r\n        this.keyWordMap.set('this',true);\r\n        this.keyWordMap.set('throw',true);\r\n        this.keyWordMap.set('typeof',true);\r\n        this.keyWordMap.set('var',true);\r\n        this.keyWordMap.set('while',true);\r\n        this.keyWordMap.set('with',true);\r\n        this.keyWordMap.set('Array',true);\r\n        this.keyWordMap.set('Date',true);\r\n        this.keyWordMap.set('Set',true);\r\n        this.keyWordMap.set('Map',true);\r\n        this.keyWordMap.set('eval',true);\r\n        this.keyWordMap.set('function',true);\r\n        this.keyWordMap.set('Infinity',true);\r\n        this.keyWordMap.set('isFinite',true);\r\n        this.keyWordMap.set('isNaN',true);\r\n        this.keyWordMap.set('isPrototypeOf',true);\r\n        this.keyWordMap.set('Math',true);\r\n        this.keyWordMap.set('NaN',true);\r\n        this.keyWordMap.set('Number',true);\r\n        this.keyWordMap.set('Object',true);\r\n        this.keyWordMap.set('prototype',true);\r\n        this.keyWordMap.set('String',true);\r\n        this.keyWordMap.set('isPrototypeOf',true);\r\n        this.keyWordMap.set('undefined',true);\r\n        this.keyWordMap.set('valueOf',true);\r\n    }\r\n    /**\r\n     * 是否为 js 保留关键字\r\n     * @param name  名字\r\n     * @returns     如果为保留字，则返回true，否则返回false\r\n     */\r\n    public static isKeyWord(name:string):boolean{\r\n        return this.keyWordMap.has(name);\r\n    }\r\n\r\n    /******对象相关******/\r\n\r\n    /**\r\n     * 对象复制\r\n     * @param srcObj    源对象\r\n     * @param expKey    不复制的键正则表达式或名\r\n     * @param extra     clone附加参数\r\n     * @returns         复制的对象\r\n     */\r\n\r\n    public static clone(srcObj: Object, expKey?: RegExp | string[], extra?: any): any {\r\n        let me = this;\r\n        let map: WeakMap<Object, any> = new WeakMap();\r\n        return clone(srcObj, expKey, extra);\r\n\r\n        /**\r\n         * clone对象\r\n         * @param src   待clone对象\r\n         * @param extra clone附加参数\r\n         * @returns     克隆后的对象\r\n         */\r\n        function clone(src, expKey, extra?) {\r\n            //非对象或函数，直接返回            \r\n            if (!src || typeof src !== 'object' || Util.isFunction(src)) {\r\n                return src;\r\n            }\r\n            let dst;\r\n\r\n            //带有clone方法，则直接返回clone值\r\n            if (src.clone && Util.isFunction(src.clone)) {\r\n                return src.clone(extra);\r\n            } else if (me.isObject(src)) {\r\n                dst = new Object();\r\n                //把对象加入map，如果后面有新克隆对象，则用新克隆对象进行覆盖\r\n                map.set(src, dst);\r\n                Object.getOwnPropertyNames(src).forEach((prop) => {\r\n                    //不克隆的键\r\n                    if (expKey) {\r\n                        if (expKey.constructor === RegExp && (<RegExp>expKey).test(prop) //正则表达式匹配的键不复制\r\n                            || Util.isArray(expKey) && (<any[]>expKey).includes(prop)                        //被排除的键不复制\r\n                        ) {\r\n                            return;\r\n                        }\r\n                    }\r\n                    dst[prop] = getCloneObj(src[prop], expKey, extra);\r\n                });\r\n            } else if (me.isMap(src)) {\r\n                dst = new Map();\r\n                //把对象加入map，如果后面有新克隆对象，则用新克隆对象进行覆盖\r\n                src.forEach((value, key) => {\r\n                    //不克隆的键\r\n                    if (expKey) {\r\n                        if (expKey.constructor === RegExp && (<RegExp>expKey).test(key)       //正则表达式匹配的键不复制\r\n                            || (<any[]>expKey).includes(key)) {     //被排除的键不复制\r\n                            return;\r\n                        }\r\n                    }\r\n                    dst.set(key, getCloneObj(value, expKey, extra));\r\n                });\r\n            } else if (me.isArray(src)) {\r\n                dst = new Array();\r\n                //把对象加入map，如果后面有新克隆对象，则用新克隆对象进行覆盖\r\n                src.forEach(function (item, i) {\r\n                    dst[i] = getCloneObj(item, expKey, extra);\r\n                });\r\n            }\r\n            return dst;\r\n        }\r\n\r\n        /**\r\n         * 获取clone对象\r\n         * @param value     待clone值\r\n         * @param expKey    排除键\r\n         * @param extra     附加参数\r\n         */\r\n        function getCloneObj(value, expKey, extra) {\r\n            if (typeof value === 'object' && !Util.isFunction(value)) {\r\n                let co = null;\r\n                if (!map.has(value)) {  //clone新对象\r\n                    co = clone(value, expKey, extra);\r\n                } else {                    //从map中获取对象\r\n                    co = map.get(value);\r\n                }\r\n                return co;\r\n            }\r\n            return value;\r\n        }\r\n    }\r\n    /**\r\n     * 合并多个对象并返回\r\n     * @param   参数数组\r\n     * @returns 返回对象\r\n     */\r\n    public static merge(o1?: Object, o2?: Object, o3?: Object, o4?: Object, o5?: Object, o6?: Object) {\r\n        let me = this;\r\n        for (let i = 0; i < arguments.length; i++) {\r\n            if (!this.isObject(arguments[i])) {\r\n                throw new NError('invoke', 'Util.merge', i + '', 'object');\r\n            }\r\n        }\r\n        let retObj = Object.assign.apply(null, arguments);\r\n        subObj(retObj);\r\n        return retObj;\r\n        //处理子对象\r\n        function subObj(obj) {\r\n            for (let o in obj) {\r\n                if (me.isObject(obj[o]) || me.isArray(obj[o])) { //对象或数组\r\n                    retObj[o] = me.clone(retObj[o]);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 把obj2对象所有属性赋值给obj1\r\n     */\r\n    public static assign(obj1, obj2) {\r\n        if (Object.assign) {\r\n            Object.assign(obj1, obj2);\r\n        } else {\r\n            this.getOwnProps(obj2).forEach(function (p) {\r\n                obj1[p] = obj2[p];\r\n            });\r\n        }\r\n        return obj1;\r\n    }\r\n\r\n    /**\r\n     * 比较两个对象值是否相同(只比较object和array)\r\n     * @param src   源对象\r\n     * @param dst   目标对象 \r\n     * @returns     值相同则返回true，否则返回false \r\n     */\r\n    public static compare(src:any,dst:any,deep?:boolean):boolean{\r\n        if(!src && !dst){\r\n            return true;\r\n        }\r\n        if (typeof src !== 'object' || typeof dst !== 'object') {\r\n            return false;\r\n        }\r\n        const keys = Object.getOwnPropertyNames(src);\r\n        if(keys.length !== Object.getOwnPropertyNames(dst).length){\r\n            return false;\r\n        }\r\n        for(let k of keys){\r\n            if(src[k] !== dst[k]){\r\n                return false;\r\n            }\r\n        }\r\n        //深度比较\r\n        if(deep){\r\n            for(let k of keys){\r\n                let r = this.compare(src[k],dst[k]);\r\n                if(!r){\r\n                    return false;\r\n                }\r\n            }   \r\n        }\r\n        return true;\r\n    }\r\n    /**\r\n     * 获取对象自有属性\r\n     */\r\n    public static getOwnProps(obj): Array<string> {\r\n        if (!obj) {\r\n            return [];\r\n        }\r\n        return Object.getOwnPropertyNames(obj);\r\n    }\r\n    /**************对象判断相关************/\r\n    /**\r\n     * 是否为函数\r\n     * @param foo   检查的对象\r\n     * @returns     true/false\r\n     */\r\n    public static isFunction(foo): boolean {\r\n        return foo !== undefined && foo !== null && foo.constructor === Function;\r\n    }\r\n\r\n    /**\r\n     * 是否为数组\r\n     * @param obj   检查的对象\r\n     * @returns     true/false\r\n     */\r\n    public static isArray(obj): boolean {\r\n        return Array.isArray(obj);\r\n    }\r\n\r\n    /**\r\n     * 判断是否为map\r\n     * @param obj \r\n     */\r\n    public static isMap(obj): boolean {\r\n        return obj !== null && obj !== undefined && obj.constructor === Map;\r\n    }\r\n\r\n    /**\r\n     * 是否为对象\r\n     * @param obj   检查的对象\r\n     * @returns true/false\r\n     */\r\n    public static isObject(obj): boolean {\r\n        return obj !== null && obj !== undefined && obj.constructor === Object;\r\n    }\r\n\r\n    /**\r\n     * 判断是否为整数\r\n     * @param v 检查的值\r\n     * @returns true/false\r\n     */\r\n    public static isInt(v): boolean {\r\n        return Number.isInteger(v);\r\n    }\r\n    /**\r\n     * 判断是否为number\r\n     * @param v 检查的值\r\n     * @returns true/false\r\n     */\r\n    public static isNumber(v): boolean {\r\n        return typeof v === 'number';\r\n    }\r\n\r\n    /**\r\n     * 判断是否为boolean\r\n     * @param v 检查的值\r\n     * @returns true/false\r\n     */\r\n    public static isBoolean(v): boolean {\r\n        return typeof v === 'boolean';\r\n    }\r\n    /**\r\n     * 判断是否为字符串\r\n     * @param v 检查的值\r\n     * @returns true/false\r\n     */\r\n    public static isString(v): boolean {\r\n        return typeof v === 'string';\r\n    }\r\n\r\n    /**\r\n     * 是否为数字串\r\n     * @param v 检查的值\r\n     * @returns true/false\r\n     */\r\n    public static isNumberString(v): boolean {\r\n        return /^\\d+\\.?\\d*$/.test(v);\r\n    }\r\n\r\n    /**\r\n     * 对象/字符串是否为空\r\n     * @param obj   检查的对象\r\n     * @returns     true/false\r\n     */\r\n    public static isEmpty(obj): boolean {\r\n        if (obj === null || obj === undefined)\r\n            return true;\r\n        let tp = typeof obj;\r\n        if (this.isObject(obj)) {\r\n            let keys = Object.keys(obj);\r\n            if (keys !== undefined) {\r\n                return keys.length === 0;\r\n            }\r\n        } else if (tp === 'string') {\r\n            return obj === '';\r\n        }\r\n        return false;\r\n    }\r\n\r\n\r\n    /**\r\n     * 把srcNode替换为nodes\r\n     * @param srcNode       源dom\r\n     * @param nodes         替换的dom或dom数组\r\n     */\r\n    public static replaceNode(srcNode: Node, nodes: Node | Array<Node>) {\r\n        // if (!this.isNode(srcNode)) {\r\n        //     throw new NError('invoke', 'this.replaceNode', '0', 'Node');\r\n        // }\r\n\r\n        // if (!this.isNode(nodes) && !this.isArray(nodes)) {\r\n        //     throw new NError('invoke1', 'this.replaceNode', '1', 'Node', 'Node Array');\r\n        // }\r\n        let pnode: Node = srcNode.parentNode;\r\n        let bnode: Node = srcNode.nextSibling;\r\n        if (pnode === null) {\r\n            return;\r\n        }\r\n        pnode.removeChild(srcNode);\r\n        const nodeArr: Array<Node> = this.isArray(nodes) ? <Node[]>nodes : [<Node>nodes];\r\n        nodeArr.forEach(function (node) {\r\n            if (bnode === undefined || bnode === null) {\r\n                pnode.appendChild(node);\r\n            } else {\r\n                pnode.insertBefore(node, bnode);\r\n            }\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * 清空子节点\r\n     * @param el\r\n     */\r\n    public static empty(el: HTMLElement) {\r\n        const me = this;\r\n        let nodes: NodeList = el.childNodes;\r\n        for (let i = nodes.length - 1; i >= 0; i--) {\r\n            el.removeChild(nodes[i]);\r\n        }\r\n    }\r\n    \r\n    /******日期相关******/\r\n    /**\r\n     * 日期格式化\r\n     * @param srcDate   时间戳串\r\n     * @param format    日期格式\r\n     * @returns          日期串\r\n     */\r\n    public static formatDate(srcDate: string | number, format: string): string {\r\n        //时间戳\r\n        let timeStamp: number;\r\n        if (this.isString(srcDate)) {\r\n            //排除日期格式串,只处理时间戳\r\n            let reg = /^\\d+$/;\r\n            if (reg.test(<string>srcDate) === true) {\r\n                timeStamp = parseInt(<string>srcDate);\r\n            }\r\n        } else if (this.isNumber(srcDate)) {\r\n            timeStamp = <number>srcDate;\r\n        } else {\r\n            throw new NError('invoke', 'this.formatDate', '0', 'date string', 'date');\r\n        }\r\n        //得到日期\r\n        let date: Date = new Date(timeStamp);\r\n        // invalid date\r\n        if (isNaN(date.getDay())) {\r\n            return '';\r\n        }\r\n\r\n        let o = {\r\n            \"M+\": date.getMonth() + 1, //月份\r\n            \"d+\": date.getDate(), //日\r\n            \"h+\": date.getHours() % 12 === 0 ? 12 : date.getHours() % 12, //小时\r\n            \"H+\": date.getHours(), //小时\r\n            \"m+\": date.getMinutes(), //分\r\n            \"s+\": date.getSeconds(), //秒\r\n            \"q+\": Math.floor((date.getMonth() + 3) / 3), //季度\r\n            \"S\": date.getMilliseconds() //毫秒\r\n        };\r\n\r\n        //年\r\n        if (/(y+)/.test(format)) {\r\n            format = format.replace(RegExp.$1, (date.getFullYear() + \"\").substr(4 - RegExp.$1.length));\r\n        }\r\n        //月日\r\n        this.getOwnProps(o).forEach(function (k) {\r\n            if (new RegExp(\"(\" + k + \")\").test(format)) {\r\n                format = format.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : ((\"00\" + o[k]).substr((\"\" + o[k]).length)));\r\n            }\r\n        });\r\n\r\n        //星期\r\n        if (/(E+)/.test(format)) {\r\n            format = format.replace(RegExp.$1, ((RegExp.$1.length > 1) ? (RegExp.$1.length > 2 ? \"/u661f/u671f\" : \"/u5468\") : \"\") + NodomMessage.WeekDays[date.getDay() + \"\"]);\r\n        }\r\n        return format;\r\n    }\r\n\r\n    /******字符串相关*****/\r\n    /**\r\n     * 编译字符串，把{n}替换成带入值\r\n     * @param str 待编译的字符串\r\n     * @param args1,args2,args3,... 待替换的参数\r\n     * @returns 转换后的消息\r\n     */\r\n    public static compileStr(src: string, p1?: any, p2?: any, p3?: any, p4?: any, p5?: any): string {\r\n        let reg: RegExp;\r\n        let args = arguments;\r\n        let index = 0;\r\n        for (; ;) {\r\n            if (src.indexOf('\\{' + index + '\\}') !== -1) {\r\n                reg = new RegExp('\\\\{' + index + '\\\\}', 'g');\r\n                src = src.replace(reg, args[index + 1]);\r\n                index++;\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n        return src;\r\n    }\r\n\r\n    /**\r\n     * 函数调用\r\n     * @param foo   函数\r\n     * @param obj   this指向\r\n     * @param args  参数数组\r\n     */\r\n    public static apply(foo: Function, obj: any, args?: Array<any>): any {\r\n        if (!foo) {\r\n            return;\r\n        }\r\n        return Reflect.apply(foo, obj || null, args);\r\n    }\r\n\r\n    /**\r\n     * 合并并修正路径，即路径中出现'//','///','\\/'的情况，统一置换为'/'\r\n     * @param paths 待合并路径数组\r\n     * @returns     返回路径\r\n     */\r\n    public static mergePath(paths: string[]): string {\r\n        return paths.join('/').replace(/(\\/{2,})|\\\\\\//g, '\\/');\r\n    }\r\n\r\n    /**\r\n     * eval\r\n     * @param evalStr   eval串\r\n     * @returns         eval值\r\n     */\r\n    public static eval(evalStr: string): any {\r\n        return new Function(`return(${evalStr})`)();\r\n    }\r\n\r\n    /**\r\n     * 改造 dom key，避免克隆时重复，格式为：key_id\r\n     * @param node  节点\r\n     * @param id    附加id\r\n     * @param deep  是否深度处理\r\n     */\r\n    public static setNodeKey(node:VirtualDom, id?:string,deep?:boolean){\r\n        node.key += '_' + (id||Util.genId());\r\n        if(deep && node.children){\r\n            for(let c of node.children) {\r\n                Util.setNodeKey(c,id,deep);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n//初始化keymap\r\nUtil.initKeyMap();","import { DirectiveManager } from \"./directivemanager\";\r\nimport { DirectiveType } from \"./directivetype\";\r\nimport { VirtualDom } from \"./virtualdom\";\r\nimport { Module } from \"./module\";\r\nimport { Util } from \"./util\";\r\nimport { Expression } from \"./expression\";\r\nimport { NError } from \"./error\";\r\nimport { NodomMessage } from \"./nodom\";\r\n\r\n/**\r\n * 指令类\r\n */\r\nexport  class Directive {\r\n    /**\r\n     * 指令id\r\n     */\r\n    public id:number;\r\n\r\n    /**\r\n     * 指令类型，指令管理器中定义\r\n     */\r\n    public type:DirectiveType;\r\n    \r\n    /**\r\n     * 指令值\r\n     */\r\n    public value:any;\r\n    \r\n    /**\r\n     * 表达式id\r\n     */\r\n    public expression:Expression;\r\n\r\n    /**\r\n     * 禁用\r\n     */\r\n    public disabled:boolean;\r\n    /**\r\n     * 构造方法\r\n     * @param type  \t类型名\r\n     * @param value \t指令值\r\n     */\r\n    constructor(type?:string,value?:string|Expression) {\r\n        this.id = Util.genId();\r\n        if(type){\r\n            this.type = DirectiveManager.getType(type);\r\n            if(!this.type){\r\n                throw new NError('notexist1',NodomMessage.TipWords['directive'],type);\r\n            }\r\n        }\r\n        \r\n        if (Util.isString(value)) {\r\n            this.value = (<string>value).trim();\r\n        }else if(value instanceof Expression){\r\n            this.expression = value;\r\n        }else{\r\n            this.value = value;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 执行指令\r\n     * @param module    模块\r\n     * @param dom       渲染目标节点对象\r\n     * @param src       源节点\r\n     * @returns         true/false\r\n     */\r\n    public exec(module:Module,dom:any,src:VirtualDom):boolean {\r\n        //禁用，不执行\r\n        if(this.disabled){\r\n            return true;\r\n        }\r\n        if(this.expression){\r\n            this.value = this.expression.val(module,dom.model);\r\n        }\r\n        return this.type.handle.apply(this,[module,dom,src]);\r\n    }\r\n\r\n    /**\r\n     * 设置参数\r\n     * @param module    模块\r\n     * @param dom       指令对应的虚拟dom\r\n     * @param name      参数名\r\n     * @param value     参数值\r\n     */\r\n    public setParam(module:Module,dom:VirtualDom,name:string,value:any){\r\n        module.objectManager.setDirectiveParam(this.id,dom.key,name,value);\r\n    }\r\n\r\n    /**\r\n     * 获取参数值\r\n     * @param module    模块 \r\n     * @param dom       指令对应的虚拟dom\r\n     * @param name      参数名\r\n     * @returns         参数值\r\n     */\r\n    public getParam(module:Module,dom:VirtualDom,name:string){\r\n        return module.objectManager.getDirectiveParam(this.id,dom.key,name);\r\n    }\r\n\r\n    /**\r\n     * 移除参数\r\n     * @param module    模块\r\n     * @param dom       指令对应的虚拟dom\r\n     * @param name      参数名\r\n     */\r\n    public removeParam(module:Module,dom:VirtualDom,name:string){\r\n        module.objectManager.removeDirectiveParam(this.id,dom.key,name);\r\n    }\r\n\r\n    /**\r\n     * 克隆\r\n     */\r\n    public clone():Directive{\r\n        let d = new Directive();\r\n        d.type = this.type;\r\n        d.expression = this.expression;\r\n        d.value = this.value;\r\n        return d;\r\n    }\r\n}\r\n","import { DirectiveElementManager } from \"./directiveelementmanager\";\r\nimport { Directive } from \"./directive\";\r\nimport { VirtualDom } from \"./virtualdom\";\r\nimport { NError } from \"./error\";\r\nimport { NEvent } from \"./event\";\r\nimport { Expression } from \"./expression\";\r\nimport { Module } from \"./module\";\r\nimport { ModuleFactory } from \"./modulefactory\";\r\n\r\nexport class Compiler {\r\n    /**\r\n     * element Id\r\n     */\r\n    private elementId:number;\r\n\r\n    /**\r\n     * 模块\r\n     */\r\n    private module:Module;\r\n\r\n    /**\r\n     * 构造器\r\n     * @param module \r\n     */\r\n    constructor(module:Module){\r\n        this.elementId = 0;\r\n        this.module = module;\r\n    }\r\n    /**\r\n    * 编译\r\n    * @param elementStr     待编译html串\r\n    * @returns              虚拟dom\r\n    */\r\n    public compile(elementStr: string): VirtualDom {\r\n        return this.compileTemplate(elementStr);\r\n    }\r\n\r\n    /**\r\n     * 编译模版串\r\n     * @param srcStr    源串\r\n     * @returns         \r\n     */\r\n    private compileTemplate(srcStr:string):VirtualDom{\r\n        // 清理comment\r\n        let regExp = /\\<\\!\\-\\-[\\s\\S]*?\\-\\-\\>/g;\r\n        srcStr = srcStr.replace(regExp,'');\r\n        //不可见字符正则式\r\n        const regSpace = /^[\\s\\n\\r\\t\\v]+$/;\r\n        // 1 识别标签\r\n        regExp = /(?<!{{[^}}]*)(?:<(\\/?)\\s*?([a-zA-Z][a-zA-Z0-9-_]*)([\\s\\S]*?)(\\/?)(?<!=)>)(?![^{{]*}})/g;\r\n        let st = 0;\r\n        //标签串数组,含开始和结束标签\r\n        let tagStack = [];\r\n        //独立文本串数组，对应需要的标签串前面\r\n        let textStack = [];\r\n        //pre标签标志\r\n        let isPreTag:boolean = false;\r\n        let r;\r\n        while((r = regExp.exec(srcStr)) !== null){\r\n            tagStack.push(r[0]);\r\n            //处理标签之间的文本\r\n            let tmp='';\r\n            if(st < r.index-1){\r\n                tmp = srcStr.substring(st,r.index);\r\n                //全为不可见字符，则保存空字符串\r\n                if(!isPreTag && regSpace.test(tmp)){ \r\n                    tmp = '';\r\n                }\r\n            }\r\n            textStack.push(tmp);\r\n            st = regExp.lastIndex;\r\n        }\r\n        // 标签名数组\r\n        let tagNames = [];\r\n        // 标签对象数组\r\n        let tagObjs:VirtualDom[] = [];\r\n        // 根节点\r\n        let root:VirtualDom;\r\n        tagStack.forEach((tag,ii)=>{\r\n            //开始标签名\r\n            let stg;\r\n            if(tag.startsWith('</')){ //结束标签\r\n                let etg = tag.substring(2,tag.length-1).trim();\r\n                let chds = [];\r\n                //找到对应此结束标签的开始标签\r\n                for(let i=ii;tagNames.length>0;i--){\r\n                    // 结束标签前面的非空文本节点作为孩子\r\n                    if(i>=0 && textStack[i] !== ''){\r\n                        chds.push(this.handleText(textStack[i]));\r\n                        // 文本已使用，置为空\r\n                        textStack[i] = '';\r\n                    }\r\n                    if((stg = tagNames.pop())===etg){\r\n                        break;\r\n                    }\r\n                    //当前节点及其子节点同时作为孩子节点\r\n                    let tobj = tagObjs.pop();\r\n                    chds = (tobj.children||[]).concat(chds);\r\n                    chds.unshift(tobj);\r\n                }\r\n                //找到节点\r\n                if(stg === etg){\r\n                    // 添加到父节点\r\n                    let po = tagObjs.pop();\r\n                    po.children = (po.children||[]).concat(chds);\r\n                    this.handleSlot(po);\r\n                    if(tagObjs.length>0){\r\n                        tagObjs[tagObjs.length-1].add(po);\r\n                    }\r\n                    if(isPreTag && etg === 'pre'){\r\n                        isPreTag = false;\r\n                    }\r\n                }else{\r\n                    throw new NError('wrongTemplate');\r\n                }\r\n            }else { //标签头\r\n                //去掉标签前后< >\r\n                let tmpS = tag.endsWith('\\/>')?tag.substring(1,tag.length-2):tag.substring(1,tag.length-1);\r\n                //处理标签头，返回dom节点和原始标签名\r\n                const[dom,tagName] = this.handleTag(tmpS.trim());\r\n                //设置pre标签标志\r\n                if(tagName === 'pre'){\r\n                    isPreTag = true;\r\n                }\r\n                //前一个文本节点存在，则作为前一个节点的孩子\r\n                if(ii>0 && textStack[ii] !== ''){\r\n                    tagObjs[tagObjs.length-1].add(this.handleText(textStack[ii]));\r\n                    textStack[ii] = '';\r\n                }\r\n                if(!tag.endsWith('\\/>')){ // 非自闭合\r\n                    //标签头入栈\r\n                    tagNames.push(tagName);\r\n                    tagObjs.push(dom);\r\n                }else{ //自闭合，直接作为前一个的孩子节点\r\n                    if(tagObjs.length>0){\r\n                        if(tagObjs[tagObjs.length-1].children){\r\n                            tagObjs[tagObjs.length-1].children.push(dom);\r\n                        }else{\r\n                            tagObjs[tagObjs.length-1].children = [dom];\r\n                        }\r\n                    }\r\n                }\r\n                //设置根节点\r\n                if(!root){\r\n                    root = dom;\r\n                }\r\n            }\r\n        });\r\n        \r\n        if(tagNames.length>0){\r\n            throw new NError('wrongTempate');\r\n        }\r\n        return root;\r\n    }\r\n    \r\n    /**\r\n     * 处理标签属性\r\n     * @param tagStr    标签串\r\n     * @returns         [虚拟dom节点,原始标签名]\r\n     */\r\n    private handleTag(tagStr:string):any{\r\n        const me = this;\r\n        let ele:VirtualDom;\r\n        //字符串和表达式替换\r\n        const reg = /('[\\s\\S]*?')|(\"[\\s\\S]*?\")|(`[\\s\\S]*?`)|({{[\\S\\s]*?\\}{0,2}\\s*}})|([\\w$-]+(\\s*=)?)/g;\r\n        let pName:string;\r\n        //标签原始名\r\n        let tagName:string;\r\n        let startValue:boolean;\r\n        let r:RegExpExecArray;\r\n        let allModelField:boolean = true;\r\n        //属性名正则式\r\n        const regName = /[a-zA-Z$_]\\S*/;\r\n        while((r=reg.exec(tagStr))!==null){\r\n            let s = r[0];\r\n            if(regName.test(s)){ //属性名\r\n                if(!tagName){\r\n                    tagName = s;\r\n                    ele = new VirtualDom(tagName,me.genKey());\r\n                }else if(s.endsWith('=')) { //带等号\r\n                    if(pName){  //前一个属性名存在，设置空值\r\n                        setValue();\r\n                    }\r\n                    pName = s.substring(0,s.length-1).trim();\r\n                    startValue = true; \r\n                }else if(!pName){ //不带等号\r\n                    pName = s;\r\n                }else if(startValue){  //属性名存在，设置属性值\r\n                    setValue(s);\r\n                }\r\n            }else{ //属性值\r\n                if(pName && startValue){\r\n                    setValue(s);\r\n                }\r\n            }\r\n        }\r\n        //存在空属性\r\n        if(pName){\r\n            setValue();\r\n        }\r\n        \r\n        //后置处理\r\n        this.postHandleNode(ele);\r\n        ele.sortDirective();\r\n        ele.allModelField = allModelField;\r\n        return [ele,tagName];\r\n\r\n        /**\r\n         * 设置属性值\r\n         * @param value     属性值\r\n         */\r\n        function setValue(value?:any){\r\n            if(value){\r\n                let r;\r\n                //去掉字符串两端\r\n                if(((r=/((?<=^')(.*?)(?='$))|((?<=^\")(.*?)(?=\"$)|((?<=^`)(.*?)(?=`$)))/.exec(value)) !== null)){\r\n                    value = r[0].trim();\r\n                }\r\n                //表达式编译\r\n                if(/^\\{\\{[\\S\\s]*\\}\\}$/.test(value)){\r\n                    value = me.compileExpression(value,ele)[0];\r\n                    allModelField = value.allModelField;\r\n                }\r\n            }\r\n            //指令\r\n            if (pName.startsWith(\"x-\")) {\r\n                //不排序\r\n                ele.addDirective(new Directive(pName.substr(2), value));\r\n            } else if (pName.startsWith(\"e-\")) { //事件\r\n                ele.addEvent(new NEvent(pName.substr(2), value));\r\n            } else { //普通属性\r\n                ele.setProp(pName, value);\r\n            }\r\n            pName=undefined;\r\n            startValue=false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 处理模块子节点为slot节点\r\n     * @param dom   dom节点\r\n     */\r\n    private handleSlot(dom:VirtualDom){\r\n        if(dom.hasDirective('module')){ //po为子模块，其所有子模块判断是否加上slot\r\n            let slotCt:VirtualDom;\r\n            for(let j=0;j<dom.children.length;j++){\r\n                let c = dom.children[j];\r\n                if(c.hasDirective('slot')){ //带slot的不处理\r\n                    continue;\r\n                }\r\n                if(!slotCt){//第一个直接被slotCt替换\r\n                    slotCt = new VirtualDom('div',this.genKey());\r\n                    slotCt.addDirective(new Directive('slot',null));\r\n                    //当前位置，用slot替代\r\n                    dom.children.splice(j,1,slotCt);\r\n                }else{\r\n                    //直接删除\r\n                    dom.children.splice(j--,1);\r\n                }\r\n                slotCt.add(c);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 编译txt为文本节点\r\n     * @param txt 文本串\r\n     */\r\n    private handleText(txt:string) {\r\n        let ele = new VirtualDom(null,this.genKey());\r\n        txt = this.preHandleText(txt);\r\n        if(/\\{\\{[\\s\\S]+\\}\\}/.test(txt)){  //检查是否含有表达式\r\n            ele.expressions = <any[]>this.compileExpression(txt,ele);\r\n        }else{\r\n            ele.textContent = txt;\r\n        }\r\n        return ele;\r\n    }\r\n    /**\r\n     * 处理表达式串\r\n     * @param exprStr   含表达式的串\r\n     * @return          处理后的字符串和表达式数组\r\n     */\r\n    public compileExpression(exprStr: string,dom:VirtualDom):string|any[]{\r\n        if(!exprStr){\r\n            return;\r\n        }\r\n        let reg: RegExp = /\\{\\{[\\s\\S]+?\\}?\\s*\\}\\}/g;\r\n        let retA = new Array();\r\n        let re: RegExpExecArray;\r\n        let oIndex: number = 0;\r\n        while ((re = reg.exec(exprStr)) !== null) {\r\n            let ind = re.index;\r\n            //字符串\r\n            if (ind > oIndex) {\r\n                let s = exprStr.substring(oIndex, ind);\r\n                retA.push(s);\r\n            }\r\n            //实例化表达式对象\r\n            let exp = new Expression(this.module,re[0].substring(2, re[0].length - 2));\r\n            dom.allModelField = exp.allModelField;\r\n            //加入数组\r\n            retA.push(exp);\r\n            oIndex = ind + re[0].length;\r\n        }\r\n        //最后的字符串\r\n        if (oIndex < exprStr.length - 1) {\r\n            retA.push(exprStr.substr(oIndex));\r\n        }\r\n        return retA;\r\n    }\r\n\r\n    /**\r\n     * 后置处理\r\n     * 包括：模块类元素、自定义元素\r\n     * @param node  虚拟dom节点\r\n     */\r\n    private postHandleNode(node:VirtualDom){\r\n        // 模块类判断\r\n        if (ModuleFactory.hasClass(node.tagName)) {\r\n            node.addDirective(new Directive('module',node.tagName));\r\n            node.tagName = 'div';\r\n        }else if(DirectiveElementManager.has(node.tagName)){ //自定义元素\r\n            let clazz = DirectiveElementManager.get(node.tagName);\r\n            Reflect.construct(clazz,[node,this.module]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 预处理html保留字符 如 &nbsp;,&lt;等\r\n     * @param str   待处理的字符串\r\n     * @returns     解析之后的串\r\n     */\r\n    private preHandleText(str: string): string {\r\n        let reg = /&[a-z]+;/;\r\n        if(reg.test(str)){\r\n            let div = document.createElement('div');\r\n            div.innerHTML = str;\r\n            return div.textContent;\r\n        }\r\n        return str;\r\n    }\r\n\r\n    /**\r\n     * 产生可以\r\n     * @returns     key\r\n     */\r\n    private genKey():string{\r\n        // return this.module.id + '_' + this.elementId++;\r\n        return this.elementId++ + '';\r\n    }\r\n}\r\n","import { VirtualDom } from \"./virtualdom\";\r\n/**\r\n * 比较器\r\n */\r\nexport class DiffTool{\r\n    /**\r\n     * 比较节点\r\n     * @param src           待比较节点（渲染后节点）\r\n     * @param dst \t        被比较节点\r\n     * @param changeArr     增删改的节点数组\r\n     * @returns\t            [[type(add 1, upd 2,del 3,move 4 ,rep 5),dom(操作节点),dom1(被替换或修改节点),parent(父节点),loc(位置)]]\r\n     */\r\n    public static compare(src:any,dst:any,changeArr:Array<any>) {\r\n        if (!src.tagName) { //文本节点\r\n            if (!dst.tagName) {\r\n                if ((src.staticNum || dst.staticNum) && src.textContent !== dst.textContent) {\r\n                    addChange(2,src,null,dst.parent);\r\n                }\r\n            } else { //节点类型不同\r\n                addChange(5,src,null, dst.parent);\r\n            }\r\n        } else { //element节点\r\n            if (src.tagName !== dst.tagName) { //节点类型不同\r\n                addChange(5,src,null, dst.parent);\r\n            }else if(src.staticNum || dst.staticNum){ //节点类型相同，但有一个不是静态节点，进行属性和asset比较\r\n                let change = false;\r\n                for(let p of ['props','assets']){\r\n                    //属性比较\r\n                    if(!src[p] && dst[p] || src[p] && !dst[p]){\r\n                        change = true;\r\n                    }else if(src[p] && dst[p]){\r\n                        if(src[p].size !== dst[p].size){\r\n                            change = true;\r\n                        }else{\r\n                            for(let k of src[p]){\r\n                                if(k[1] !== dst[p].get(k[0])){\r\n                                    change = true;\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    if(change){\r\n                        addChange(2,src,null,dst.parent);    \r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if(src.staticNum>0){\r\n            src.staticNum--;\r\n        }\r\n        \r\n        //子节点处理\r\n        if (!src.children || src.children.length === 0) {\r\n            // 旧节点的子节点全部删除\r\n            if (dst.children && dst.children.length > 0) {\r\n                dst.children.forEach(item => addChange(3,item,null,dst));\r\n            }\r\n        } else {\r\n            //全部新加节点\r\n            if (!dst.children || dst.children.length === 0) {\r\n                src.children.forEach(item => addChange(1, item,null, dst));\r\n            } else { //都有子节点\r\n                //存储比较后需要add的key\r\n                let addObj={};\r\n                //子节点对比策略\r\n                let [oldStartIdx, oldStartNode, oldEndIdx, oldEndNode] = [0, dst.children[0], dst.children.length - 1, dst.children[dst.children.length - 1]];\r\n                let [newStartIdx, newStartNode, newEndIdx, newEndNode] = [0, src.children[0], src.children.length - 1, src.children[src.children.length - 1]];\r\n                while (oldStartIdx <= oldEndIdx && newStartIdx <= newEndIdx) {\r\n                    if (sameKey(oldStartNode, newStartNode)) {\r\n                        DiffTool.compare(newStartNode,oldStartNode, changeArr);\r\n                        newStartNode = src.children[++newStartIdx];\r\n                        oldStartNode = dst.children[++oldStartIdx];\r\n                    } else if (sameKey(oldEndNode, newEndNode)) {\r\n                        DiffTool.compare(newEndNode,oldEndNode, changeArr);\r\n                        newEndNode = src.children[--newEndIdx];\r\n                        oldEndNode = dst.children[--oldEndIdx];\r\n                    } else if (sameKey(newStartNode, oldEndNode)) {\r\n                        //新前旧后\r\n                        DiffTool.compare(newStartNode,oldEndNode, changeArr);\r\n                       //跳过插入点会提前移动的节点\r\n                        while(addObj.hasOwnProperty(oldStartNode.key)){\r\n                            changeArr[addObj[oldStartNode.key]][0] = 4;\r\n                            delete addObj[oldStartNode.key];\r\n                            oldStartNode = dst.children[++oldStartIdx];\r\n                        }\r\n                         //接在待操作老节点前面\r\n                        addChange(4,oldEndNode,  oldStartNode,dst);\r\n                        newStartNode = src.children[++newStartIdx];\r\n                        oldEndNode = dst.children[--oldEndIdx];\r\n                    } else if (sameKey(newEndNode, oldStartNode)) {\r\n                        DiffTool.compare(newEndNode,oldStartNode, changeArr);\r\n                         //跳过插入点会提前移动的节点\r\n                        while(addObj.hasOwnProperty(oldEndNode.key)){\r\n                            changeArr[addObj[oldEndNode.key]][0] = 4;\r\n                            delete addObj[oldEndNode.key];\r\n                            oldEndNode = dst.children[--oldEndIdx];\r\n                        }\r\n                        //接在 oldEndIdx 之后，但是再下一个节点可能移动位置，所以记录oldEndIdx节点\r\n                        addChange(4, oldStartNode, oldEndNode,dst,1);\r\n                        newEndNode = src.children[--newEndIdx];\r\n                        oldStartNode = dst.children[++oldStartIdx];\r\n                    } else {\r\n                        //跳过插入点会提前移动的节点\r\n                        if(addObj.hasOwnProperty(oldStartNode.key)){\r\n                            while(addObj.hasOwnProperty(oldStartNode.key)){\r\n                                   changeArr[addObj[oldStartNode.key]][0] = 4;\r\n                                   delete addObj[oldStartNode.key];\r\n                                oldStartNode = dst.children[++oldStartIdx];\r\n                            }\r\n                            continue;//继续diff，暂不add\r\n                        }\r\n                       //加入到addObj\r\n                        addObj[newStartNode.key]= addChange(1, newStartNode, oldStartNode,dst)-1;\r\n                        newStartNode = src.children[++newStartIdx];\r\n                    }\r\n                }\r\n                //有新增或删除节点\r\n                if (oldStartIdx <= oldEndIdx || newStartIdx <= newEndIdx) {\r\n                    if (oldStartIdx > oldEndIdx) {\r\n                        //没有老节点\r\n                        for (let i = newStartIdx; i <= newEndIdx; i++) {\r\n                            // 添加到dst.children[i]前面\r\n                            addChange(1,src.children[i], i ,dst);\r\n                        }\r\n                    } else {\r\n                        //有老节点，需要删除\r\n                        for (let i = oldStartIdx; i <= oldEndIdx; i++) {\r\n                            let ch=dst.children[i];\r\n                            //如果要删除的节点在addArr中，则表示move，否则表示删除\r\n                            if(!addObj.hasOwnProperty(ch.key)){ \r\n                                addChange(3,ch,null,dst);\r\n                            }else{\r\n                                changeArr[addObj[ch.key]][0] = 4;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * 是否有相同key\r\n         * @param src   源节点\r\n         * @param dst   目标节点\r\n         * @returns     相同key为true，否则为false\r\n         */\r\n        function sameKey(src:VirtualDom, dst:VirtualDom):boolean {\r\n            return src.key === dst.key;\r\n        }\r\n        \r\n        /**\r\n         * 添加刪除替換\r\n        * @param type       类型 add 1, upd 2,del 3,move 4 ,rep 5\r\n        * @param dom        虚拟节点    \r\n        * @param dom1       相对节点\r\n        * @param parent     父节点\r\n        * @param extra      move时 0:相对节点前，1:相对节点后\r\n        */\r\n        function addChange(type:number,dom: VirtualDom, dom1?: VirtualDom|number,parent?:VirtualDom,loc?:number) {\r\n            return changeArr.push([type,dom,dom1,parent,loc]);\r\n        }\r\n    }\r\n}","import { VirtualDom } from \"./virtualdom\";\r\nimport { Module } from \"./module\";\r\n/**\r\n * 自定义元素\r\n * 用于扩充定义，主要对ast obj进行前置处理\r\n */\r\nexport class DirectiveElement {\r\n    constructor(node:VirtualDom,module:Module){\r\n        if (node.hasProp('tag')) {\r\n            node.tagName = node.getProp('tag');\r\n            node.delProp('tag');\r\n        } else {\r\n            node.tagName = 'div';\r\n        }\r\n    }\r\n}\r\n","import { Module } from \"./module\";\r\n\r\n/**\r\n * 工厂基类\r\n */\r\nexport class NFactory {\r\n    /**\r\n     * 模块名\r\n     */\r\n    private moduleId:number;\r\n    /**\r\n     * 工厂item对象\r\n     */\r\n    private items:Map<number|string,any> = new Map();\r\n    \r\n    /**\r\n     * @param module 模块\r\n     */\r\n    constructor(module?:Module) {\r\n        if (module !== undefined) {\r\n            this.moduleId = module.id;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 添加到工厂\r\n     * @param name \titem name\r\n     * @param item\titem\r\n     */\r\n    public add(name:string|number, item:any) {\r\n        this.items.set(name,item);\r\n    }\r\n\r\n    /**\r\n     * 获得item\r\n     * @param name \titem name\r\n     * @returns     item\r\n     */\r\n    public get(name:string|number):any{\r\n        return this.items.get(name);\r\n    }\r\n\r\n    \r\n    /**\r\n     * 从容器移除\r\n     * @param name \titem name\r\n     */\r\n    public remove(name:string|number) {\r\n        this.items.delete(name);\r\n    }\r\n\r\n    /**\r\n     * 是否拥有该项\r\n     * @param name  item name\r\n     * @return      true/false\r\n     */\r\n    public has(name:string|number):boolean{\r\n        return this.items.has(name);\r\n    }\r\n}\r\n","/*\r\n * 消息js文件 中文文件\r\n */\r\nexport const NodomMessage_zh = {\r\n    /**\r\n     * 提示单词\r\n     */\r\n    TipWords: {\r\n        application: \"应用\",\r\n        system: \"系统\",\r\n        module: \"模块\",\r\n        moduleClass: '模块类',\r\n        model: \"模型\",\r\n        directive: \"指令\",\r\n        directiveType: \"指令类型\",\r\n        expression: \"表达式\",\r\n        event: \"事件\",\r\n        method: \"方法\",\r\n        filter: \"过滤器\",\r\n        filterType: \"过滤器类型\",\r\n        data: \"数据\",\r\n        dataItem: '数据项',\r\n        route: '路由',\r\n        routeView: '路由容器',\r\n        plugin: '插件',\r\n        resource: '资源',\r\n        root: '根',\r\n        element: '元素'\r\n    },\r\n    /**\r\n     * 异常信息\r\n     */\r\n    ErrorMsgs: {\r\n        unknown: \"未知错误\",\r\n        paramException: \"{0}'{1}'方法参数错误，请参考api\",\r\n        invoke: \"{0}方法调用参数{1}必须为{2}\",\r\n        invoke1: \"{0}方法调用参数{1}必须为{2}或{3}\",\r\n        invoke2: \"{0}方法调用参数{1}或{2}必须为{3}\",\r\n        invoke3: \"{0}方法调用参数{1}不能为空\",\r\n        exist: \"{0}已存在\",\r\n        exist1: \"{0}'{1}'已存在\",\r\n        notexist: \"{0}不存在\",\r\n        notexist1: \"{0}'{1}'不存在\",\r\n        notupd: \"{0}不可修改\",\r\n        notremove: \"{0}不可删除\",\r\n        notremove1: \"{0}{1}不可删除\",\r\n        namedinvalid: \"{0}{1}命名错误，请参考用户手册对应命名规范\",\r\n        initial: \"{0}初始化参数错误\",\r\n        jsonparse: \"JSON解析错误\",\r\n        timeout: \"请求超时\",\r\n        config: \"{0}配置参数错误\",\r\n        config1: \"{0}配置参数'{1}'错误\",\r\n        itemnotempty: \"{0} '{1}' 配置项 '{2}' 不能为空\",\r\n        itemincorrect: \"{0} '{1}' 配置项 '{2}' 错误\",\r\n        compile1: \"{0}标签未闭合\",\r\n        compile2: \"结束标签{0}未找到与之匹配的开始标签\",\r\n        compile3: \"请检查模板标签闭合情况，模板需要有一个闭合的根节点\",\r\n        wrongTemplate:\"模版格式错误\"\r\n\r\n    },\r\n\r\n    /**\r\n     * 表单信息\r\n     */\r\n    FormMsgs: {\r\n        type: \"请输入有效的{0}\",\r\n        unknown: \"输入错误\",\r\n        required: \"不能为空\",\r\n        min: \"最小输入值为{0}\",\r\n        max: \"最大输入值为{0}\"\r\n    },\r\n    WeekDays: {\r\n        \"0\": \"日\",\r\n        \"1\": \"一\",\r\n        \"2\": \"二\",\r\n        \"3\": \"三\",\r\n        \"4\": \"四\",\r\n        \"5\": \"五\",\r\n        \"6\": \"六\"\r\n    }\r\n}\r\n","import { VirtualDom } from \"./virtualdom\";\r\nimport { Model } from \"./model\";\r\nimport { Module } from \"./module\";\r\nimport { ModuleFactory } from \"./modulefactory\";\r\nimport { Renderer } from \"./renderer\";\r\n\r\n/**\r\n * 模型工厂\r\n */\r\nexport class ModelManager {\r\n    // public module: Module;\r\n    /**\r\n     * 数据对象与模型映射，key为数据对象，value为model\r\n     */\r\n    private static dataMap: WeakMap<object, Model> = new WeakMap();\r\n    /**\r\n     * 模型模块映射\r\n     * key:model proxy, value:{data:data,watchers:{key:[监听器1,监听器2,...]},modules:[id1,id2,...]}\r\n     * 每个数据对象，可有多个监听器\r\n     */\r\n    private static modelMap: WeakMap<Model, any> = new WeakMap();\r\n    \r\n    /**\r\n     * 添加到 dataNModelMap\r\n     * @param data      数据对象\r\n     * @param model     模型\r\n     */\r\n    public static addToDataMap(data: Object, model: Model) {\r\n        this.dataMap.set(data, model);\r\n    }\r\n\r\n    /**\r\n     * 删除从 dataNModelMap\r\n     * @param data      数据对象\r\n     * @param model     模型\r\n     */\r\n    public static delFromDataMap(data: Object) {\r\n        this.dataMap.delete(data);\r\n\r\n    }\r\n\r\n    /**\r\n     * 从dataNModelMap获取model\r\n     * @param data      数据对象\r\n     * @returns         model\r\n     */\r\n    public static getFromDataMap(data: Object): Model {\r\n        return this.dataMap.get(data);\r\n    }\r\n\r\n    /**\r\n     * 是否存在数据模型映射\r\n     * @param data  数据对象\r\n     * @returns     true/false\r\n     */\r\n    public static hasDataModel(data: Object): Boolean {\r\n        return this.dataMap.has(data);\r\n    }\r\n\r\n\r\n    /**\r\n     * 添加源模型到到模型map\r\n     * @param model     模型代理\r\n     * @param srcNModel  源模型\r\n     */\r\n    public static addModel(model: any, srcNModel: Model) {\r\n        if (!this.modelMap.has(model)) {\r\n            this.modelMap.set(model, { model: srcNModel });\r\n        } else {\r\n            this.modelMap.get(model).model = srcNModel;\r\n        }\r\n    }\r\n    /**\r\n   * 删除源模型到到模型map\r\n   * @param model     模型代理\r\n   * @param srcNModel  源模型\r\n   */\r\n    public static delModel(model: any) {\r\n        this.modelMap.delete(model);\r\n    }\r\n    /**\r\n     * 从模型Map获取源数据\r\n     * @param model     模型代理\r\n     * @returns         源模型\r\n     */\r\n    public static getData(model: any): Model {\r\n        if (this.modelMap.has(model)) {\r\n            return this.modelMap.get(model).data;\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    /**\r\n     * 获取model监听器\r\n     * @param model     model\r\n     * @param key       model对应的属性\r\n     * @param foo       监听处理方法\r\n     * @returns         void\r\n     */\r\n    public static addWatcher(model: Model, key: string, foo: Function | string) {\r\n        // 把model加入到model map\r\n        if (!this.modelMap.has(model)) {\r\n            this.modelMap.set(model, {});\r\n        }\r\n        let watchers = this.modelMap.get(model).watchers;\r\n        //添加watchers属性\r\n        if (!watchers) {\r\n            watchers = {};\r\n            this.modelMap.get(model).watchers = watchers;\r\n        }\r\n        \r\n        //添加观察器数组\r\n        if (!watchers[key]) {\r\n            watchers[key] = [foo];\r\n        }else{\r\n            //把处理函数加入观察器数组\r\n            watchers[key].push(foo);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取model监听器\r\n     * @param model     model\r\n     * @param key       model对应的属性\r\n     * @param foo       监听处理方法\r\n     * @returns         void\r\n     */\r\n    public static removeWatcher(model: Model, key: string, foo: Function | string) {\r\n        if (!this.modelMap.has(model) || !this.modelMap.get(model).watchers) {\r\n            return;\r\n        }\r\n        let watchers = this.modelMap.get(model).watchers;\r\n        if (!watchers[key]) {\r\n            return;\r\n        }\r\n        let index = watchers[key].findIndex(foo);\r\n        //找到后移除\r\n        if (index !== -1) {\r\n            watchers.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取model监听器\r\n     * @param model     model\r\n     * @param key       model对应的属性\r\n     * @returns         监听处理函数数组\r\n     */\r\n    public static getWatcher(model: Model, key: string): Array<Function> {\r\n        if (!this.modelMap.has(model)) {\r\n            return;\r\n        }\r\n        let watchers = this.modelMap.get(model).watchers;\r\n        if (watchers) {\r\n            return watchers[key];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 绑定model到module\r\n     * @param model     模型 \r\n     * @param module    模块\r\n     * @returns \r\n     */\r\n    public static bindToModule(model:Model,module:Module|number){\r\n        let obj = this.modelMap.get(model);\r\n        if(!obj){\r\n            return;\r\n        }\r\n        let mid = typeof module === 'number'?module:module.id;\r\n        if(!obj.modules){\r\n            obj.modules = [mid];\r\n        }else{\r\n            let arr = obj.modules;\r\n            if(arr.indexOf(mid) === -1){\r\n                arr.push(mid);\r\n            }\r\n        }\r\n        //级联设置\r\n        Object.getOwnPropertyNames(model).forEach(item=>{\r\n            if(typeof model[item] === 'object' && model[item].$key){\r\n                ModelManager.bindToModule(model[item],module);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 绑定model到多个module\r\n     * @param model     模型 \r\n     * @param ids       模块id数组\r\n     * @returns \r\n     */\r\n     public static bindToModules(model:Model,ids:number[]){\r\n        let obj = this.modelMap.get(model);\r\n        if(!obj){\r\n            return;\r\n        }\r\n        if(!obj.modules){\r\n            obj.modules = ids;\r\n        }else{\r\n            let arr = obj.modules;\r\n            for(let mid of ids){\r\n                if(arr.indexOf(mid) === -1){\r\n                    arr.push(mid);\r\n                }\r\n            }\r\n        }\r\n\r\n        //级联设置\r\n        Object.getOwnPropertyNames(model).forEach(item=>{\r\n            if(typeof model[item] === 'object' && model[item].$key){\r\n                ModelManager.bindToModules(model[item],ids);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * model从module解绑\r\n     * @param model     模型 \r\n     * @param module    模块\r\n     * @returns \r\n     */\r\n     public static unbindFromModule(model:Model,module:Module|number){\r\n        let obj = this.modelMap.get(model);\r\n        if(!obj || !obj.modules){\r\n            return;\r\n        }\r\n        let mid = typeof module === 'number'?module:module.id;\r\n        let arr = obj.modules;\r\n        let ind;\r\n        if((ind=arr.indexOf(mid)) === -1){\r\n            arr.splice(ind);\r\n        }\r\n        \r\n        //级联解绑\r\n        Object.getOwnPropertyNames(model).forEach(item=>{\r\n            if(typeof model[item] === 'object' && model[item].$key){\r\n                ModelManager.unbindFromModule(model[item],module);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 获取model绑定的moduleId\r\n     * @param model     模型\r\n     * @returns model绑定的模块id数组\r\n     */\r\n    public static getModuleIds(model:Model):number[]{\r\n        let obj = this.modelMap.get(model);\r\n        if(!obj){\r\n            return;\r\n        }\r\n        return obj.modules;\r\n    }\r\n\r\n    /**\r\n     * 更新导致渲染\r\n     * 如果不设置oldValue和newValue，则直接强制渲染\r\n     * @param model     model\r\n     * @param key       属性\r\n     * @param oldValue  旧值\r\n     * @param newValue  新值\r\n     * @param force     强制渲染\r\n     */\r\n    public static update(model: Model, key: string, oldValue?: any, newValue?: VirtualDom, force?:boolean) {\r\n        //处理观察器函数\r\n        let obj = this.modelMap.get(model);\r\n        if(!obj){\r\n            return;\r\n        }\r\n        \r\n        let mids = obj.modules;\r\n        let modules = [];\r\n        for(let mid of mids){\r\n            let m = ModuleFactory.get(mid);\r\n            modules.push(m);\r\n            //增加修改标志\r\n            m.changedModelMap.set(model.$key,true);\r\n        }\r\n        let watcher = this.getWatcher(model,key);\r\n        if (watcher) {\r\n            for (let foo of watcher) {\r\n                for(let m of modules){\r\n                    //方法名\r\n                    if (typeof foo === 'string') {\r\n                        foo = m.getMethod(foo);\r\n                        if (foo) {\r\n                            foo.call(m,model, oldValue, newValue);\r\n                        }\r\n                    } else {\r\n                        foo.call(m,model, oldValue, newValue);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if(oldValue !== newValue || force){\r\n            for(let m of modules){\r\n                Renderer.add(m);\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n","import { ModelManager } from \"./modelmanager\";\r\nimport { Module } from \"./module\";\r\nimport { Util } from \"./util\";\r\n/**\r\n * 模型类\r\n */\r\nexport class Model {\r\n    /**\r\n     * model key\r\n     */\r\n    public $key:any;\r\n    /**\r\n     * @param data \t\t数据\r\n     * @param module \t模块对象\r\n     * @returns         模型代理对象\r\n     */\r\n    constructor(data: any, module?: Module) {\r\n        //模型管理器\r\n        let proxy = new Proxy(data, {\r\n            set: (src: any, key: string, value: any, receiver: any) => {\r\n                //值未变,proxy 不处理\r\n                if (src[key] === value) {\r\n                    return true;\r\n                }\r\n                //不处理原型属性和构造器 \r\n                if (['__proto__', 'constructor'].includes(<string>key)) {\r\n                    return true;\r\n                }\r\n                const excArr = [\"$key\"];\r\n                //非对象，null，非model更新渲染\r\n                if(typeof value !== 'function' && excArr.indexOf(key) === -1){\r\n                    ModelManager.update(proxy, key, src[key], value);\r\n                }\r\n                return Reflect.set(src, key, value, receiver);\r\n            },\r\n            get: (src: any, key: string | symbol, receiver) => {\r\n                let res = Reflect.get(src, key, receiver);\r\n                //数组的sort和fill触发强行渲染\r\n                if(Array.isArray(src) && ['sort','fill'].indexOf(<string>key) !== -1){ //强制渲染\r\n                    ModelManager.update(proxy,null,null,null,true);\r\n                }\r\n                let data = ModelManager.getFromDataMap(src[key]);\r\n                if (data) {\r\n                    return data;\r\n                }\r\n                if (res !== null && typeof res === 'object') {\r\n                    //如果是对象，则返回代理，便于后续激活get set方法                   \r\n                    //判断是否已经代理，如果未代理，则增加代理\r\n                    if (!src[key].$key) {\r\n                        let p = new Model(res, module);\r\n                        return p;\r\n                    }\r\n                }\r\n                return res;\r\n            },\r\n            deleteProperty: function (src: any, key: any) {\r\n                //如果删除对象，从mm中同步删除\r\n                if (src[key] !== null && typeof src[key] === 'object') {\r\n                    ModelManager.delFromDataMap(src[key]);\r\n                    ModelManager.delModel(src[key]);\r\n                }\r\n                delete src[key];\r\n                ModelManager.update(proxy,key,null,null,true);\r\n                return true;\r\n            }\r\n        });\r\n        proxy.$watch = this.$watch;\r\n        proxy.$get = this.$get;\r\n        proxy.$set = this.$set;\r\n        proxy.$key = Util.genId();\r\n        ModelManager.addToDataMap(data, proxy);\r\n        ModelManager.addModel(proxy, data);\r\n        //绑定到模块\r\n        if(module){\r\n            ModelManager.bindToModule(proxy,module);\r\n        }\r\n        return proxy;\r\n    }\r\n\r\n    /**\r\n     * 观察(取消观察)某个数据项\r\n     * @param key       数据项名\r\n     * @param operate   数据项变化时执行方法名(在module的methods中定义)\r\n     * @param cancel    取消观察\r\n     */\r\n    public $watch(key: string, operate: string | Function, cancel?: boolean) {\r\n        let model = this;\r\n        let index = -1;\r\n        //如果带'.'，则只取最里面那个对象\r\n        if ((index = key.lastIndexOf('.')) !== -1) {\r\n            model = this.$get(key.substr(0, index));\r\n            key = key.substr(index + 1);\r\n        }\r\n        if (!model) {\r\n            return;\r\n        }\r\n        if (cancel) {\r\n            ModelManager.removeWatcher(model, key, operate);\r\n        } else {\r\n            ModelManager.addWatcher(model, key, operate);\r\n        }\r\n    }\r\n    /**\r\n     * 查询子属性\r\n     * @param key   子属性，可以分级，如 name.firstName\r\n     * @returns     属性对应model proxy\r\n     */\r\n    $get(key: string) {\r\n        let model: Model = this;\r\n        if (key.indexOf('.') !== -1) {    //层级字段\r\n            let arr = key.split('.');\r\n            for (let i = 0; i < arr.length - 1; i++) {\r\n                model = model[arr[i]];\r\n                if (!model) {\r\n                    break;\r\n                }\r\n            }\r\n            if (!model) {\r\n                return;\r\n            }\r\n            key = arr[arr.length - 1];\r\n        }\r\n        return model[key];\r\n    }\r\n\r\n    /**\r\n     * 设置值\r\n     * @param key       子属性，可以分级，如 name.firstName\r\n     * @param value     属性值\r\n     * @param module    需要绑定的新模块\r\n     */\r\n    $set(key:string,value:any,module?:Module){\r\n        let model: Model = this;\r\n        let mids = ModelManager.getModuleIds(this);\r\n        if (key.indexOf('.') !== -1) {    //层级字段\r\n            let arr = key.split('.');\r\n            for (let i = 0; i < arr.length - 1; i++) {\r\n                //不存在，则创建新的model\r\n                if (!model[arr[i]]) {\r\n                    let m = new Model({});\r\n                    ModelManager.bindToModules(m,mids);\r\n                    model[arr[i]] = m;\r\n                }\r\n            }\r\n            key = arr[arr.length - 1];\r\n        }\r\n        //绑定model到模块\r\n        if(typeof value === 'object' && module){\r\n            ModelManager.bindToModule(value,module);\r\n        }\r\n        model[key] = value;\r\n    }\r\n}","import { NCache } from \"./cache\";\r\nimport { Directive } from \"./directive\";\r\nimport { VirtualDom } from \"./virtualdom\";\r\nimport { NEvent } from \"./event\";\r\nimport { Expression } from \"./expression\";\r\nimport { GlobalCache } from \"./globalcache\";\r\nimport { Module } from \"./module\";\r\nimport { Util } from \"./util\";\r\n\r\n/**\r\n * 指令管理器\r\n * $directives  指令集\r\n * $expressions 表达式集\r\n * $events      事件集\r\n * $savedoms    dom相关缓存 包括 html dom 和 参数\r\n * $doms        渲染树\r\n */\r\nexport  class ObjectManager {\r\n    /**\r\n     * cache\r\n     */\r\n    public cache:NCache;\r\n\r\n    /**\r\n     * 模块\r\n     */\r\n    public module:Module;\r\n    /**\r\n     * module   模块\r\n     * @param module \r\n     */\r\n    constructor(module:Module){\r\n        this.module = module;\r\n        this.cache = new NCache();\r\n    }\r\n\r\n    /**\r\n     * 保存到cache\r\n     * @param key       键，支持\".\"\r\n     * @param value     值\r\n     */\r\n     public set(key:string,value:any){\r\n        this.cache.set(key,value);\r\n    }\r\n\r\n    /**\r\n     * 从cache读取\r\n     * @param key   键，支持\".\"\r\n     * @returns     缓存的值或undefined\r\n     */\r\n    public get(key){\r\n        return this.cache.get(key);\r\n    }\r\n\r\n    /**\r\n     * 从cache移除\r\n     * @param key   键，支持\".\"\r\n     */\r\n    public remove(key){\r\n        this.cache.remove(key);\r\n    }\r\n\r\n    /**\r\n     * 获取指令实例\r\n     * @param module    模块\r\n     * @param id        指令id\r\n     * @returns         指令对象\r\n     */\r\n    public getDirective(id:number):Directive{\r\n        let d = this.cache.get('$directives.' + id + '.$instance');\r\n        if(!d){\r\n            d = GlobalCache.get('$directives.' + id);\r\n            GlobalCache.removeDirective(id);\r\n            if(d){\r\n                this.cache.set('$directives.' + id,d);\r\n                return d.$instance;\r\n            }\r\n        }\r\n        return d;\r\n    }\r\n\r\n    /**\r\n     * 保存指令实例\r\n     * @param module        模块\r\n     * @param directive     指令对象\r\n     */\r\n    public saveDirective(directive:Directive){\r\n        this.cache.set('$directives.' + directive.id + '.$instance',directive);\r\n    }\r\n\r\n    /**\r\n     * 移除指令\r\n     * @param id    指令id\r\n     */\r\n    public removeDirective(id:number){\r\n        this.cache.remove('$directives.' + id);\r\n    }\r\n\r\n    /**\r\n     * 设置指令参数\r\n     * @param id        指令id\r\n     * @param key       dom key\r\n     * @param name      参数名  \r\n     * @param value     参数值\r\n     */\r\n    public setDirectiveParam(id:number,key:string,name:string,value:any){\r\n        this.cache.set('$doms.' + key + '$directives.' + id + '.$params.' + name,value);\r\n    }\r\n\r\n    /**\r\n     * 获取指令参数值\r\n     * @param id        指令id\r\n     * @param key       dom key\r\n     * @param name      参数名\r\n     * @returns         参数值\r\n     */\r\n    public getDirectiveParam(id:number,key:string,name:string){\r\n        return this.cache.get('$doms.' + key + '$directives.' + id + '.$params.' + name);\r\n    }\r\n\r\n    /**\r\n     * 移除指令参数\r\n     * @param id        指令id\r\n     * @param key       dom key\r\n     * @param name      参数名\r\n     */\r\n    public removeDirectiveParam(id:number,key:string,name:string){\r\n        this.cache.remove('$doms.' + key + '$directives.' + id + '.$params.' + name);\r\n    }\r\n\r\n    /**\r\n     * 清空指令参数\r\n     * @param id        指令id\r\n     * @param key       dom key\r\n     */\r\n    public clearDirectiveParam(id:number,key:string){\r\n        this.cache.remove('$doms.' + key + '$directives.' + id + '.$params.' + name);\r\n    }\r\n\r\n    /**\r\n     * 获取表达式实例\r\n     * @param id        表达式id\r\n     * @returns         表达式对象\r\n     */\r\n    public getExpression(id:number):Expression{\r\n        let ex = this.cache.get('$expressions.' + id);\r\n        if(!ex){\r\n            ex = GlobalCache.get('$expressions.' + id);\r\n            GlobalCache.removeExpression(id);\r\n            if(ex){\r\n                this.cache.set('$expressions.' + id,ex);\r\n                return ex;\r\n            }\r\n        }\r\n        return ex;\r\n    }\r\n\r\n    /**\r\n     * 保存表达式实例\r\n     * @param expression    表达式对象\r\n     */\r\n    public saveExpression(expression:Expression){\r\n        this.cache.set('$expressions.' + expression.id,expression);\r\n    }\r\n\r\n    /**\r\n     * 移除表达式\r\n     * @param id    表达式id\r\n     */\r\n    public removeExpression(id:number){\r\n        this.cache.remove('$expressions.' + id);\r\n    }\r\n\r\n    /**\r\n     * 获取事件实例\r\n     * @param id        表达式id\r\n     * @returns         事件对象\r\n     */\r\n    public getEvent(id:number):NEvent{\r\n        let ev = this.cache.get('$events.' + id + '.$instance')\r\n        if(!ev){\r\n            ev = GlobalCache.get('$events.' + id);\r\n            GlobalCache.removeEvent(id);\r\n            if(ev){\r\n                this.cache.set('$events.' + id,ev);\r\n                return ev.$instance;\r\n            }\r\n            \r\n        }\r\n        return ev;\r\n    }\r\n\r\n    /**\r\n     * 保存事件实例\r\n     * @param event     事件对象\r\n     */\r\n    public saveEvent(event:NEvent){\r\n        this.cache.set('$events.' + event.id + '.$instance',event);\r\n    }\r\n\r\n    /**\r\n     * 移除事件\r\n     * @param id    事件id\r\n     */\r\n    public removeEvent(id:number){\r\n        this.cache.remove('$events.' + id);\r\n    }\r\n\r\n    /**\r\n     * 设置事件参数\r\n     * @param id        事件id\r\n     * @param key       dom key\r\n     * @param name      参数名  \r\n     * @param value     参数值\r\n     */\r\n    public setEventParam(id:number,key:String,name:string,value:any){\r\n        this.cache.set('$doms.' + key + '$events.' + id + '.$params.' + name,value);\r\n    }\r\n\r\n    /**\r\n     * 获取事件参数值\r\n     * @param id        事件id\r\n     * @param key       dom key \r\n     * @param name      参数名\r\n     * @returns         参数值\r\n     */\r\n    public getEventParam(id:number,key:string,name:string){\r\n        return this.cache.get('$doms.' + key + '$events.' + id + '.$params.' + name);\r\n    }\r\n\r\n    /**\r\n     * 移除事件参数\r\n     * @param id        事件id\r\n     * @param key       dom key\r\n     * @param name      参数名\r\n     */\r\n    public removeEventParam(id:number,key:string,name:string){\r\n        this.cache.remove('$doms.' + key + '$events.' + id + '.$params.' + name);\r\n    }\r\n\r\n    /**\r\n     * 清空事件参数\r\n     * @param id        事件id\r\n     * @param key       dom key \r\n     */\r\n    public clearEventParam(id:number,key:string){\r\n        this.cache.remove('$doms.' + key + '$events.' + id + '.$params');\r\n    }\r\n\r\n    /**\r\n     * 获取旧虚拟dom\r\n     * @param dom       dom对象\r\n     */\r\n    public saveElement(dom:VirtualDom){\r\n        this.cache.set('$doms.' + dom.key,dom);\r\n    }\r\n    /**\r\n     * 获取渲染树虚拟dom\r\n     * @param key       dom key\r\n     * @returns         dom对象\r\n     */\r\n    public getElement(key:string):VirtualDom{\r\n        return this.cache.get('$doms.' + key);\r\n    }\r\n\r\n    /**\r\n     * 删除渲染树虚拟dom\r\n     * @param key       虚拟dom key\r\n     */\r\n     public removeElement(key:string){\r\n        this.cache.remove('$doms.' + key);\r\n    }\r\n\r\n\r\n    /**\r\n     * 移除保存的节点（包括参数和html dom）\r\n     * @param key   dom key\r\n     */\r\n    public removeSavedNode(key:string){\r\n        this.cache.remove('$doms.' + key);\r\n    }\r\n\r\n    /**\r\n     * 设置dom参数值\r\n     * @param key       dom key \r\n     * @param name       参数名\r\n     * @param value     参数值\r\n     */\r\n    public setElementParam(key:string,name:string,value:any){\r\n        this.cache.set('$doms.' + key + '.$params.' + name ,value);\r\n    }\r\n\r\n    /**\r\n     * 获取dom参数值\r\n     * @param key       dom key\r\n     * @param name      参数名\r\n     * @returns         参数值\r\n     */\r\n    public getElementParam(key:string,name:string):any{\r\n        return this.cache.get('$doms.' + key + '.$params.' + name);\r\n    }\r\n\r\n    /**\r\n     * 移除dom参数\r\n     * @param key       dom key\r\n     * @param name      参数名\r\n     */\r\n    public removeElementParam(key:string,name:string){\r\n        this.cache.remove('$doms.' + key + '.$params.' + name);\r\n    }\r\n\r\n    /**\r\n     * 清除element 参数集\r\n     * @param key   dom key\r\n     */\r\n    public clearElementParams(key:string){\r\n        this.cache.remove('$doms.' + key + '.$params');\r\n    }\r\n\r\n    /**\r\n     * 清除指令集\r\n     */\r\n    public clearDirectives(){\r\n        this.remove('$directives');\r\n    }\r\n\r\n    /**\r\n     * 清除表达式集\r\n     */\r\n    public clearExpressions(){\r\n        this.remove('$directives');\r\n    }\r\n\r\n    /**\r\n     * 清除事件集\r\n     */   \r\n    public clearEvents(){\r\n        this.remove('$directives');\r\n    }\r\n\r\n    /**\r\n     * 清除缓存dom对象\r\n     */\r\n    public clearSaveDoms(){\r\n        this.remove('$doms');\r\n    }\r\n\r\n}\r\n","import { NCache } from \"./cache\";\r\nimport { Compiler } from \"./compiler\";\r\nimport { CssManager } from \"./cssmanager\";\r\nimport { VirtualDom } from \"./virtualdom\";\r\nimport { Model } from \"./model\";\r\nimport { ModuleFactory } from \"./modulefactory\";\r\nimport { ObjectManager } from \"./objectmanager\";\r\nimport { Renderer } from \"./renderer\";\r\nimport { Util } from \"./util\";\r\nimport { DiffTool } from \"./difftool\";\r\nimport { ModelManager } from \"./modelmanager\";\r\n\r\n/**\r\n * 模块类\r\n * 模块方法说明：模版内使用的方法，包括事件，都直接在模块内定义\r\n *      方法this：指向module实例\r\n *      事件参数: model(当前按钮对应model),dom(事件对应虚拟dom),eventObj(事件对象),e(实际触发的html event)\r\n *      表达式方法：参数按照表达式方式给定即可\r\n */\r\nexport class Module {\r\n    /**\r\n     * 模块id(全局唯一)\r\n     */\r\n    public id: number;\r\n\r\n    /**\r\n     * 模型，代理过的data\r\n     */\r\n    public model:Model;\r\n\r\n    /**\r\n     * 子模块类集合，模版中引用的模块类需要声明\r\n     * 如果类已经通过registModule注册过，这里不再需要定义，只需import即可\r\n     */\r\n    public modules: any;\r\n\r\n    /**\r\n     * 父模块通过dom节点传递的属性\r\n     */\r\n    public props:any;\r\n\r\n    /**\r\n     * 编译后的dom树\r\n     */\r\n    public originTree:VirtualDom;\r\n\r\n    /**\r\n     * 渲染树\r\n     */\r\n    public renderTree: VirtualDom;\r\n\r\n    /**\r\n     * 父模块 id\r\n     */\r\n    public parentId: number;\r\n\r\n    /**\r\n     * 子模块id数组\r\n     */\r\n    public children: Array<number> = [];\r\n\r\n    /**\r\n     * 状态 1初始化 2已渲染\r\n     */\r\n    public state: number;\r\n\r\n    /**\r\n     * 放置模块的容器\r\n     */\r\n    private container: HTMLElement;\r\n\r\n    /**\r\n     * 后置渲染序列\r\n     */\r\n    private preRenderOps:any[] = [];\r\n\r\n    /**\r\n     * 后置渲染序列\r\n     */\r\n    private postRenderOps:any[] = [];\r\n\r\n    /**\r\n     * 对象管理器，用于管理虚拟dom节点、指令、表达式、事件对象及其运行时参数\r\n     */\r\n    public objectManager:ObjectManager;\r\n\r\n    /**\r\n     * 更改model的map，用于记录增量渲染时更改的model\r\n     */\r\n    public changedModelMap:Map<string,boolean>;\r\n\r\n    /**\r\n     * 用于保存每个key对应的html node\r\n     */\r\n    public keyNodeMap:Map<string,Node> = new Map();\r\n\r\n    /**\r\n     * 不允许加入渲染队列标志，在renderdom前设置，避免render前修改数据引发二次渲染\r\n     */\r\n    public dontAddToRender:boolean;\r\n\r\n    /**\r\n     * 是否替换容器\r\n     */\r\n    public replaceContainer:boolean;\r\n\r\n    /**\r\n     * 构造器\r\n     */\r\n    constructor() {\r\n        this.id = Util.genId();\r\n        this.objectManager = new ObjectManager(this);\r\n        this.changedModelMap = new Map();\r\n        //加入模块工厂\r\n        ModuleFactory.add(this);\r\n    }\r\n\r\n    /**\r\n     * 初始化\r\n     */\r\n    public init() {\r\n        // 设置状态为初始化\r\n        this.state = 1;\r\n        //初始化model\r\n        this.model = new Model(this.data()||{} , this);\r\n        //注册子模块\r\n        if(this.modules && Array.isArray(this.modules)){\r\n            for (let cls of this.modules) {\r\n                ModuleFactory.addClass(cls);\r\n            }\r\n            delete this.modules;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 模版串方法，使用时重载\r\n     * @param props     props对象，在模版容器dom中进行配置，从父模块传入\r\n     * @returns         模版串\r\n     */\r\n    public template(props?:any):string{\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * 数据方法，使用时重载\r\n     * @returns      model数据\r\n     */\r\n    public data():any{\r\n        return {};\r\n    }\r\n    \r\n    /**\r\n     * 模型渲染\r\n     */\r\n    public render(): boolean {\r\n        this.dontAddToRender = true;\r\n        //编译\r\n        if(!this.originTree){\r\n            this.compile();\r\n        }\r\n        //不存在，不渲染\r\n        if(!this.originTree){\r\n            return;\r\n        }\r\n        //执行前置方法\r\n        this.doRenderOps(0);\r\n        this.doModuleEvent('onBeforeRender');\r\n        if (!this.renderTree) {\r\n            this.doFirstRender();\r\n        } else { //增量渲染\r\n            //执行每次渲染前事件\r\n            if (this.model) {\r\n                let oldTree = this.renderTree;\r\n                this.renderTree = Renderer.renderDom(this,this.originTree,this.model);\r\n                this.doModuleEvent('onBeforeRenderToHtml');\r\n                let changeDoms = [];\r\n                // 比较节点\r\n                DiffTool.compare(this.renderTree,oldTree, changeDoms);\r\n                //执行更改\r\n                if(changeDoms.length>0){\r\n                    Renderer.handleChangedDoms(this,changeDoms);\r\n                }\r\n            }\r\n        }\r\n        \r\n        //设置已渲染状态\r\n        this.state = 2;\r\n        //执行后置方法\r\n        this.doRenderOps(1);\r\n        //执行每次渲染后事件\r\n        this.doModuleEvent('onRender');\r\n        this.changedModelMap.clear();\r\n        this.dontAddToRender = false;\r\n    }\r\n\r\n    /**\r\n     * 执行首次渲染\r\n     * @param root \t根虚拟dom\r\n     */\r\n    private doFirstRender() {\r\n        this.doModuleEvent('onBeforeFirstRender');\r\n        //渲染树\r\n        this.renderTree = Renderer.renderDom(this,this.originTree,this.model);\r\n        this.doModuleEvent('onBeforeFirstRenderToHTML');\r\n        //渲染为html element\r\n        let el:any = Renderer.renderToHtml(this,this.renderTree,null,true);\r\n        if(this.replaceContainer){ //替换\r\n            ['style','class'].forEach(item=>{\r\n                let c = this.container.getAttribute(item);\r\n                if(!c){\r\n                    return;\r\n                }\r\n                c = c.trim();\r\n                let c1 = el.getAttribute(item) || '';\r\n                if(item==='style'){\r\n                    c += (c.endsWith(';')?'':';') + c1;\r\n                }else{\r\n                    c += ' ' + c1;\r\n                }\r\n                el.setAttribute(item,c);\r\n            });\r\n            Util.replaceNode(this.container,el);\r\n        }else{\r\n            //清空子元素\r\n            Util.empty(this.container);\r\n            this.container.appendChild(el);\r\n        }\r\n        //执行首次渲染后事件\r\n        this.doModuleEvent('onFirstRender');\r\n    }\r\n\r\n    /**\r\n     * 添加子模块\r\n     * @param module    模块id或模块\r\n     */\r\n    public addChild(module: number|Module) {\r\n        let mid;\r\n        if(typeof module === 'number'){\r\n            mid = module;\r\n            module = ModuleFactory.get(mid);\r\n        }else{\r\n            mid = module.id;\r\n        }\r\n        if (!this.children.includes(mid)) {\r\n            this.children.push(mid);\r\n            module.parentId = this.id;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 激活模块(添加到渲染器)\r\n     */\r\n    public active() {\r\n        Renderer.add(this);\r\n        for(let id of this.children){\r\n            let m = ModuleFactory.get(id);\r\n            if(m){\r\n                m.active();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 取消激活\r\n     */\r\n    public unactive() {\r\n        if (ModuleFactory.getMain() === this) {\r\n            return;\r\n        }\r\n        //设置状态\r\n        this.state = 1;\r\n        //删除容器\r\n        delete this.container;\r\n        //删除渲染树\r\n        delete this.renderTree;\r\n\r\n        // 清理dom key map\r\n        this.keyNodeMap.clear();\r\n        //清理缓存\r\n        this.clearCache();\r\n\r\n        //处理子模块\r\n        for(let id of this.children){\r\n            let m = ModuleFactory.get(id);\r\n            if(m){\r\n                m.unactive();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 模块销毁\r\n     */\r\n    public destroy() {\r\n        if (Util.isArray(this.children)) {\r\n            this.children.forEach((item) => {\r\n                let m: Module = ModuleFactory.get(item);\r\n                if (m) {\r\n                    m.destroy();\r\n                }\r\n            });\r\n        }\r\n        this.clearCache(true);\r\n        //从工厂释放\r\n        ModuleFactory.remove(this.id);\r\n    }\r\n\r\n    /**\r\n     * 获取父模块\r\n     * @returns     父模块   \r\n     */\r\n    public getParent(): Module {\r\n        if (!this.parentId) {\r\n            return;\r\n        }\r\n        return ModuleFactory.get(this.parentId);\r\n    }\r\n\r\n    /**\r\n     * 执行模块事件\r\n     * @param eventName \t事件名\r\n     */\r\n    private doModuleEvent(eventName: string) {\r\n        this.invokeMethod(eventName, this.model);\r\n    }\r\n\r\n    /**\r\n     * 获取模块方法\r\n     * @param name  方法名\r\n     * @returns     方法\r\n     */\r\n    public getMethod(name: string): Function {\r\n        return this[name];\r\n    }\r\n\r\n    /**\r\n     * 设置渲染容器\r\n     * @param el        容器\r\n     * @param replace   渲染时是否直接替换container\r\n     */\r\n    public setContainer(el:HTMLElement,replace?:boolean){\r\n        this.container = el;\r\n        this.replaceContainer = replace;\r\n    }\r\n\r\n    /**\r\n     * 调用方法\r\n     * @param methodName    方法名\r\n     */\r\n    public invokeMethod(methodName: string,arg1?:any,arg2?:any,arg3?:any) {\r\n        let foo = this[methodName];\r\n        if (foo && typeof foo === 'function') {\r\n            let args = [];\r\n            for(let i=1;i<arguments.length;i++){\r\n                args.push(arguments[i]);\r\n            }\r\n            return foo.apply(this, args);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 添加渲染方法\r\n     * @param foo   方法函数    \r\n     * @param flag  标志 0:渲染前执行 1:渲染后执行\r\n     * @param args  参数\r\n     * @param once  是否只执行一次，如果为true，则执行后删除\r\n     */\r\n    public addRenderOps(foo:Function,flag:number,args?:any[],once?:boolean){\r\n        if(typeof foo !== 'function'){\r\n            return;\r\n        }\r\n        let arr = flag===0?this.preRenderOps:this.postRenderOps;\r\n        arr.push({\r\n            foo:foo,\r\n            args:args,\r\n            once:once\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 执行渲染方法\r\n     * @param flag 类型 0:前置 1:后置\r\n     */\r\n    private doRenderOps(flag:number){\r\n        let arr = flag===0?this.preRenderOps:this.postRenderOps;\r\n        if(arr){\r\n            for(let i=0;i<arr.length;i++){\r\n                let o = arr[i];\r\n                o.foo.apply(this,o.args);\r\n                // 执行后删除\r\n                if(o.once){\r\n                    arr.splice(i--,1);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置props\r\n     * @param props     属性值\r\n     */\r\n    public setProps(props:any){\r\n        let change:boolean = false;\r\n        //保留数据\r\n        let dataObj = props.$data;\r\n        //属性对比不对data进行对比，删除数据属性\r\n        delete props.$data;\r\n        if(!this.props){\r\n            change = true;\r\n        }else{\r\n            const keys = Object.getOwnPropertyNames(props);\r\n            let len1 = keys.length;\r\n            const keys1 = this.props?Object.getOwnPropertyNames(this.props):[];\r\n            let len2 = keys1.length;\r\n            if(len1 !== len2){\r\n                change = true;\r\n            }else{\r\n                for(let k of keys){\r\n                    // object 默认改变\r\n                    if(props[k] !== this.props[k] || typeof(props[k]) === 'object'){\r\n                        change = true;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        //props数据复制到模块model\r\n        if(dataObj){\r\n            for(let d in dataObj){\r\n                let o = dataObj[d];\r\n                //如果为对象，需要绑定到模块\r\n                if(typeof o === 'object'){\r\n                    ModelManager.bindToModule(o,this);\r\n                    this.model[d] = o;\r\n                }else if(!this.props || this.model[d] === undefined){ //非对象，值不存在，或第一次，避免覆盖模块修改的数据\r\n                    this.model[d] = o;\r\n                }\r\n            }\r\n        }\r\n        \r\n        this.props = props;\r\n        if(change){ //有改变，进行编译并激活\r\n            this.compile();\r\n            this.active();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 编译\r\n     */\r\n    public compile(){\r\n        //清除缓存\r\n        this.clearCache();\r\n        const str = this.template(this.props);\r\n        if(str){\r\n            this.originTree = new Compiler(this).compile(str);\r\n        }\r\n    }\r\n    /**\r\n     * 清理缓存\r\n     * @param force 强力清除 \r\n     */\r\n    public clearCache(force?:boolean){\r\n        if(force){ //强力清除，后续不再使用\r\n            this.objectManager.cache = new NCache();\r\n            return;\r\n        }\r\n        \r\n        //清理dom相关\r\n        this.objectManager.clearSaveDoms();\r\n        //清理指令\r\n        this.objectManager.clearDirectives();\r\n        //清理表达式\r\n        this.objectManager.clearExpressions();\r\n        //清理事件\r\n        this.objectManager.clearEvents();\r\n        //清理css url\r\n        CssManager.clearModuleRules(this);\r\n    }\r\n\r\n    /**\r\n     * 获取node\r\n     * @param key   dom key \r\n     * @returns     html node\r\n     */\r\n    public getNode(key:string):Node{\r\n        return this.keyNodeMap.get(key);\r\n    }\r\n\r\n    /**\r\n     * save node\r\n     * @param key   dom key\r\n     * @param node  html node\r\n     */\r\n    public saveNode(key:string,node:Node){\r\n        this.keyNodeMap.set(key,node);\r\n    }\r\n}\r\n","import { DirectiveElement } from \"../core/directiveelement\";\r\nimport { DirectiveElementManager } from \"../core/directiveelementmanager\";\r\nimport { NError } from \"../core/error\";\r\nimport { NodomMessage } from \"../core/nodom\";\r\nimport { VirtualDom } from \"../core/virtualdom\";\r\nimport { Directive } from \"../core/directive\";\r\nimport { Module } from \"../core/module\";\r\nimport { GlobalCache } from \"../core/globalcache\";\r\n\r\n/**\r\n * module 元素\r\n */\r\nclass MODULE extends DirectiveElement{\r\n    constructor(node: VirtualDom,module:Module){\r\n        super(node,module);\r\n        //类名\r\n        let clazz = node.getProp('name');\r\n        if (!clazz) {\r\n            throw new NError('itemnotempty', NodomMessage.TipWords['element'], 'MODULE', 'className');\r\n        }\r\n        node.delProp('name');\r\n        node.addDirective(new Directive('module',clazz));\r\n    }\r\n}\r\n\r\n/**\r\n * for 元素\r\n */\r\nclass FOR extends DirectiveElement{\r\n    constructor(node: VirtualDom,module:Module){\r\n        super(node,module);\r\n        //条件\r\n        let cond = node.getProp('cond');\r\n        if (!cond) {\r\n            throw new NError('itemnotempty', NodomMessage.TipWords['element'], 'FOR', 'cond');\r\n        }\r\n        node.delProp('cond');\r\n        if(typeof cond === 'number'){ //表达式\r\n            cond = GlobalCache.getExpression(cond);\r\n        }\r\n        \r\n        node.addDirective(new Directive('repeat',cond));\r\n    }\r\n}\r\n\r\n/**\r\n * 递归元素\r\n */\r\nclass RECUR extends DirectiveElement{\r\n    constructor(node: VirtualDom,module:Module){\r\n        super(node,module);\r\n        //条件\r\n        let cond = node.getProp('cond');\r\n        node.delProp('cond');\r\n        if(typeof cond === 'number'){ //表达式\r\n            cond = GlobalCache.getExpression(cond);\r\n        }\r\n        node.addDirective(new Directive('recur',cond));\r\n    }\r\n}\r\n\r\n/**\r\n * IF 元素\r\n */\r\nclass IF extends DirectiveElement{\r\n    constructor(node: VirtualDom,module:Module){\r\n        super(node,module);\r\n        //条件\r\n        let cond = node.getProp('cond');\r\n        if (!cond) {\r\n            throw new NError('itemnotempty', NodomMessage.TipWords['element'], 'IF', 'cond');\r\n        }\r\n        node.delProp('cond');\r\n        if(typeof cond === 'number'){ //表达式\r\n            cond = GlobalCache.getExpression(cond);\r\n        }\r\n        node.addDirective(new Directive('if',cond));\r\n    }\r\n}\r\n\r\nclass ELSE extends DirectiveElement{\r\n    constructor(node: VirtualDom,module:Module){\r\n        super(node,module);\r\n        node.addDirective(new Directive('else',null));\r\n    }\r\n}\r\n/**\r\n * ELSEIF 元素\r\n */\r\nclass ELSEIF extends DirectiveElement{\r\n    constructor(node: VirtualDom,module:Module){\r\n        super(node,module);\r\n        //条件\r\n        let cond = node.getProp('cond');\r\n        if (!cond) {\r\n            throw new NError('itemnotempty', NodomMessage.TipWords['element'], 'ELSEIF', 'cond');\r\n        }\r\n        node.delProp('cond');\r\n        if(typeof cond === 'number'){ //表达式\r\n            cond = GlobalCache.getExpression(cond);\r\n        }\r\n        node.addDirective(new Directive('elseif',cond));\r\n    }\r\n}\r\n/**\r\n * ENDIF 元素\r\n */\r\nclass ENDIF extends DirectiveElement{\r\n    constructor(node: VirtualDom,module:Module){\r\n        super(node,module);\r\n        node.addDirective(new Directive('endif',null));\r\n    }\r\n}\r\n\r\n/**\r\n * 替代器\r\n */\r\nclass SLOT extends DirectiveElement{\r\n    constructor(node: VirtualDom,module:Module){\r\n        super(node,module);\r\n        //条件\r\n        let cond = node.getProp('name') || 'default';\r\n        node.delProp('name');\r\n        node.addDirective(new Directive('slot',cond));\r\n    }\r\n}\r\n\r\nDirectiveElementManager.add([MODULE,FOR,IF,RECUR,ELSE,ELSEIF,ENDIF,SLOT]);","import { Directive } from \"../core/directive\";\r\nimport { VirtualDom } from \"../core/virtualdom\";\r\nimport { NEvent } from \"../core/event\";\r\nimport { Model } from \"../core/model\";\r\nimport { Module } from \"../core/module\";\r\nimport { ModuleFactory } from \"../core/modulefactory\";\r\nimport { createDirective} from \"../core/nodom\";\r\nimport { Renderer } from \"../core/renderer\";\r\nimport { Router } from \"../core/router\";\r\nimport { Util } from \"../core/util\";\r\nimport { ModelManager } from \"../core/modelmanager\";\r\n\r\nexport default (function () {\r\n\r\n    /**\r\n     * 指令类型初始化\r\n     * 每个指令类型都有一个名字、处理函数和优先级，处理函数不能用箭头函数\r\n     * 处理函数在渲染时执行，包含两个参数 module(模块)、dom(目标虚拟dom)、src(源虚拟dom)\r\n     * 处理函数的this指向指令\r\n     * 处理函数的返回值 true 表示继续，false 表示后续指令不再执行 \r\n     */\r\n\r\n    /**\r\n     * module 指令\r\n     * 用于指定该元素为模块容器，表示子模块\r\n     * 用法 x-module='模块类名'\r\n     */\r\n    createDirective(\r\n        'module',\r\n        function(module:Module,dom:VirtualDom,src:VirtualDom){\r\n            let m: Module;\r\n            //存在moduleId，表示已经渲染过，不渲染\r\n            let mid = dom.getParam(module,'moduleId');\r\n            let handle:boolean = true;\r\n            if (mid) {\r\n                m = ModuleFactory.get(mid);\r\n                handle = !dom.getProp('renderOnce');\r\n            } else {\r\n                m = ModuleFactory.get(this.value);\r\n                if (!m) {\r\n                    return true;\r\n                }\r\n                mid = m.id;\r\n                //保留modelId\r\n                dom.setParam(module,'moduleId',mid);\r\n                module.addChild(m);\r\n                //共享当前dom的model给子模块\r\n                if(dom.hasProp('useDomModel')){\r\n                    m.model = dom.model;\r\n                    //绑定model到子模块，共享update,watch方法\r\n                    ModelManager.bindToModule(m.model,m);\r\n                    dom.delProp('useDomModel');\r\n                }\r\n            }\r\n            //保存到dom上，提升渲染性能\r\n            dom.subModuleId = mid;\r\n            if(handle){ //需要处理\r\n                //设置props，如果改变了props，启动渲染\r\n                let o:any = {};\r\n                if(dom.props){\r\n                    for(let p of dom.props){\r\n                        if(p[0][0] === '$'){ //数据\r\n                            if(!o.$data){\r\n                                o.$data = {};\r\n                            }\r\n                            o.$data[p[0].substr(1)] = p[1];\r\n                            //删除属性\r\n                            dom.delProp(p[0]);\r\n                        }else{\r\n                            o[p[0]] = p[1];\r\n                        }\r\n                    }\r\n                }\r\n                //传递给模块\r\n                m.setProps(o);\r\n            }\r\n            return true;\r\n        },\r\n        8\r\n    );\r\n\r\n    /**\r\n     *  model指令\r\n     */\r\n    createDirective(\r\n        'model',\r\n        function(module:Module,dom:VirtualDom,src:VirtualDom){\r\n            let model: Model = dom.model.$get(this.value);\r\n            if (model) {\r\n                dom.model = model;\r\n            }\r\n            return true;\r\n        },\r\n        1\r\n    );\r\n\r\n    /**\r\n     * 指令名 repeat\r\n     * 描述：重复指令\r\n     */\r\n    createDirective(\r\n        'repeat',\r\n        function(module:Module,dom:VirtualDom,src:VirtualDom){\r\n            let rows = this.value;\r\n            console.log(rows);\r\n            // 无数据，不渲染\r\n            if (!Util.isArray(rows) || rows.length === 0) {\r\n                return false;\r\n            }\r\n            //索引名\r\n            const idxName = src.getProp('$index');\r\n            const parent = dom.parent;\r\n            //禁用该指令\r\n            this.disabled = true;\r\n            for (let i = 0; i < rows.length; i++) {\r\n                if(idxName){\r\n                    rows[i][idxName] = i;\r\n                }\r\n                //渲染一次-1，所以需要+1\r\n                src.staticNum++;\r\n                let d = Renderer.renderDom(module,src,rows[i],parent,rows[i].$key);\r\n                //删除$index属性\r\n                if(idxName){\r\n                    d.delProp('$index');    \r\n                }\r\n            }\r\n            //启用该指令\r\n            this.disabled = false;\r\n            return false;\r\n        },\r\n        2\r\n    );\r\n\r\n    /**\r\n     * 递归指令\r\n     * 作用：在dom内部递归，用于具有相同数据结构的节点递归生成\r\n     * 递归指令不允许嵌套\r\n     * name表示递归名字，必须与内部的recur标签的ref保持一致，名字默认为default\r\n     * 典型模版\r\n     * ```\r\n     * <recur name='r1'>\r\n     *      <div>...</div>\r\n     *      <p>...</p>\r\n     *      <recur ref='r1' />\r\n     * </recur>\r\n     * ```\r\n     */\r\n    createDirective(\r\n        'recur',\r\n        function(module:Module,dom:VirtualDom,src:VirtualDom){\r\n            //递归节点存放容器\r\n            if(dom.hasProp('ref')){\r\n                //如果出现在repeat中，src为单例，需要在使用前清空子节点，避免沿用上次的子节点\r\n                src.children = [];\r\n                //递归存储名\r\n                const name = '$recurs.' + (dom.getProp('ref') || 'default');\r\n                let node = module.objectManager.get(name);\r\n                if(!node){\r\n                    return true;\r\n                }\r\n                let model = dom.model;\r\n                let cond = node.getDirective('recur');\r\n                let m = model[cond.value];\r\n                //不存在子层数组，不再递归\r\n                if(!m){\r\n                    return true;\r\n                }\r\n                //克隆，后续可以继续用\r\n                let node1 = node.clone();\r\n                let key:string;\r\n                if(!Array.isArray(m)){  //recur子节点不为数组，依赖子层数据\r\n                    node1.model = m;\r\n                    key = m.$key;\r\n                    Util.setNodeKey(node1,key,true);\r\n                }else{\r\n                    key = dom.model.$key\r\n                }\r\n                \r\n                src.children = [node1];\r\n            }else { //递归节点\r\n                let data = dom.model[this.value];\r\n                if(!data){\r\n                    return true;\r\n                }\r\n                //递归名，默认default\r\n                const name = '$recurs.' + (dom.getProp('name') || 'default');\r\n                if(!module.objectManager.get(name)){\r\n                    module.objectManager.set(name,src.clone());\r\n                }\r\n            }\r\n            return true;\r\n        },\r\n        2\r\n    );\r\n\r\n    /**\r\n     * 指令名 if\r\n     * 描述：条件指令\r\n     */\r\n    createDirective('if',\r\n        function(module:Module,dom:VirtualDom,src:VirtualDom){\r\n            dom.parent.setParam(module,'$if',this.value);\r\n            return this.value;\r\n        },\r\n        5\r\n    );\r\n\r\n    /**\r\n     * 指令名 else\r\n     * 描述：else指令\r\n     */\r\n    createDirective(\r\n        'else',\r\n        function(module:Module,dom:VirtualDom,src:VirtualDom){\r\n            //如果前面的if/elseif值为true，则隐藏，否则显示\r\n            return dom.parent.getParam(module,'$if') === false;\r\n        },\r\n        5\r\n    );\r\n\r\n    /**\r\n     * elseif 指令\r\n     */\r\n    createDirective('elseif', \r\n        function(module:Module,dom:VirtualDom,src:VirtualDom){\r\n            let v = dom.parent.getParam(module,'$if');\r\n            if(v === true){\r\n                return false;\r\n            }else{\r\n                if(!this.value){\r\n                    return false;\r\n                }else{\r\n                    dom.parent.setParam(module,'$if',true);\r\n                }\r\n            }\r\n            return true;\r\n        },\r\n        5\r\n    );\r\n\r\n    /**\r\n     * endif 指令\r\n     */\r\n     createDirective(\r\n         'endif', \r\n        function(module:Module,dom:VirtualDom,src:VirtualDom){\r\n            dom.parent.removeParam(module,'$if');\r\n            return true;\r\n        },\r\n        5\r\n    );\r\n\r\n    /**\r\n     * 指令名 show\r\n     * 描述：显示指令\r\n     */\r\n    createDirective(\r\n        'show',\r\n        function(module:Module,dom:VirtualDom,src:VirtualDom){\r\n            return this.value;\r\n        },\r\n        5\r\n    );\r\n\r\n    /**\r\n     * 指令名 field\r\n     * 描述：字段指令\r\n     */\r\n    createDirective('field',\r\n        function(module:Module,dom:VirtualDom,src:VirtualDom){\r\n            const me = this;\r\n            const type: string = dom.getProp('type') || 'text';\r\n            const tgname = dom.tagName.toLowerCase();\r\n            const model = dom.model;\r\n            \r\n            if (!model) {\r\n                return true;\r\n            }\r\n\r\n            let dataValue = model.$get(this.value);\r\n            \r\n            if (type === 'radio') {\r\n                let value = dom.getProp('value');\r\n                if (dataValue == value) {\r\n                    dom.setProp('checked',true);\r\n                    dom.setAsset('checked','checked');\r\n                } else {\r\n                    dom.setAsset('checked',false);\r\n                    dom.delProp('checked');\r\n                }\r\n            } else if (type === 'checkbox') {\r\n                //设置状态和value\r\n                let yv = dom.getProp('yes-value');\r\n                //当前值为yes-value\r\n                if (dataValue == yv) {\r\n                    dom.setProp('value',yv);\r\n                    dom.setAsset('checked','checked');\r\n                } else { //当前值为no-value\r\n                    dom.setProp('value',dom.getProp('no-value'));\r\n                    dom.setAsset('checked',false);\r\n                }\r\n            } else if (tgname === 'select') { //下拉框\r\n                dom.setAsset('value',dataValue);\r\n                dom.setProp('value',dataValue);\r\n            } else {\r\n                let v = (dataValue!==undefined && dataValue!==null)?dataValue:'';\r\n                dom.setAsset('value',v);\r\n                dom.setProp('value',v);\r\n            }\r\n\r\n            //初始化\r\n            if(!this.getParam(module,dom,'inited')){\r\n                dom.addEvent(new NEvent('change',\r\n                    function(model,dom){\r\n                        let el = <any>module.getNode(dom.key);\r\n                        if (!el) {\r\n                            return;\r\n                        }\r\n                        let type = dom.getProp('type');\r\n                        let field = me.value;\r\n                        let v = el.value;\r\n                        //根据选中状态设置checkbox的value\r\n                        if (type === 'checkbox') {\r\n                            if (dom.getProp('yes-value') == v) {\r\n                                v = dom.getProp('no-value');\r\n                            } else {\r\n                                v = dom.getProp('yes-value');\r\n                            }\r\n                        } else if (type === 'radio') {\r\n                            if (!el.checked) {\r\n                                v = undefined;\r\n                            }\r\n                        }\r\n                        \r\n                        //修改字段值,需要处理.运算符\r\n                        let temp = this;\r\n                        let arr = field.split('.')\r\n                        if (arr.length === 1) {\r\n                            model[field] = v;\r\n                        } else {\r\n                            field = arr.pop();\r\n                            for (let i = 0; i < arr.length; i++) {\r\n                                temp = temp[arr[i]];\r\n                            }\r\n                            temp[field] = v;\r\n                        }\r\n                        //修改value值，该节点不重新渲染\r\n                        if (type !== 'radio') {\r\n                            dom.setProp('value',v);\r\n                            el.value = v;\r\n                        }\r\n                    }\r\n                ));\r\n                this.setParam(module,dom,'inited',true);\r\n            }\r\n            return true;\r\n        },\r\n        10\r\n    );\r\n\r\n    /**\r\n     * route指令\r\n     */\r\n    createDirective('route',\r\n        function(module:Module,dom:VirtualDom,src:VirtualDom){\r\n            if(!this.value){\r\n                return true;\r\n            }\r\n            //a标签需要设置href\r\n            if (dom.tagName.toLowerCase() === 'a') {\r\n                dom.setProp('href','javascript:void(0)');\r\n            }\r\n            dom.setProp('path',this.value);\r\n            //有激活属性\r\n            if (dom.hasProp('active')) {\r\n                let acName = dom.getProp('active');\r\n                dom.delProp('active');\r\n                //active 转expression\r\n                Router.addActiveField(module, this.value, dom.model, acName);\r\n                if(this.value.startsWith(Router.currentPath) && dom.model[acName]){\r\n                    Router.go(this.value);\r\n                }\r\n            }\r\n            \r\n            //添加click事件,避免重复创建事件对象，创建后缓存\r\n            let event:NEvent = module.objectManager.get('$routeClickEvent');\r\n            if(!event){\r\n                event = new NEvent('click',\r\n                    (model,dom, e) => {\r\n                        let path = dom.getProp('path');\r\n                        if (!path) {\r\n                            let dir: Directive = dom.getDirective('route');\r\n                            path = dir.value;\r\n                        }\r\n                        if (Util.isEmpty(path)) {\r\n                            return;\r\n                        }\r\n                        Router.go(path);\r\n                    }\r\n                );\r\n                module.objectManager.set('$routeClickEvent',event);\r\n            }\r\n            dom.addEvent(event);\r\n            return true;\r\n        }\r\n    );\r\n\r\n    /**\r\n     * 增加router指令\r\n     */\r\n    createDirective('router',\r\n        function(module:Module,dom:VirtualDom,src:VirtualDom){\r\n            Router.routerKeyMap.set(module.id, dom.key);\r\n            return true;\r\n        }\r\n    );\r\n\r\n    /**\r\n     * 插头指令\r\n     * 用于模块中，可实现同名替换\r\n     */\r\n    createDirective('slot',\r\n        function(module:Module,dom:VirtualDom,src:VirtualDom){\r\n            this.value = this.value || 'default';\r\n            let mid = dom.parent.subModuleId;\r\n            console.log(mid,this.value);\r\n            \r\n            //父dom有module指令，表示为替代节点，替换子模块中的对应的slot节点；否则为子模块定义slot节点\r\n            if(mid){\r\n                let m = ModuleFactory.get(mid);\r\n                if(m){\r\n                    //缓存当前替换节点\r\n                    m.objectManager.set('$slots.' + this.value,{dom:src.clone(),model:dom.model});\r\n                }\r\n                //此次不继续渲染，子节点在实际模块中渲染\r\n                return false;\r\n            }else{ //源slot节点\r\n                //获取替换节点进行替换\r\n                let cfg = module.objectManager.get('$slots.' + this.value);\r\n                console.log(cfg,'cfg');\r\n                \r\n                if(cfg){\r\n                    let rdom = cfg.dom;\r\n                    //避免key重复，更新key\r\n                    for(let d of rdom.children){\r\n                        Util.setNodeKey(d,dom.key,true);\r\n                    }\r\n                    //更改渲染子节点\r\n                    src.children = rdom.children;\r\n                    //非内部渲染,更改model\r\n                    if(!src.hasProp('innerRender')){ \r\n                        for(let c of src.children){\r\n                            c.model = cfg.model;\r\n                        }\r\n                    }\r\n                    module.objectManager.remove('$slots.' + this.value);\r\n                }\r\n            }\r\n            return true;\r\n        },\r\n        5\r\n    );\r\n}());\r\n","import { NEvent } from \"../core/event\";\r\nimport { Module } from \"../core/module\";\r\nimport { VirtualDom } from \"../core/virtualdom\";\r\nimport { EventManager } from \"../core/eventmanager\";\r\n\r\n/**\r\n * tap事件\r\n */\r\nEventManager.regist('tap',{\r\n    touchstart(dom:VirtualDom,module:Module,evtObj:NEvent,e: TouchEvent) {\r\n        let tch = e.touches[0];\r\n        evtObj.dependEvent.setParam(module,dom,'pos', { sx: tch.pageX, sy: tch.pageY, t: Date.now() });\r\n    },\r\n    touchmove(dom:VirtualDom,module:Module,evtObj:NEvent,e: TouchEvent) {\r\n        let pos = evtObj.dependEvent.getParam(module,dom,'pos');\r\n        if(!pos){\r\n            return;\r\n        }\r\n        let tch = e.touches[0];\r\n        let dx = tch.pageX - pos.sx;\r\n        let dy = tch.pageY - pos.sy;\r\n        //判断是否移动\r\n        if (Math.abs(dx) > 5 || Math.abs(dy) > 5) {\r\n            pos.move = true;\r\n        }\r\n    },\r\n    touchend(dom:VirtualDom,module:Module,evtObj:NEvent,e: TouchEvent) {\r\n        let pos = evtObj.dependEvent.getParam(module,dom,'pos');\r\n        if(!pos){\r\n            return;\r\n        }\r\n        evtObj.dependEvent.removeParam(module,dom,'pos');\r\n        let dt = Date.now() - pos.t;\r\n        \r\n        //点下时间不超过200ms,触发事件\r\n        if (!pos.move && dt < 200) {\r\n            let foo = evtObj.dependEvent.handler;\r\n            if(typeof foo === 'string'){\r\n                foo = module.getMethod(foo);\r\n            }\r\n            if(foo){\r\n                foo.apply(module,[dom.model, dom,evtObj.dependEvent, e]); \r\n            }\r\n        }\r\n    }\r\n});\r\n\r\n/**\r\n * swipe事件\r\n */\r\n EventManager.regist('swipe',{\r\n    touchstart(dom:VirtualDom,module:Module,evtObj:NEvent,e: TouchEvent){\r\n        let tch = e.touches[0];\r\n        let t = Date.now();\r\n        evtObj.dependEvent.setParam(module,dom,'swipe', {\r\n            oldTime: [t, t],\r\n            speedLoc: [{ x: tch.pageX, y: tch.pageY }, { x: tch.pageX, y: tch.pageY }],\r\n            oldLoc: { x: tch.pageX, y: tch.pageY }\r\n        });\r\n    },\r\n    touchmove(dom:VirtualDom,module:Module,evtObj:NEvent,e: TouchEvent){\r\n        let nt = Date.now();\r\n        let tch = e.touches[0];\r\n        let mv = evtObj.dependEvent.getParam(module,dom,'swipe');\r\n        //50ms记录一次\r\n        if (nt - mv.oldTime[1] > 50) {\r\n            mv.speedLoc[0] = { x: mv.speedLoc[1].x, y: mv.speedLoc[1].y };\r\n            mv.speedLoc[1] = { x: tch.pageX, y: tch.pageY };\r\n            mv.oldTime[0] = mv.oldTime[1];\r\n            mv.oldTime[1] = nt;\r\n        }\r\n        mv.oldLoc = { x: tch.pageX, y: tch.pageY };\r\n    },\r\n    touchend(dom:VirtualDom,module:Module,evtObj:NEvent,e: any){\r\n        let mv = evtObj.dependEvent.getParam(module,dom,'swipe');\r\n        let nt = Date.now();\r\n\r\n        //取值序号 0 或 1，默认1，如果释放时间与上次事件太短，则取0\r\n        let ind = (nt - mv.oldTime[1] < 30) ? 0 : 1;\r\n        let dx = mv.oldLoc.x - mv.speedLoc[ind].x;\r\n        let dy = mv.oldLoc.y - mv.speedLoc[ind].y;\r\n        let s = Math.sqrt(dx * dx + dy * dy);\r\n        let dt = nt - mv.oldTime[ind];\r\n        //超过300ms 不执行事件\r\n        if (dt > 300 || s < 10) {\r\n            return;\r\n        }\r\n        let v0 = s / dt;\r\n        //速度>0.1,触发swipe事件\r\n        if (v0 > 0.05) {\r\n            let sname = '';\r\n            if (dx < 0 && Math.abs(dy / dx) < 1) {\r\n                e.v0 = v0; //添加附加参数到e\r\n                sname = 'swipeleft';\r\n            }\r\n            if (dx > 0 && Math.abs(dy / dx) < 1) {\r\n                e.v0 = v0;\r\n                sname = 'swiperight';\r\n            }\r\n            if (dy > 0 && Math.abs(dx / dy) < 1) {\r\n                e.v0 = v0;\r\n                sname = 'swipedown';\r\n            }\r\n            if (dy < 0 && Math.abs(dx / dy) < 1) {\r\n                e.v0 = v0;\r\n                sname = 'swipeup';\r\n            }\r\n            //处理swipe\r\n            if (evtObj.dependEvent.name === sname) {\r\n                let foo = evtObj.dependEvent.handler;\r\n                if(typeof foo === 'string'){\r\n                    foo = module.getMethod(foo);\r\n                }\r\n                if(foo){\r\n                    foo.apply(module,[dom.model, dom,evtObj.dependEvent, e]); \r\n                }\r\n            }\r\n        }\r\n    }\r\n});\r\n\r\n//把swpie注册到4个方向\r\nEventManager.regist('swipeleft',EventManager.get('swipe'));\r\nEventManager.regist('swiperight',EventManager.get('swipe'));\r\nEventManager.regist('swipeup',EventManager.get('swipe'));\r\nEventManager.regist('swipedown',EventManager.get('swipe'));\r\n"],"names":["DirectiveElementManager","static","clazz","Array","isArray","c","this","elements","set","name","tagName","get","toUpperCase","has","Map","DirectiveType","constructor","handle","prio","DirectiveManager","directiveTypes","delete","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","NodomMessage_en","TipWords","application","system","module","moduleClass","model","directive","directiveType","expression","event","method","filter","filterType","data","dataItem","route","routeView","plugin","resource","root","element","ErrorMsgs","unknown","paramException","invoke","invoke1","invoke2","invoke3","exist","exist1","notexist","notexist1","notupd","notremove","notremove1","namedinvalid","initial","jsonparse","timeout","config","config1","itemnotempty","itemincorrect","wrongTemplate","FormMsgs","type","required","min","max","WeekDays","ModuleFactory","item","modules","size","mainModule","id","addClass","getInstance","clazzName","classes","cls","className","m","Reflect","construct","init","VirtualDom","tag","key","Util","genId","removeDirectives","directives","forEach","d","removeDirective","ind","findIndex","splice","length","addDirective","sort","find","push","sortDirective","a","b","getType","hasDirective","typeName","getDirective","add","dom","children","hasClass","getProp","trim","split","includes","sa","join","setProp","setStaticOnce","removeClass","index","indexOf","hasStyle","styStr","styleStr","addStyle","removeStyle","hasProp","propName","props","isExpr","v","delProp","p","setAsset","assetName","assets","delAsset","addEvent","events","arr","getEvent","eventName","setEvent","getEl","getNode","query","i","setParam","objectManager","setElementParam","getParam","getElementParam","removeParam","removeElementParam","staticNum","clone","dst","slice","expressions","textContent","Expression","exprStr","allModelField","funStr","compile","execFunc","Function","reg","r","retS","exec","s","substring","lch","handleFunc","startsWith","isKeyWord","s1","substr","lastIndex","str","ind1","lastIndexOf","fn","val","CssManager","toLowerCase","cssPreName","parent","addRules","undefined","cssText","scopeName","sheet","document","createElement","head","appendChild","styleSheets","clearModuleRules","regImp","re","startIndex","beginNum","test","handleImport","txt","insertRule","cssRules","handleStyle","importMap","importIndex","rules","selectorText","deleteRule","NCache","cacheData","remove","GlobalCache","cache","node","NEvent","eventStr","handler","saveEvent","tp","delg","nopopo","once","capture","ontouchend","setEventParam","getEventParam","removeEventParam","clearParam","clearEventParam","EventManager","el","evt","hasDelg","hasBound","ii","ev","handleExtendEvent","delgs","getCfg","saveCfg","addEventListener","currentTarget","evts","execMap","eid","getMethod","stopPropagation","path","vdom","hasOwnProperty","dom1","unbind","Object","keys","cfg","removeEventListener","dependEvent","handleObj","extendEventMap","Renderer","dontAddToRender","waitList","shift","render","src","currentModuleRoot","subModuleId","notChange","k","handleProps","handleDirectives","handleStyleDom","renderDom","v1","dontAddToTree","parentEl","isRenderChild","setAttribute","handleAssets","newEl","newText","genSub","pEl","el1","setContainer","saveNode","bind","handleStyleTextDom","createTextNode","changeDoms","n1","n2","renderToHtml","insertBefore","childNodes","removeSavedNode","keyNodeMap","removeChild","nextSibling","replaceChild","Router","currentPath","setTimeout","load","start","parentModule","diff","compare","getMain","getModule","isFunction","onDefaultLeave","onLeave","activeFieldMap","unactive","dependHandle","onDefaultEnter","onEnter","startStyle","history","replaceState","pushState","go","modulePath","import","path1","path2","arr1","arr2","getRouteList","len","retArr1","retArr2","JSON","stringify","p1","p2","j","field","pm","me","active","o","isEmpty","state","routerKeyMap","setDomActive","fullPath","addRenderOps","Route","pathArr","param","paramIndex","prePath","params","addChild","routeMap","retArr","preNode","window","addRoute","routes","child","getOwnPropertyNames","Scheduler","tasks","func","thiser","call","scheduleTick","dispatch","requestAnimationFrame","foo","NError","NodomMessage","nodom","addTask","mdl","querySelector","createRoute","createDirective","priority","addType","registModule","request","url","rand","$rand","Math","random","async","req","XMLHttpRequest","withCredentials","onload","status","responseText","parse","ontimeout","onerror","pa","isObject","ar","getOwnProps","FormData","fd","append","open","user","pwd","header","setRequestHeader","send","catch","Error","errorName","p3","p4","super","msg","message","arguments","compileStr","generatedId","keyWordMap","srcObj","expKey","extra","map","WeakMap","prop","RegExp","getCloneObj","isMap","co","o1","o2","o3","o4","o5","o6","retObj","assign","obj","subObj","obj1","obj2","deep","Number","isInteger","srcNode","nodes","pnode","parentNode","bnode","srcDate","format","timeStamp","isString","parseInt","isNumber","date","Date","isNaN","getDay","getMonth","getDate","getHours","getMinutes","getSeconds","floor","S","getMilliseconds","replace","$1","getFullYear","p5","args","paths","evalStr","setNodeKey","initKeyMap","Directive","disabled","setDirectiveParam","getDirectiveParam","removeDirectiveParam","Compiler","elementId","elementStr","compileTemplate","srcStr","regExp","regSpace","st","tagStack","textStack","isPreTag","tmp","tagNames","tagObjs","stg","etg","chds","handleText","pop","tobj","concat","unshift","po","handleSlot","tmpS","endsWith","handleTag","tagStr","ele","pName","startValue","regName","setValue","genKey","postHandleNode","compileExpression","slotCt","preHandleText","retA","oIndex","exp","div","innerHTML","DiffTool","changeArr","addChange","change","addObj","oldStartIdx","oldStartNode","oldEndIdx","oldEndNode","newStartIdx","newStartNode","newEndIdx","newEndNode","sameKey","ch","loc","DirectiveElement","NFactory","moduleId","items","NodomMessage_zh","compile1","compile2","compile3","ModelManager","dataMap","srcNModel","modelMap","watchers","mid","$key","bindToModule","ids","bindToModules","unbindFromModule","oldValue","newValue","force","mids","changedModelMap","watcher","getWatcher","Model","proxy","Proxy","receiver","update","res","getFromDataMap","deleteProperty","delFromDataMap","delModel","$watch","$get","$set","addToDataMap","addModel","operate","cancel","removeWatcher","addWatcher","getModuleIds","ObjectManager","$instance","saveDirective","clearDirectiveParam","getExpression","ex","removeExpression","saveExpression","removeEvent","saveElement","getElement","removeElement","clearElementParams","clearDirectives","clearExpressions","clearEvents","clearSaveDoms","Module","template","originTree","doRenderOps","doModuleEvent","renderTree","oldTree","handleChangedDoms","doFirstRender","clear","replaceContainer","container","getAttribute","c1","replaceNode","empty","parentId","clearCache","destroy","getParent","invokeMethod","methodName","arg1","arg2","arg3","flag","preRenderOps","postRenderOps","setProps","dataObj","$data","cond","rows","console","log","idxName","node1","tgname","dataValue","yv","checked","temp","acName","addActiveField","rdom","regist","touchstart","evtObj","tch","touches","sx","pageX","sy","pageY","t","now","touchmove","pos","dx","dy","abs","move","touchend","dt","oldTime","speedLoc","x","y","oldLoc","nt","mv","sqrt","v0","sname"],"mappings":"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"}