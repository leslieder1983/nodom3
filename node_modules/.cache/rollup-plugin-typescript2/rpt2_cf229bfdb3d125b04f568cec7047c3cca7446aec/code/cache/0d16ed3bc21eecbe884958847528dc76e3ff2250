{"code":"import { EventManager } from \"../core/eventmanager\";\r\n/**\r\n * tap事件\r\n */\r\nEventManager.regist('tap', {\r\n    touchstart(dom, module, evtObj, e) {\r\n        let tch = e.touches[0];\r\n        evtObj.dependEvent.setParam(module, dom, 'pos', { sx: tch.pageX, sy: tch.pageY, t: Date.now() });\r\n    },\r\n    touchmove(dom, module, evtObj, e) {\r\n        let pos = evtObj.dependEvent.getParam(module, dom, 'pos');\r\n        if (!pos) {\r\n            return;\r\n        }\r\n        let tch = e.touches[0];\r\n        let dx = tch.pageX - pos.sx;\r\n        let dy = tch.pageY - pos.sy;\r\n        //判断是否移动\r\n        if (Math.abs(dx) > 5 || Math.abs(dy) > 5) {\r\n            pos.move = true;\r\n        }\r\n    },\r\n    touchend(dom, module, evtObj, e) {\r\n        let pos = evtObj.dependEvent.getParam(module, dom, 'pos');\r\n        if (!pos) {\r\n            return;\r\n        }\r\n        evtObj.dependEvent.removeParam(module, dom, 'pos');\r\n        let dt = Date.now() - pos.t;\r\n        //点下时间不超过200ms,触发事件\r\n        if (!pos.move && dt < 200) {\r\n            let foo = evtObj.dependEvent.handler;\r\n            if (typeof foo === 'string') {\r\n                foo = module.getMethod(foo);\r\n            }\r\n            if (foo) {\r\n                foo.apply(module, [dom.model, dom, evtObj.dependEvent, e]);\r\n            }\r\n        }\r\n    }\r\n});\r\n/**\r\n * swipe事件\r\n */\r\nEventManager.regist('swipe', {\r\n    touchstart(dom, module, evtObj, e) {\r\n        let tch = e.touches[0];\r\n        let t = Date.now();\r\n        evtObj.dependEvent.setParam(module, dom, 'swipe', {\r\n            oldTime: [t, t],\r\n            speedLoc: [{ x: tch.pageX, y: tch.pageY }, { x: tch.pageX, y: tch.pageY }],\r\n            oldLoc: { x: tch.pageX, y: tch.pageY }\r\n        });\r\n    },\r\n    touchmove(dom, module, evtObj, e) {\r\n        let nt = Date.now();\r\n        let tch = e.touches[0];\r\n        let mv = evtObj.dependEvent.getParam(module, dom, 'swipe');\r\n        //50ms记录一次\r\n        if (nt - mv.oldTime[1] > 50) {\r\n            mv.speedLoc[0] = { x: mv.speedLoc[1].x, y: mv.speedLoc[1].y };\r\n            mv.speedLoc[1] = { x: tch.pageX, y: tch.pageY };\r\n            mv.oldTime[0] = mv.oldTime[1];\r\n            mv.oldTime[1] = nt;\r\n        }\r\n        mv.oldLoc = { x: tch.pageX, y: tch.pageY };\r\n    },\r\n    touchend(dom, module, evtObj, e) {\r\n        let mv = evtObj.dependEvent.getParam(module, dom, 'swipe');\r\n        let nt = Date.now();\r\n        //取值序号 0 或 1，默认1，如果释放时间与上次事件太短，则取0\r\n        let ind = (nt - mv.oldTime[1] < 30) ? 0 : 1;\r\n        let dx = mv.oldLoc.x - mv.speedLoc[ind].x;\r\n        let dy = mv.oldLoc.y - mv.speedLoc[ind].y;\r\n        let s = Math.sqrt(dx * dx + dy * dy);\r\n        let dt = nt - mv.oldTime[ind];\r\n        //超过300ms 不执行事件\r\n        if (dt > 300 || s < 10) {\r\n            return;\r\n        }\r\n        let v0 = s / dt;\r\n        //速度>0.1,触发swipe事件\r\n        if (v0 > 0.05) {\r\n            let sname = '';\r\n            if (dx < 0 && Math.abs(dy / dx) < 1) {\r\n                e.v0 = v0; //添加附加参数到e\r\n                sname = 'swipeleft';\r\n            }\r\n            if (dx > 0 && Math.abs(dy / dx) < 1) {\r\n                e.v0 = v0;\r\n                sname = 'swiperight';\r\n            }\r\n            if (dy > 0 && Math.abs(dx / dy) < 1) {\r\n                e.v0 = v0;\r\n                sname = 'swipedown';\r\n            }\r\n            if (dy < 0 && Math.abs(dx / dy) < 1) {\r\n                e.v0 = v0;\r\n                sname = 'swipeup';\r\n            }\r\n            //处理swipe\r\n            if (evtObj.dependEvent.name === sname) {\r\n                let foo = evtObj.dependEvent.handler;\r\n                if (typeof foo === 'string') {\r\n                    foo = module.getMethod(foo);\r\n                }\r\n                if (foo) {\r\n                    foo.apply(module, [dom.model, dom, evtObj.dependEvent, e]);\r\n                }\r\n            }\r\n        }\r\n    }\r\n});\r\n//把swpie注册到4个方向\r\nEventManager.regist('swipeleft', EventManager.get('swipe'));\r\nEventManager.regist('swiperight', EventManager.get('swipe'));\r\nEventManager.regist('swipeup', EventManager.get('swipe'));\r\nEventManager.regist('swipedown', EventManager.get('swipe'));\r\n//# sourceMappingURL=eventinit.js.map","references":["D:/User_zhao/gitRepository/competition/nodom/core/event.ts","D:/User_zhao/gitRepository/competition/nodom/core/module.ts","D:/User_zhao/gitRepository/competition/nodom/core/virtualdom.ts","D:/User_zhao/gitRepository/competition/nodom/core/eventmanager.ts"],"map":"{\"version\":3,\"file\":\"eventinit.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../extend/eventinit.ts\"],\"names\":[],\"mappings\":\"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\"}"}
